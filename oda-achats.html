

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B00">
    <link rel="manifest" href="manifest.json">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <link rel="apple-touch-icon" href="/oda1.png">
    <title>ODA Marketplace - Tous les produits</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="oda-shop-styles.css">
    <link rel="icon" type="image/png" href="oda1.png">
    <link rel="icon" type="image/png" href="oda1.png">

<!-- PWA Manager Script -->

</head>
<style>
    /* ==================== VARIABLES ==================== */
:root {
    --primary-color: #FF6B00;
    --primary-dark: #E55D00;
    --secondary-color: #1A1A1A;
    --bg-primary: #FFFFFF;
    --bg-secondary: #F8F9FA;
    --text-primary: #1A1A1A;
    --text-secondary: #6B7280;
    --border-color: #E5E7EB;
    --success-color: #10B981;
    --error-color: #EF4444;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg-secondary);
    color: var(--text-primary);
    overflow-x: hidden;
}

/* ==================== HEADER ==================== */
.main-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: #2C3E50;
    box-shadow: var(--shadow-md);
    z-index: 1000;
    padding: 12px 16px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
}

.menu-btn {
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.3rem;
    font-weight: 800;
    color: white;
}

.header-icons {
    display: flex;
    gap: 12px;
    align-items: center;
}

.icon-btn {
    position: relative;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.icon-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.icon-btn .badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--primary-color);
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
}

.search-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 12px 0 0;
}

.search-box {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.15);
    padding: 10px 16px;
    border-radius: 24px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.search-box:focus-within {
    background: rgba(255, 255, 255, 0.25);
    border-color: var(--primary-color);
}

.search-box svg {
    color: rgba(255, 255, 255, 0.7);
    flex-shrink: 0;
}

.search-box input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 0.95rem;
    color: white;
    outline: none;
}

.search-box input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* ==================== CAROUSEL BANNIÈRE ARRONDIE ==================== */
.hero-carousel {
    margin-top: 140px;
    height: 400px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #f8f8f8 0%, #020202 100%);
    border-radius: 24px;
    margin-left: 16px;
    margin-right: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}

.carousel-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 24px;
    overflow: hidden;
}

.carousel-container {
    display: flex;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    height: 100%;
}

.carousel-item {
    min-width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

.carousel-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
}

.carousel-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    padding: 40px;
    color: white;
}

.carousel-info h2 {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

.carousel-info .shop-name {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 4px;
}

.carousel-info .product-price {
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--primary-color);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
}

/* Message de découverte */
.hero-message {
    position: absolute;
    top: 40px;
    left: 40px;
    right: 40px;
    text-align: center;
    z-index: 5;
    color: rgb(5, 5, 5);
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}

.hero-message h2 {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
}

.hero-message p {
    font-size: 1.1rem;
    opacity: 0.95;
}

/* Boutons transparents sur la bannière */
.banner-actions {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 10;
}

.banner-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 16px;
    padding: 16px 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    min-width: 100px;
}

.banner-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.banner-icon {
    font-size: 2rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.carousel-btn:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
}

.carousel-btn.prev {
    left: 20px;
}

.carousel-btn.next {
    right: 20px;
}

.carousel-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
}

.dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.dot:hover {
    background: rgba(255, 255, 255, 0.8);
}

.dot.active {
    background: white;
    width: 32px;
    border-radius: 5px;
}

/* ==================== GRID PRODUITS - VERSION COMPACTE ==================== */
.products-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.product-count {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ==================== PRODUCTS GRID - COMPACT VERSION ==================== */
.products-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);  /* MODIFIÉ: Grille fixe 2 colonnes */
    gap: 12px;  /* MODIFIÉ: Réduit de 16px à 12px */
    animation: fadeIn 0.5s ease;
}

/* ==================== PRODUCT CARD - COMPACT DESIGN ==================== */
.product-card {
    background: var(--bg-primary);
    border-radius: 12px;  /* MODIFIÉ: Augmenté de 8px à 12px */
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);  /* MODIFIÉ: Transition plus fluide */
    cursor: pointer;
    position: relative;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
}

.product-card:hover {
    transform: translateY(-2px);  /* MODIFIÉ: Réduit le mouvement */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
    border-color: var(--primary-color);
}

/* Image Container - COMPACT */
.product-image-wrapper {
    position: relative;
    width: 100%;
    padding-top: 65%;  /* MODIFIÉ: Réduit de 100% à 65% */
    background: #f5f5f5;  /* MODIFIÉ: Couleur de fond */
    overflow: hidden;
}

.product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

/* NOUVEAU: Time Badge (badge de temps sur l'image) */
.time-badge {
    position: absolute;
    bottom: 8px;
    left: 8px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Favorite Button - COMPACT */
.btn-favorite {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;  /* MODIFIÉ: Réduit de 36px à 32px */
    height: 32px;  /* MODIFIÉ: Réduit de 36px à 32px */
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);  /* AJOUTÉ: Effet de flou */
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;  /* MODIFIÉ: Réduit de 1.1rem à 1rem */
    z-index: 5;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.btn-favorite:hover {
    transform: scale(1.1);  /* MODIFIÉ: Réduit de 1.15 à 1.1 */
    background: white;  /* AJOUTÉ: Fond blanc au hover */
}

.btn-favorite.active {
    background: var(--error-color);
    color: white;  /* AJOUTÉ: Texte blanc quand actif */
}

/* Product Info Section - COMPACT */
.product-info {
    padding: 10px;  /* MODIFIÉ: Réduit de 12px à 10px */
    display: flex;
    flex-direction: column;
    gap: 6px;  /* MODIFIÉ: Réduit de 8px à 6px */
    flex: 1;
}

/* Product Name - COMPACT */
.product-name {
    font-size: 0.85rem;  /* MODIFIÉ: Réduit de 0.9rem à 0.85rem */
    font-weight: 700;  /* MODIFIÉ: Augmenté de 600 à 700 */
    color: var(--text-primary);
    display: -webkit-box;
    -webkit-line-clamp: 1;  /* MODIFIÉ: Réduit de 2 à 1 ligne */
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.3;  /* MODIFIÉ: Réduit de 1.4 à 1.3 */
    margin-bottom: 2px;  /* AJOUTÉ: Espacement en bas */
}

/* Shop Badge - SIMPLIFIÉE */
.shop-badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;  /* MODIFIÉ: Réduit de 4px à 3px */
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 500;  /* MODIFIÉ: Réduit de 600 à 500 */
    width: fit-content;
    /* SUPPRIMÉ: padding et background pour style plus épuré */
}

.shop-badge svg {
    width: 12px;
    height: 12px;
}

/* NOUVEAU: Rating (étoiles et nombre) */
.product-rating {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 600;
}

.product-rating .star {
    color: #FFC107;
    font-size: 0.75rem;
}

/* NOUVEAU: Price and Action Row */
.product-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
}

/* Product Price - COMPACT */
.product-price {
    font-size: 1.1rem;  /* MODIFIÉ: Réduit de 1.2rem à 1.1rem */
    font-weight: 800;
    color: var(--primary-color);
}

/* NOUVEAU: Add Button (bouton +) */
.btn-add {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--secondary-color);
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.2rem;
    font-weight: 300;
}

.btn-add:hover {
    background: var(--primary-color);
    transform: scale(1.1);
}

.btn-add:active {
    transform: scale(0.95);
}

/* Product Stock - MODIFIÉ */
.product-stock {
    font-size: 0.7rem;  /* MODIFIÉ: Réduit de 0.75rem à 0.7rem */
    color: var(--success-color);
    font-weight: 600;  /* MODIFIÉ: Augmenté de 500 à 600 */
    display: flex;
    align-items: center;
    gap: 4px;
}

.product-stock.out-of-stock {
    color: var(--error-color);
}

/* ==================== SCROLL HORIZONTAL CATEGORIES ==================== */
.horizontal-scroll::-webkit-scrollbar {
    height: 8px;
}

.horizontal-scroll::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 4px;
}

.horizontal-scroll::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}

.horizontal-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Staggered animation for cards */
.product-card {
    animation: slideInUp 0.4s ease backwards;
}

.product-card:nth-child(1) { animation-delay: 0.05s; }
.product-card:nth-child(2) { animation-delay: 0.1s; }
.product-card:nth-child(3) { animation-delay: 0.15s; }
.product-card:nth-child(4) { animation-delay: 0.2s; }
.product-card:nth-child(5) { animation-delay: 0.25s; }
.product-card:nth-child(6) { animation-delay: 0.3s; }

/* ==================== LOADER ==================== */
.loader {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    gap: 16px;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--border-color);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loader p {
    font-weight: 600;
    color: var(--text-secondary);
}

/* ==================== EMPTY STATE ==================== */
.empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-secondary);
}

.empty-state svg {
    width: 100px;
    height: 100px;
    margin-bottom: 20px;
    opacity: 0.3;
}


/* ==================== BOUTONS DÉCLENCHEURS ==================== */
.modal-trigger-buttons {
    position: fixed;
    bottom: 80px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 999;
}

.modal-trigger-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    border: none;
    border-radius: 50px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    color: white;
}

.modal-trigger-btn .btn-icon {
    font-size: 1.2rem;
}

.modal-trigger-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
}

.about-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.contact-btn {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.help-btn {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

/* ==================== MODAL CONTAINER ==================== */
.oda-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    animation: modalFadeIn 0.3s ease;
}

.oda-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    animation: overlayFadeIn 0.3s ease;
}

.modal-content {
    position: relative;
    width: 90%;
    max-width: 600px;
    max-height: 85vh;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

/* Variantes de couleurs pour chaque modal */
.modal-about {
    border-top: 5px solid #667eea;
}

.modal-contact {
    border-top: 5px solid #f5576c;
}

.modal-help {
    border-top: 5px solid #00f2fe;
}

.modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.modal-close:hover {
    background: #ff4757;
    color: white;
    transform: rotate(90deg) scale(1.1);
}

.modal-close svg {
    width: 20px;
    height: 20px;
}

/* ==================== MODAL HEADER ==================== */
.modal-header {
    text-align: center;
    padding: 40px 30px 20px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
}

.modal-contact .modal-header {
    background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
}

.modal-help .modal-header {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
}

.modal-icon-wrapper {
    display: inline-block;
    margin-bottom: 16px;
}

.modal-main-icon {
    font-size: 4rem;
    display: inline-block;
}

.modal-title {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.modal-contact .modal-title {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.modal-help .modal-title {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ==================== MODAL BODY ==================== */
.modal-body {
    padding: 30px;
    max-height: calc(85vh - 200px);
    overflow-y: auto;
}

.modal-body::-webkit-scrollbar {
    width: 8px;
}

.modal-body::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
}

.modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

/* ==================== INFO CARDS ==================== */
.info-card, .help-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
}

.info-card:hover, .help-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.info-card {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.info-icon, .help-icon {
    font-size: 2.5rem;
    flex-shrink: 0;
}

.info-content h3, .help-content h3 {
    font-size: 1.2rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.info-content p, .help-content p {
    color: #4a5568;
    line-height: 1.6;
    margin-bottom: 12px;
}

.steps-list, .objectives-list, .benefits-list {
    margin: 16px 0;
    padding-left: 20px;
}

.steps-list li, .objectives-list li, .benefits-list li {
    margin-bottom: 12px;
    color: #4a5568;
    line-height: 1.6;
}

/* ==================== COLOR BADGES ==================== */
.color-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
    margin: 0 4px;
}

.color-badge.red {
    background: rgba(239, 68, 68, 0.2);
    color: #dc2626;
}

.color-badge.blue {
    background: rgba(59, 130, 246, 0.2);
    color: #2563eb;
}

.color-badge.green {
    background: rgba(16, 185, 129, 0.2);
    color: #059669;
}

.color-badge.yellow {
    background: rgba(245, 158, 11, 0.2);
    color: #d97706;
}

/* ==================== FUN FACT BOX ==================== */
.fun-fact {
    background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 24px;
    box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
}

.fact-icon {
    font-size: 2.5rem;
}

.fun-fact p {
    margin: 0;
    color: #2d3436;
    font-size: 1rem;
}

/* ==================== CREATOR SECTION ==================== */
.creator-story {
    background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    border-left: 5px solid #f5576c;
}

.creator-story h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

.creator-story p {
    color: #4a5568;
    line-height: 1.8;
    margin-bottom: 16px;
}

.creator-info {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
}

.creator-info h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

/* ==================== IMAGE PLACEHOLDER ==================== */
.creator-image-zone {
    margin: 24px 0;
}

.image-placeholder {
    background: linear-gradient(135deg, #e0e7ff 0%, #f3e7ff 100%);
    border-radius: 16px;
    padding: 60px 20px;
    text-align: center;
    border: 3px dashed #a78bfa;
}

.placeholder-icon {
    font-size: 4rem;
    display: block;
    margin-bottom: 12px;
}

.image-placeholder p {
    color: #6b7280;
    font-weight: 600;
    margin: 0;
}

.image-placeholder img {
    max-width: 100%;
    border-radius: 16px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
}

/* ==================== CONTACT DETAILS ==================== */
.contact-details {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
}

.contact-details h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: #1a1a1a;
}

.contact-grid {
    display: grid;
    gap: 16px;
}

.contact-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.contact-item:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: translateX(8px);
}

.contact-icon {
    font-size: 1.8rem;
    flex-shrink: 0;
}

.contact-item strong {
    display: block;
    font-size: 0.85rem;
    color: #6b7280;
    margin-bottom: 4px;
}

.contact-item p, .contact-item a {
    color: #1a1a1a;
    font-weight: 600;
    margin: 0;
    text-decoration: none;
}

.contact-item a:hover {
    color: #f5576c;
}

/* ==================== ALERT & TIP BOXES ==================== */
.alert-box {
    background: rgba(16, 185, 129, 0.1);
    border-left: 4px solid #10b981;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.alert-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.alert-box p {
    margin: 0;
    color: #047857;
    font-weight: 500;
}

.tip-box {
    background: rgba(245, 158, 11, 0.1);
    border-left: 4px solid #f59e0b;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.tip-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.tip-box p {
    margin: 0;
    color: #92400e;
    font-weight: 500;
}

/* ==================== VENDOR SECTION ==================== */
.vendor-section {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
    border-radius: 16px;
    padding: 24px;
    margin-top: 24px;
    text-align: center;
}

.vendor-section h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #1a1a1a;
}

.vendor-section p {
    color: #4a5568;
    margin-bottom: 12px;
}

/* ==================== DOWNLOAD BUTTON ==================== */
.download-btn {
    display: flex;
    align-items: center;
    gap: 16px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 18px 28px;
    border-radius: 16px;
    text-decoration: none;
    margin: 24px auto;
    max-width: 400px;
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: pulseGlow 2s ease-in-out infinite;
}

.download-btn:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 35px rgba(79, 172, 254, 0.5);
}

.btn-icon-left, .btn-icon-right {
    font-size: 1.8rem;
}

.btn-text-main {
    flex: 1;
    text-align: left;
}

.btn-text-main strong {
    display: block;
    font-size: 1.1rem;
    margin-bottom: 4px;
}

.btn-text-main small {
    display: block;
    font-size: 0.85rem;
    opacity: 0.9;
}

/* ==================== VENDOR BENEFITS ==================== */
.vendor-benefits {
    margin-top: 24px;
    text-align: left;
}

.vendor-benefits h4 {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
    text-align: center;
}

.benefits-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.benefit-item {
    background: rgba(255, 255, 255, 0.8);
    padding: 12px 16px;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    color: #1a1a1a;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

/* ==================== FAQ SECTION ==================== */
.faq-section {
    background: rgba(255, 255, 255, 0.6);
    border-radius: 16px;
    padding: 24px;
}

.faq-section h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: #1a1a1a;
}

.faq-item {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.faq-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.faq-item strong {
    display: block;
    font-size: 1rem;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.faq-item p {
    color: #4a5568;
    line-height: 1.6;
    margin: 0;
}

.faq-item a {
    color: #4facfe;
    text-decoration: none;
    font-weight: 600;
}

.faq-item a:hover {
    text-decoration: underline;
}

/* ==================== ANIMATIONS ==================== */
@keyframes modalFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes overlayFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes modalSlideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slide-in {
    from {
        transform: translateX(-30px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.slide-in {
    animation: slide-in 0.6s ease forwards;
}

@keyframes pulse-animation {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

.pulse-animation {
    animation: pulse-animation 2s ease-in-out infinite;
}

@keyframes rotate-animation {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.rotate-animation:hover {
    animation: rotate-animation 1s ease-in-out;
}

@keyframes shake-animation {
    0%, 100% {
        transform: translateX(0);
    }
    25% {
        transform: translateX(-10px);
    }
    75% {
        transform: translateX(10px);
    }
}

.shake-animation:hover {
    animation: shake-animation 0.5s ease;
}

@keyframes bounce-animation {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.bounce-animation {
    animation: bounce-animation 2s ease-in-out infinite;
}

@keyframes pulseGlow {
    0%, 100% {
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
    }
    50% {
        box-shadow: 0 8px 35px rgba(79, 172, 254, 0.6);
    }
}

/* ==================== TOAST NOTIFICATIONS ==================== */
.toast-container {
    position: fixed;
    top: 90px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 350px;
}

.toast {
    background: white;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideInRight 0.3s ease;
    border-left: 4px solid var(--primary-color);
}

.toast.success {
    border-left-color: var(--success-color);
}

.toast.error {
    border-left-color: var(--error-color);
}

@keyframes slideInRight {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .main-header {
        padding: 10px 12px;
    }

    .logo {
        font-size: 1.1rem;
    }

    .icon-btn {
        width: 36px;
        height: 36px;
    }

    .search-container {
        padding: 8px 0 0;
    }

    .hero-carousel {
        height: 350px;
        margin-top: 130px;
        border-radius: 16px;
        margin-left: 12px;
        margin-right: 12px;
    }

    .hero-message {
        top: 20px;
        left: 20px;
        right: 20px;
    }

    .hero-message h2 {
        font-size: 1.3rem;
    }

    .hero-message p {
        font-size: 0.9rem;
    }

    .banner-actions {
        bottom: 60px;
        gap: 12px;
    }

    .banner-btn {
        padding: 12px 16px;
        min-width: 80px;
        font-size: 0.8rem;
    }

    .banner-icon {
        font-size: 1.5rem;
    }

    .carousel-overlay {
        padding: 20px;
    }

    .carousel-info h2 {
        font-size: 1.3rem;
    }

    .carousel-info .product-price {
        font-size: 1.3rem;
    }

    .carousel-btn {
        width: 40px;
        height: 40px;
    }

    .carousel-btn.prev {
        left: 10px;
    }

    .carousel-btn.next {
        right: 10px;
    }

    .products-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .tabs-nav {
        overflow-x: auto;
        justify-content: flex-start;
        padding: 12px 16px;
        top: 130px;
        margin: 16px 12px;
    }

    .tab-btn {
        padding: 10px 20px;
        font-size: 0.85rem;
        white-space: nowrap;
    }
    
    .modal-content {
        width: 95%;
        max-height: 90vh;
        border-radius: 20px;
    }
    
    .modal-header {
        padding: 30px 20px 16px;
    }
    
    .modal-title {
        font-size: 1.5rem;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .info-card, .help-card {
        flex-direction: column;
        padding: 20px;
    }
    
    .contact-grid {
        grid-template-columns: 1fr;
    }
    
    .benefits-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-trigger-buttons {
        bottom: 70px;
        right: 16px;
    }
    
    .modal-trigger-btn {
        padding: 10px 16px;
        font-size: 0.9rem;
    }
    
    .download-btn {
        flex-direction: column;
        text-align: center;
        padding: 20px;
    }
    
    .btn-text-main {
        text-align: center;
    }
}

@media (max-width: 480px) {
    .hero-carousel {
        height: 300px;
        margin-top: 120px;
    }

    .banner-actions {
        flex-direction: row;
        gap: 8px;
        bottom: 50px;
    }

    .banner-btn {
        padding: 10px 12px;
        min-width: 70px;
        font-size: 0.75rem;
    }

    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .modal-main-icon {
        font-size: 3rem;
    }
    
    .info-icon, .help-icon {
        font-size: 2rem;
    }
    
    .modal-trigger-btn .btn-text {
        display: none;
    }
    
    .modal-trigger-btn {
        width: 50px;
        height: 50px;
        padding: 0;
        justify-content: center;
    }
    
    .modal-trigger-btn .btn-icon {
        font-size: 1.5rem;
    }
}

/* ==================== RESPONSIVE DESIGN FOR PRODUCTS ==================== */

/* Tablets */
@media (min-width: 640px) {
    .products-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
    }
}

/* Desktop Small */
@media (min-width: 1024px) {
    .products-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
    }
    
    .product-name {
        font-size: 0.9rem;
    }
    
    .product-price {
        font-size: 1.2rem;
    }
}

/* Desktop Large */
@media (min-width: 1280px) {
    .products-grid {
        grid-template-columns: repeat(5, 1fr);
    }
}

/* ==================== LIKES ET COMMENTAIRES ==================== */

/* Engagement buttons sur les cartes produits */
.product-engagement {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 8px 0;
}

.btn-like,
.btn-comments {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 6px 12px;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-like:hover,
.btn-comments:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.btn-like.liked {
    background: #FFE5E5;
    border-color: var(--error-color);
    color: var(--error-color);
}

.btn-like .like-icon {
    font-size: 1rem;
}

/* ==================== MODAL COMMENTAIRES ==================== */
.comments-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-backdrop {
    position: fixed;           /* ← fixed au lieu de absolute */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 0;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(50px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Stats du produit */
.modal-stats {
    display: flex;
    justify-content: space-around;
    padding: 20px;
    background: var(--bg-secondary);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.stat-icon {
    font-size: 1.5rem;
}

.stat-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* Formulaire de commentaire */
.comment-form {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
}

.comment-form h4 {
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
}

.rating-input {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}

.rating-input input[type="radio"] {
    display: none;
}

.rating-input label {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.rating-input label:hover {
    transform: scale(1.1);
}

.rating-input input:checked + .star {
    filter: drop-shadow(0 2px 4px rgba(255, 107, 0, 0.5));
}

.rating-input .star {
    font-size: 0.9rem;
}

.comment-form textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.95rem;
    resize: vertical;
    min-height: 80px;
    margin-bottom: 12px;
    transition: border-color 0.3s ease;
}

.comment-form textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}

.btn-submit {
    width: 100%;
    padding: 12px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-submit:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.btn-submit:active {
    transform: translateY(0);
}

/* Liste des commentaires */
.comments-list {
    padding: 20px;
}

.comments-list h4 {
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
}

.empty-comments {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-comments p:first-child {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.comment-item {
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.comment-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.comment-user {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.9rem;
}

.user-name {
    font-weight: 600;
    color: var(--text-primary);
}

.comment-rating {
    font-size: 0.85rem;
}

.comment-text {
    margin: 8px 0;
    line-height: 1.6;
    color: var(--text-primary);
}

.comment-date {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* ==================== MODAL PARAMÈTRES ==================== */
.settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.settings-modal.active {
    display: flex;
}
.settings-modal-content {
    position: relative;
    background: white;
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
    z-index: 1;               
}

.settings-header {
    background: linear-gradient(135deg, #FF6B00, #E55D00);
    color: white;
    padding: 24px;
    border-radius: 20px 20px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 10;
}

.settings-header h2 {
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0;
}

.settings-header .btn-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.settings-header .btn-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.settings-body {
    padding: 24px;
    background: white;
}

.settings-section {
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 2px solid var(--border-color);
}

.settings-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.section-icon {
    font-size: 1.5rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.label-badge {
    padding: 4px 12px;
    background: var(--success-color);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
    transition: all 0.3s ease;
}

.label-badge.disabled {
    background: var(--error-color);
}

.form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 0.95rem;
    font-family: inherit;
    transition: all 0.3s ease;
    background: white;
    color: var(--text-primary);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
}

.form-input:read-only {
    background: var(--bg-secondary);
    cursor: not-allowed;
}

.form-hint {
    display: block;
    margin-top: 8px;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.btn-primary {
    padding: 12px 24px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    background: #ccc;
}

.btn-danger {
    width: 100%;
    padding: 14px 20px;
    background: var(--error-color);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-danger:hover {
    background: #DC2626;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-danger:active {
    transform: translateY(0);
}

/* Toggle Switch */
.settings-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.settings-toggle:hover {
    background: var(--border-color);
    transform: translateX(4px);
}

.toggle-info {
    flex: 1;
}

.toggle-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
    font-size: 0.95rem;
}

.toggle-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

.switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 28px;
    flex-shrink: 0;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 28px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked + .slider {
    background-color: var(--primary-color);
}

input:focus + .slider {
    box-shadow: 0 0 1px var(--primary-color);
}

input:checked + .slider:before {
    transform: translateX(24px);
}

/* Scrollbar personnalisée pour le modal */
.settings-modal-content::-webkit-scrollbar {
    width: 8px;
}

.settings-modal-content::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 0 0 20px 0;
}

.settings-modal-content::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 10px;
}

.settings-modal-content::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* Responsive */
@media (max-width: 768px) {
    .settings-modal {
        padding: 0;
        align-items: flex-end;
    }
    
    .settings-modal-content {
        max-height: 95vh;
        border-radius: 20px 20px 0 0;
        animation: slideUpModal 0.3s ease;
    }
    
    .settings-header {
        border-radius: 20px 20px 0 0;
        padding: 20px;
    }
    
    .settings-header h2 {
        font-size: 1.2rem;
    }
    
    .settings-body {
        padding: 20px 16px;
    }
    
    .settings-section {
        margin-bottom: 24px;
        padding-bottom: 20px;
    }
    
    .settings-toggle {
        padding: 14px;
    }
}

@keyframes slideUpModal {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Mode sombre (optionnel) */
body.dark-mode {
    background: #1a1a1a;
    color: #ffffff;
}

body.dark-mode .settings-modal-content {
    background: #2d2d2d;
}

body.dark-mode .settings-body {
    background: #2d2d2d;
}

body.dark-mode .settings-toggle {
    background: #3a3a3a;
}

body.dark-mode .settings-toggle:hover {
    background: #4a4a4a;
}

body.dark-mode .form-input {
    background: #3a3a3a;
    border-color: #4a4a4a;
    color: white;
}

body.dark-mode .form-input:read-only {
    background: #2a2a2a;
}

body.dark-mode .toggle-title {
    color: white;
}

body.dark-mode .toggle-desc {
    color: #aaa;
}

body.dark-mode .section-header h3 {
    color: white;
}

/* Structure du menu - 3 sections */
.side-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 85%;
    max-width: 320px;
    height: 100vh;
    background: var(--bg-primary);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    z-index: 2000;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.side-menu.active {
    left: 0;
}

/* Header - FIXE */
.menu-header {
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 0, 0.2);
}

.menu-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-close:active {
    transform: rotate(90deg) scale(0.9);
}

/* Contenu du menu */
.menu-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Section Catégories - SCROLLABLE */
.menu-section.categories-section {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 20px;
    border-bottom: 2px solid var(--border-color);
    position: relative;
}

/* Personnalisation de la scrollbar */
.menu-section.categories-section::-webkit-scrollbar {
    width: 6px;
}

.menu-section.categories-section::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 10px;
}

.menu-section.categories-section::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--primary-color), var(--primary-dark));
    border-radius: 10px;
}

.menu-section.categories-section::-webkit-scrollbar-thumb:hover {
    background: var(--primary-color);
}

/* Sections Navigation et Informations - FIXES */
.menu-section.fixed-section {
    flex-shrink: 0;
    padding: 16px 20px;
    background: var(--bg-primary);
}

.menu-section h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Liste de catégories */
.category-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.category-item {
    padding: 14px 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 12px;
    z-index: -1;
}

.category-item:hover::before {
    width: 100%;
}

.category-item:hover {
    color: white;
    transform: translateX(5px);
}

.category-item:active {
    transform: translateX(5px) scale(0.98);
}

.category-item.active {
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    color: white;
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.category-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    padding: 0 10px;
    background: rgba(255, 107, 0, 0.15);
    color: var(--primary-color);
    font-size: 0.8rem;
    font-weight: 700;
    border-radius: 14px;
    margin-left: auto;
    transition: all 0.3s ease;
}

.category-item.active .category-badge,
.category-item:hover .category-badge {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}

/* Liens du menu */
.menu-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    margin-bottom: 8px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.menu-link::before {
    content: '';
    position: absolute;
    left: -100%;
    top: 0;
    height: 100%;
    width: 4px;
    background: var(--primary-color);
    transition: left 0.3s ease;
}

.menu-link:hover::before {
    left: 0;
}

.menu-link:hover {
    background: rgba(255, 107, 0, 0.05);
    transform: translateX(4px);
}

.menu-link:active {
    transform: translateX(4px) scale(0.98);
}

.menu-link svg {
    flex-shrink: 0;
    transition: transform 0.3s ease;
}

.menu-link:hover svg {
    transform: scale(1.1);
}

/* Overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1500;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.overlay.active {
    opacity: 1;
    visibility: visible;
}

/* Responsive */
@media (min-width: 640px) {
    .side-menu {
        max-width: 400px;
    }
}

/* Indicateur de scroll */
.scroll-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: linear-gradient(to top, var(--bg-primary), transparent);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 10px;
}

.scroll-indicator::after {
    content: '⬇';
    font-size: 1.2rem;
    color: var(--primary-color);
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.menu-section.categories-section.has-scroll .scroll-indicator {
    opacity: 1;
}

.category-list {
    scroll-behavior: smooth;
}

.category-new {
    background: var(--success-color);
    color: white;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    font-weight: 700;
}
/* ====== BOUTON VENDEUR ODA ====== */
.oda-vendor-btn {
    border: 2px solid rgba(255,255,255,0.3) !important;
    border-radius: 10px !important;
    transition: all 0.3s !important;
}
.oda-vendor-btn:hover {
    border-color: var(--primary-color) !important;
    background: rgba(255,107,0,0.15) !important;
}
.oda-vendor-btn.connected {
    border-color: #10b981 !important;
    box-shadow: 0 0 0 2px rgba(16,185,129,0.3) !important;
}

/* ====== MODAL ODA VENDEUR ====== */
.oda-modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 99999;
    display: flex;
    align-items: flex-start;
    justify-content: flex-end;
    padding-top: 70px;
    padding-right: 16px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
}
.oda-modal-overlay.active {
    pointer-events: all;
    opacity: 1;
}
.oda-modal-overlay .backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.2);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
}
.oda-modal-box {
    position: relative;
    z-index: 1;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 20px;
    padding: 28px 24px;
    width: 280px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    transform: translateY(-10px) scale(0.96);
    transition: all 0.25s cubic-bezier(0.34,1.4,0.64,1);
    text-align: center;
}
.oda-modal-overlay.active .oda-modal-box {
    transform: translateY(0) scale(1);
}
.oda-modal-logo {
    width: 64px;
    height: 64px;
    border-radius: 16px;
    object-fit: cover;
    margin: 0 auto 14px;
    display: block;
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
}
.oda-modal-title {
    font-size: 1rem;
    font-weight: 700;
    color: white;
    margin-bottom: 4px;
    text-shadow: 0 1px 4px rgba(0,0,0,0.3);
}
.oda-modal-sub {
    font-size: 0.78rem;
    color: rgba(255,255,255,0.75);
    margin-bottom: 20px;
    line-height: 1.4;
}
.oda-connect-btn {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255,255,255,0.95);
    color: #1a1a1a;
    border: none;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    font-family: 'Inter', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}
.oda-connect-btn:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
.oda-connect-btn img {
    width: 20px;
    height: 20px;
    border-radius: 5px;
}
.oda-divider {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 14px 0;
    color: rgba(255,255,255,0.4);
    font-size: 0.72rem;
}
.oda-divider::before, .oda-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255,255,255,0.2);
}
.oda-no-account {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.6);
    line-height: 1.5;
}
.oda-no-account a {
    color: rgba(255,255,255,0.9);
    font-weight: 600;
    text-decoration: underline;
    cursor: pointer;
}
/* État connecté */
.oda-connected-state .oda-modal-title { font-size: 0.85rem; color: rgba(255,255,255,0.8); font-weight:500; }
.oda-user-avatar {
    width: 48px; height: 48px;
    background: linear-gradient(135deg, #FF6B00, #e55d00);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.3rem; font-weight: 800; color: white;
    margin: 0 auto 10px;
    box-shadow: 0 4px 14px rgba(255,107,0,0.4);
}
.oda-sandbox-btn {
    width: 100%;
    padding: 12px 16px;
    background: linear-gradient(135deg, #FF6B00, #e55d00);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    font-family: 'Inter', sans-serif;
    transition: all 0.2s;
    box-shadow: 0 4px 14px rgba(255,107,0,0.35);
    margin-bottom: 8px;
}
.oda-sandbox-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,107,0,0.5); }
.oda-logout-link {
    font-size: 0.75rem;
    color: rgba(255,255,255,0.5);
    cursor: pointer;
    text-decoration: underline;
    background: none;
    border: none;
    font-family: 'Inter', sans-serif;
    transition: color 0.2s;
}
.oda-logout-link:hover { color: rgba(255,255,255,0.8); }
@keyframes bounceIn {
    0%{transform:scale(0);opacity:0}
    60%{transform:scale(1.2)}
    100%{transform:scale(1);opacity:1}
}
@keyframes pulse {
    0%{box-shadow:0 0 0 0 rgba(255,107,0,0.7)}
    70%{box-shadow:0 0 0 20px rgba(255,107,0,0)}
    100%{box-shadow:0 0 0 0 rgba(255,107,0,0)}
}
@keyframes confettiFall {
    0%{transform:translateY(-10px) rotate(0deg);opacity:1}
    100%{transform:translateY(100vh) rotate(720deg);opacity:0}
}
@keyframes odaFadeIn {
    from{opacity:0;transform:translateY(-8px) scale(0.97)}
    to{opacity:1;transform:translateY(0) scale(1)}
}
.oda-form-input {
    width:100%;
    padding:11px 14px;
    background:rgba(255,255,255,0.15);
    border:1.5px solid rgba(255,255,255,0.3);
    border-radius:10px;
    font-size:0.88rem;
    color:white;
    font-family:'Inter',sans-serif;
    outline:none;
    transition:all 0.2s;
    margin-bottom:10px;
}
.oda-form-input::placeholder{color:rgba(255,255,255,0.55);}
.oda-form-input:focus{
    border-color:rgba(255,255,255,0.7);
    background:rgba(255,255,255,0.22);
}
.oda-form-error {
    background:rgba(239,68,68,0.2);
    border:1px solid rgba(239,68,68,0.4);
    color:#fca5a5;
    padding:8px 12px;
    border-radius:8px;
    font-size:0.78rem;
    margin-bottom:10px;
    display:none;
    text-align:left;
}
.oda-form-error.show{display:block;}
.oda-update-banner {
    position: fixed;
    bottom: -120px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 32px);
    max-width: 480px;
    background: #2C3E50;
    color: white;
    border-radius: 16px;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 14px;
    z-index: 99999;
    box-shadow: 0 -4px 30px rgba(0,0,0,0.25), 0 0 0 2px rgba(255,107,0,0.4);
    transition: bottom 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.oda-update-banner.visible {
    bottom: 24px;
}

.oda-update-icon {
    font-size: 2rem;
    flex-shrink: 0;
    animation: odaBounce 1.2s ease infinite;
}

@keyframes odaBounce {
    0%, 100% { transform: translateY(0); }
    50%       { transform: translateY(-4px); }
}

.oda-update-text {
    flex: 1;
    min-width: 0;
}

.oda-update-title {
    font-weight: 700;
    font-size: 0.95rem;
    margin-bottom: 2px;
}

.oda-update-sub {
    font-size: 0.78rem;
    opacity: 0.7;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.oda-update-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.oda-btn-update {
    background: #FF6B00;
    color: white;
    border: none;
    padding: 9px 18px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.oda-btn-update:hover {
    background: #E55D00;
    transform: scale(1.05);
}

.oda-btn-dismiss {
    background: rgba(255,255,255,0.12);
    color: white;
    border: none;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    flex-shrink: 0;
}

.oda-btn-dismiss:hover {
    background: rgba(255,255,255,0.22);
}

</style>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p>Chargement des produits...</p>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <button class="menu-btn" id="menuBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
            
            <div class="logo">
                🛍️ Odamarket
            </div>
            
            <div class="header-icons">
                <button class="icon-btn" onclick="window.location.href='favorie.html'">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    <span class="badge" id="favBadge">0</span>
                </button>
                
                <!-- NOUVEAU BOUTON PARAMÈTRES -->
                <button class="icon-btn" id="settingsBtn" title="Paramètres">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
                <button class="icon-btn oda-vendor-btn" id="vendorBtn" title="Se connecter - Espace Vendeur" onclick="ouvrirModalOda()">
                    <img src="oda-logo.png" alt="ODA" style="width:26px;height:26px;border-radius:6px;object-fit:cover;">
                </button>
                
               
            </div>
        </div>
        
        <!-- Barre de recherche -->
        <div class="search-container">
            <div class="search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" placeholder="Rechercher des produits, boutiques..." id="searchInput">
            </div>
        </div>
        <div class="oda-modal-overlay" id="odaModalOverlay">
            <div class="backdrop" onclick="fermerOdaModal()"></div>
            <div class="oda-modal-box" id="odaModalBox">
                <!-- Contenu injecté dynamiquement -->
            </div>
        </div>
    </header>
   <!-- Menu latéral avec structure améliorée -->
   <div class="side-menu" id="sideMenu">
    <!-- Header - FIXE -->
    <div class="menu-header">
        <h2>
            <span>📂</span>
            <span>Menu</span>
        </h2>
        <button class="btn-close" id="closeMenuBtn" aria-label="Fermer le menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>
    
    <div class="menu-content">
        <!-- Section Catégories - SCROLLABLE -->
        <div class="menu-section categories-section" id="categoriesSection">
            <h3>
                <span>🏷️</span>
                <span>Catégories</span>
            </h3>
            <div class="category-list" id="categoryList">
                <!-- Généré dynamiquement par JavaScript -->
                <div class="category-item active" data-category="Tous">
                    <span>Tous les produits</span>
                    <span class="category-badge">0</span>
                </div>
            </div>
            <div class="scroll-indicator"></div>
        </div>
        
        <!-- Section Navigation - FIXE -->
        <div class="menu-section fixed-section">
            <h3>
                <span>🧭</span>
                <span>Navigation</span>
            </h3>
            <a href="oda-achats.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
                    <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
                </svg>
                Accueil
            </a>
            <a href="favorie.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
                </svg>
                Mes Favoris
            </a>
            <a href="boutiques.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z" stroke="currentColor" stroke-width="2"/>
                    <path d="M3 9l1.5-5h15L21 9M9 13v4m6-4v4" stroke="currentColor" stroke-width="2"/>
                </svg>
                Boutiques
            </a>
        </div>
        
        <!-- Section Informations - FIXE -->
        <div class="menu-section fixed-section">
            <h3>
                <span>ℹ️</span>
                <span>Informations</span>
            </h3>
            <a href="#" class="menu-link" id="aboutLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 16v-4M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                À propos
            </a>
            <a href="#" class="menu-link" id="contactLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Contact
            </a>
            <a href="#" class="menu-link" id="helpLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3m.08 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Aide
            </a>
        </div>
    </div>
</div>

<div id="aboutModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('aboutModal')"></div>
    <div class="modal-content modal-about">
        <button class="modal-close" onclick="closeModal('aboutModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper pulse-animation">
                <span class="modal-main-icon">🏪</span>
            </div>
            <h2 class="modal-title">À propos de ODA Market</h2>
        </div>
        
        <div class="modal-body">
            <div class="info-card slide-in">
                <div class="info-icon">🌍</div>
                <div class="info-content">
                    <h3>D'où viennent nos produits ?</h3>
                    <p>ODA Market collabore avec des <strong>vendeurs locaux</strong> passionnés du Cameroun 🇨🇲 
                    et d'ailleurs ! Chaque produit provient de <strong>boutiques vérifiées</strong> qui s'engagent 
                    à offrir qualité et authenticité ✨</p>
                </div>
            </div>
            
            <div class="info-card slide-in" style="animation-delay: 0.1s">
                <div class="info-icon">⚙️</div>
                <div class="info-content">
                    <h3>Comment ça fonctionne ?</h3>
                    <p>C'est simple comme bonjour ! 😊</p>
                    <ol class="steps-list">
                        <li>🔍 <strong>Explorez</strong> des milliers de produits</li>
                        <li>❤️ <strong>Ajoutez</strong> vos favoris</li>
                        <li>🛒 <strong>Contactez</strong> directement le vendeur</li>
                        <li>💳 <strong>Payez</strong> en ligne ou en boutique</li>
                        <li>📦 <strong>Recevez</strong> votre commande !</li>
                    </ol>
                </div>
            </div>
            
            <div class="info-card slide-in" style="animation-delay: 0.2s">
                <div class="info-icon">🎨</div>
                <div class="info-content">
                    <h3>Variations de couleurs</h3>
                    <p>Certains produits sont disponibles en <span class="color-badge red">rouge</span>, 
                    <span class="color-badge blue">bleu</span>, <span class="color-badge green">vert</span>, 
                    <span class="color-badge yellow">jaune</span> et bien plus encore ! 🌈 
                    Contactez le vendeur pour confirmer la disponibilité de votre couleur préférée 🎯</p>
                </div>
            </div>
            
            <div class="fun-fact bounce-animation">
                <span class="fact-icon">💡</span>
                <p><strong>Le saviez-vous ?</strong> Plus de <strong>1000+ produits</strong> disponibles sur ODA Market ! 🚀</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal 2: Contact -->
<div id="contactModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('contactModal')"></div>
    <div class="modal-content modal-contact">
        <button class="modal-close" onclick="closeModal('contactModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper rotate-animation">
                <span class="modal-main-icon">👨‍💻</span>
            </div>
            <h2 class="modal-title">Rencontrez le créateur</h2>
        </div>
        
        <div class="modal-body">
            <div class="creator-story slide-in">
                <h3>🎭 L'histoire d'ODA (version amusante)</h3>
                <p>Il était une fois, un développeur nommé <strong>Yann</strong> qui en avait marre de chercher 
                des produits pendant des heures sur Internet... 😫</p>
                
                <p>Un jour, en buvant son café ☕, il se dit : <em>"Et si je créais une plateforme où TOUT 
                le monde pourrait vendre et acheter facilement ?"</em></p>
                
                <p>Et BOUM 💥 ! ODA Market est né ! Aujourd'hui, des milliers de personnes trouvent leur bonheur 
                en quelques clics. La morale ? <strong>Ne sous-estimez jamais le pouvoir d'un café !</strong> 🚀😄</p>
            </div>
            
            <div class="creator-info slide-in" style="animation-delay: 0.1s">
                <h3>🎯 Les objectifs d'ODA</h3>
                <ul class="objectives-list">
                    <li>🌟 <strong>Connecter</strong> acheteurs et vendeurs facilement</li>
                    <li>💪 <strong>Soutenir</strong> l'économie locale camerounaise</li>
                    <li>🔒 <strong>Garantir</strong> des transactions sécurisées</li>
                    <li>🚀 <strong>Révolutionner</strong> le e-commerce au Cameroun</li>
                    <li>❤️ <strong>Créer</strong> une communauté de confiance</li>
                </ul>
            </div>
            
            <!-- Zone pour image du créateur -->
            <div class="creator-image-zone slide-in" style="animation-delay: 0.2s">
                <!-- Ajoutez votre image ici en remplaçant le commentaire ci-dessous -->
                <div class="image-container" style="
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                padding: 20px;
            ">
                <img src="p2.jpg" 
                     alt="Photo du créateur" 
                     class="creator-photo"
                     style="
                        width: 200px;
                        height: 200px;
                        object-fit: cover;
                        border-radius: 50%;
                        border: 3px solid #007bff;
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                        transition: transform 0.3s ease;
                     "
                     onmouseover="this.style.transform='scale(1.05)'"
                     onmouseout="this.style.transform='scale(1)'">
                <p style="
                    margin: 0;
                    font-size: 16px;
                    color: #333;
                    font-weight: 500;
                ">yann jordy</p>
            </div>
            </div>
            
            <div class="contact-details slide-in" style="animation-delay: 0.3s">
                <h3>📬 Informations de contact</h3>
                <div class="contact-grid">
                    <div class="contact-item">
                        <span class="contact-icon">👤</span>
                        <div>
                            <strong>Nom complet</strong>
                            <p>Kitio Guemeve Yann Jordy</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">📧</span>
                        <div>
                            <strong>Email</strong>
                            <a href="mailto:jordyguemeveyann@gmail.com">jordyguemeveyann@gmail.com</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">📱</span>
                        <div>
                            <strong>WhatsApp</strong>
                            <a href="https://wa.me/237698111771" target="_blank">+237 698 111 771</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">💼</span>
                        <div>
                            <strong>Portfolio</strong>
                            <a href="https://kitio-yann-port-folio.vercel.app" target="_blank">kitio-yann-port-folio.vercel.app</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal 3: Aide -->
<div id="helpModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('helpModal')"></div>
    <div class="modal-content modal-help">
        <button class="modal-close" onclick="closeModal('helpModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper shake-animation">
                <span class="modal-main-icon">🆘</span>
            </div>
            <h2 class="modal-title">Centre d'aide</h2>
        </div>
        
        <div class="modal-body">
            <div class="help-card slide-in">
                <div class="help-icon">⏳</div>
                <div class="help-content">
                    <h3>Paiement en ligne</h3>
                    <p><strong>⚠️ Important :</strong> Lors d'un paiement direct en ligne, veuillez <strong>patienter</strong> 
                    quelques instants ⏱️ pendant le traitement de votre transaction. Ne fermez pas la page ! 🚫</p>
                    <div class="alert-box">
                        <span class="alert-icon">✅</span>
                        <p>Vous recevrez une confirmation par email et SMS une fois le paiement validé 📧📱</p>
                    </div>
                </div>
            </div>
            
            <div class="help-card slide-in" style="animation-delay: 0.1s">
                <div class="help-icon">🔐</div>
                <div class="help-content">
                    <h3>Cache Boutique - Identifiant Unique</h3>
                    <p>Chaque boutique possède un <strong>identifiant unique</strong> 🎯 qui garantit :</p>
                    <ul class="benefits-list">
                        <li>✨ L'authenticité du vendeur</li>
                        <li>🔒 La sécurité de vos achats</li>
                        <li>📊 Le suivi de vos commandes</li>
                        <li>⭐ Les avis vérifiés</li>
                    </ul>
                    <div class="tip-box">
                        <span class="tip-icon">💡</span>
                        <p><strong>Astuce :</strong> Vérifiez toujours l'identifiant de la boutique avant d'acheter !</p>
                    </div>
                </div>
            </div>
            
            <div class="vendor-section slide-in" style="animation-delay: 0.2s">
                <h3>🏪 Vous êtes vendeur ?</h3>
                <p>Rejoignez ODA Market et développez votre business ! 📈</p>
                <p>Téléchargez <strong>ODA Seller</strong> - l'application dédiée aux vendeurs 🚀</p>
                
                <a href="https://oda-seller.vercel.app" target="_blank" class="download-btn">
                    <span class="btn-icon-left">📲</span>
                    <span class="btn-text-main">
                        <strong>Télécharger ODA Seller</strong>
                        <small>Gérez votre boutique facilement</small>
                    </span>
                    <span class="btn-icon-right">→</span>
                </a>
                
                <div class="vendor-benefits">
                    <h4>Pourquoi ODA Seller ?</h4>
                    <div class="benefits-grid">
                        <div class="benefit-item">📊 Gestion simple</div>
                        <div class="benefit-item">💰 Paiements rapides</div>
                        <div class="benefit-item">📱 Application mobile</div>
                        <div class="benefit-item">🎯 Plus de clients</div>
                    </div>
                </div>
            </div>
            
            <div class="faq-section slide-in" style="animation-delay: 0.3s">
                <h3>❓ Questions fréquentes</h3>
                <div class="faq-item">
                    <strong>Comment suivre ma commande ?</strong>
                    <p>Connectez-vous à votre compte et consultez l'onglet "Mes commandes" 📦</p>
                </div>
                <div class="faq-item">
                    <strong>Puis-je retourner un produit ?</strong>
                    <p>Contactez le vendeur dans les 48h pour discuter d'un éventuel retour 🔄</p>
                </div>
                <div class="faq-item">
                    <strong>Besoin d'aide supplémentaire ?</strong>
                    <p>Contactez notre support via WhatsApp : <a href="https://wa.me/237698111771">+237 698 111 771</a> 💬</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Overlay -->
<div class="overlay" id="overlay"></div>



    <!-- Carousel Produits Populaires avec boutons transparents -->
    <section class="hero-carousel" id="heroCarousel">
        <div class="carousel-wrapper">
            <button class="carousel-btn prev" id="btnPrev" aria-label="Précédent">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            
            <div class="carousel-container" id="carouselContainer">
                <!-- Généré dynamiquement -->
            </div>
            
            <button class="carousel-btn next" id="btnNext" aria-label="Suivant">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
    
        <div class="banner-actions">
            <button class="banner-btn" onclick="scrollToProducts()">
                <div class="banner-icon">🎁</div>
                <span>produits</span>
            </button>
            <button class="banner-btn" onclick="window.location.href='favorie.html'">
                <div class="banner-icon">❤️</div>
                <span>favoris</span>
            </button>
            <button class="banner-btn" onclick="window.location.href='boutiques.html'">
                <div class="banner-icon">🏪</div>
                <span>boutique</span>
            </button>
        </div>
        
        <div class="carousel-dots" id="carouselDots"></div>
    </section>

   

    <!-- Grid Produits -->
    <main class="products-container">
        <div class="section-header">
            <h2>Tous les produits</h2>
            <span class="product-count" id="productCount">0 produits</span>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Généré dynamiquement -->
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            <h3>Aucun produit trouvé</h3>
            <p>Revenez plus tard pour découvrir nos nouveaux produits</p>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="settings-modal" id="settingsModal">
        <div class="settings-modal-content">
    
            <!-- HEADER -->
            <div class="settings-header">
                <h2>⚙️ Paramètres</h2>
                <button class="btn-close" id="settingsCloseBtn" aria-label="Fermer">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
    
            <!-- BODY -->
            <div class="settings-body">
    
                <!-- Section Profil -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">👤</span>
                        <h3>Profil utilisateur</h3>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <span>Nom d'utilisateur</span>
                            <span class="label-badge" id="nameChangeBadge">Modifiable</span>
                        </label>
                        <div style="display:flex;gap:8px;">
                            <input type="text" class="form-input" id="userNameInput" placeholder="Votre nom" readonly>
                            <button class="btn-primary" onclick="ouvrirChangementNom()">Modifier</button>
                        </div>
                        <small class="form-hint" id="nameChangeHint">Changement de nom autorisé tous les 3 mois</small>
                    </div>
                </div>
    
                <!-- Section Notifications -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">🔔</span>
                        <h3>Notifications Push</h3>
                    </div>
                    <div id="notificationStatus" style="background:var(--bg-secondary);padding:16px;border-radius:12px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;">
                        <div>
                            <div style="font-weight:600;margin-bottom:4px;">Statut des notifications</div>
                            <div id="notifStatusText" style="font-size:0.9rem;color:var(--text-secondary);">Chargement...</div>
                        </div>
                        <button class="btn-primary" id="enableNotifBtn" onclick="activerNotifications()">Activer</button>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Nouveaux produits</div>
                            <div class="toggle-desc">Être notifié des nouveaux produits</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="notifNewProducts" checked><span class="slider"></span></label>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Promotions</div>
                            <div class="toggle-desc">Recevoir les offres spéciales</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="notifPromotions" checked><span class="slider"></span></label>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Nouveaux commentaires</div>
                            <div class="toggle-desc">Sur les produits que vous suivez</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="notifComments" checked><span class="slider"></span></label>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Produits populaires</div>
                            <div class="toggle-desc">Vos favoris qui deviennent populaires</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="notifPopular" checked><span class="slider"></span></label>
                    </div>
                </div>
    
                <!-- Section Préférences -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">🎨</span>
                        <h3>Préférences</h3>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Mode sombre</div>
                            <div class="toggle-desc">Activer le thème sombre</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="darkMode"><span class="slider"></span></label>
                    </div>
                    <div class="settings-toggle">
                        <div class="toggle-info">
                            <div class="toggle-title">Sons</div>
                            <div class="toggle-desc">Activer les sons de l'application</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="appSounds" checked><span class="slider"></span></label>
                    </div>
                </div>
    
                <!-- Section Données -->
                <div class="settings-section">
                    <div class="section-header">
                        <span class="section-icon">🗑️</span>
                        <h3>Données</h3>
                    </div>
                    <button class="btn-danger" onclick="effacerDonnees()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                        </svg>
                        Effacer toutes mes données
                    </button>
                </div>
    
            </div>
        </div>
    </div>
            
            <!-- ====== ANIMATION FÉLICITATIONS ====== -->
            <div id="odaCelebration" style="
                position:fixed;inset:0;z-index:999999;
                display:none;align-items:center;justify-content:center;
                background:rgba(0,0,0,0.5);backdrop-filter:blur(6px);
                flex-direction:column;gap:16px;
            ">
                <div id="celebrationContent" style="text-align:center;">
                    <div style="font-size:4rem;animation:bounceIn 0.6s ease;">🎉</div>
                    <div style="font-size:1.4rem;font-weight:800;color:white;margin-top:12px;" id="celebrationName"></div>
                    <div style="font-size:0.9rem;color:rgba(255,255,255,0.8);margin-top:6px;">Bienvenue dans votre espace vendeur !</div>
                    <div style="
                        margin-top:20px;width:60px;height:60px;
                        border-radius:50%;background:linear-gradient(135deg,#FF6B00,#e55d00);
                        display:flex;align-items:center;justify-content:center;
                        font-size:1.6rem;margin:20px auto 0;
                        box-shadow:0 0 0 0 rgba(255,107,0,0.7);
                        animation:pulse 1.5s infinite;
                    ">🏪</div>
                </div>
                <div id="celebrationConfetti" style="position:fixed;inset:0;pointer-events:none;overflow:hidden;"></div>
            </div>
            
            <!-- Section Notifications -->
            
<div class="settings-section">
    <div class="section-header">
        <span class="section-icon">🔔</span>
        <h3>Notifications Push</h3>
    </div>
    
    <div id="notificationStatus" style="
        background: var(--bg-secondary);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    ">
        <div>
            <div style="font-weight: 600; margin-bottom: 4px;">Statut des notifications</div>
            <div id="notifStatusText" style="font-size: 0.9rem; color: var(--text-secondary);">
                Chargement...
            </div>
        </div>
        <button class="btn-primary" id="enableNotifBtn" onclick="activerNotifications()">
            Activer
        </button>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Nouveaux produits</div>
            <div class="toggle-desc">Être notifié des nouveaux produits</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifNewProducts" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Promotions</div>
            <div class="toggle-desc">Recevoir les offres spéciales</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifPromotions" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Nouveaux commentaires</div>
            <div class="toggle-desc">Sur les produits que vous suivez</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifComments" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Produits populaires</div>
            <div class="toggle-desc">Vos favoris qui deviennent populaires</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifPopular" checked>
            <span class="slider"></span>
        </label>
    </div>
</div>
            
            <!-- Section Préférences -->
            <div class="settings-section">
                <div class="section-header">
                    <span class="section-icon">🎨</span>
                    <h3>Préférences</h3>
                </div>
                
                <div class="settings-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Mode sombre</div>
                        <div class="toggle-desc">Activer le thème sombre</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="darkMode">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="settings-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Sons</div>
                        <div class="toggle-desc">Activer les sons de l'application</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="appSounds" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <!-- Section Données -->
            <div class="settings-section">
                <div class="section-header">
                    <span class="section-icon">🗑️</span>
                    <h3>Données</h3>
                </div>
                
                <button class="btn-danger" onclick="effacerDonnees()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                    </svg>
                    Effacer toutes mes données
                </button>
            </div>
        </div>
    </div>
</div>
    <script src="notif.js"></script>
<script src="Oda update checker"></script>
<script src="pwa-manager.js"></script>
<script src="connexion-vendeur.js"></script>
<script type="module">


// ==================== CONFIGURATION SUPABASE ====================
const SUPABASE_URL = 'https://xjckbqbqxcwzcrlmuvzf.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqY2ticWJxeGN3emNybG11dnpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTk1MzMsImV4cCI6MjA3NjA5NTUzM30.AMzAUwtjFt7Rvof5r2enMyYIYToc1wNWWEjvZqK_YXM';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ==================== VARIABLES GLOBALES ====================
let allProducts      = [];
let favoriteProducts = new Set();
let productLikes     = {};
let productComments  = {};
let currentFilter    = 'all';
let carouselInterval;
let currentSlide     = 0;
let popularProducts  = [];
let currentUserId    = getUserId();

// ==================== CONFIGURATION APP ====================
const CONFIG = {
    CACHE_DURATION : 5 * 60 * 1000,  // ✅ 5 minutes (plus 7 jours)
    DEBOUNCE_DELAY : 300,
    CAROUSEL_INTERVAL : 5000,
    LOW_STOCK_THRESHOLD : 5,
    NEW_PRODUCT_DAYS : 7,
    RECOMMEND_LIKES : 3,
    TOP_RATING : 4,
    SALE_PRICE : 5000,
    TOP_PERCENT : 0.3,
};

// ==================== CACHE MANAGER (5 minutes) ====================
class CacheManager {
    constructor() {
        this.KEYS = {
            PRODUCTS  : 'oda_products_v3',
            LIKES     : 'oda_likes_v3',
            COMMENTS  : 'oda_comments_v3',
            SHOPS     : 'oda_shops_v3',
            TIMESTAMP : 'oda_cache_ts_v3',
        };
    }

    // ─── Écriture ───────────────────────────────────────────
    save(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify({
                data,
                ts : Date.now(),
                exp: Date.now() + CONFIG.CACHE_DURATION,
            }));
            return true;
        } catch (e) {
            if (e.name === 'QuotaExceededError') this._purge();
            return false;
        }
    }

    saveAll(products, likes, comments, shops) {
        this.save(this.KEYS.PRODUCTS,  products);
        this.save(this.KEYS.LIKES,     likes);
        this.save(this.KEYS.COMMENTS,  comments);
        this.save(this.KEYS.SHOPS,     shops);
        localStorage.setItem(this.KEYS.TIMESTAMP, Date.now().toString());
        console.log('💾 Cache sauvegardé (expire dans 5 min)');
    }

    // ─── Lecture ────────────────────────────────────────────
    load(key) {
        try {
            const raw = localStorage.getItem(key);
            if (!raw) return null;
            const { data, exp } = JSON.parse(raw);
            if (Date.now() > exp) { localStorage.removeItem(key); return null; }
            return data;
        } catch { localStorage.removeItem(key); return null; }
    }

    loadAll() {
        return {
            products : this.load(this.KEYS.PRODUCTS),
            likes    : this.load(this.KEYS.LIKES),
            comments : this.load(this.KEYS.COMMENTS),
            shops    : this.load(this.KEYS.SHOPS),
        };
    }

    // ─── Validité ───────────────────────────────────────────
    isValid() {
        return [this.KEYS.PRODUCTS, this.KEYS.LIKES, this.KEYS.COMMENTS, this.KEYS.SHOPS]
            .every(k => {
                try {
                    const raw = localStorage.getItem(k);
                    if (!raw) return false;
                    const { exp } = JSON.parse(raw);
                    return Date.now() < exp;
                } catch { return false; }
            });
    }

    // ─── Nettoyage ──────────────────────────────────────────
    clearAll() {
        Object.values(this.KEYS).forEach(k => localStorage.removeItem(k));
        console.log('🗑️ Cache vidé');
    }

    _purge() {
        // Supprime les anciennes clés ODA uniquement
        for (let i = localStorage.length - 1; i >= 0; i--) {
            const k = localStorage.key(i);
            if (k && k.startsWith('oda_') && !Object.values(this.KEYS).includes(k)) {
                localStorage.removeItem(k);
            }
        }
    }

    getInfo() {
        const ts = localStorage.getItem(this.KEYS.TIMESTAMP);
        if (!ts) return { valid: false, age: null };
        const age = Date.now() - parseInt(ts);
        const min = Math.floor(age / 60000);
        return {
            valid : this.isValid(),
            age   : min < 60 ? `${min} min` : `${Math.floor(min / 60)} h`,
        };
    }
}

// Singleton global
window.cacheManager = new CacheManager();
console.log('✅ CacheManager prêt (TTL = 5 min)');

// ==================== LOADING PROGRESS ====================
class LoadingProgress {
    constructor() {
        this.overlay   = null;
        this.bar       = null;
        this.pct       = null;
        this.stepEl    = null;
        this.current   = 0;
        this.target    = 0;
        this.active    = false;
        this.rafId     = null;
        this._injectStyles();
    }

    _injectStyles() {
        if (document.getElementById('lp-styles')) return;
        const s = document.createElement('style');
        s.id = 'lp-styles';
        s.textContent = `
            .lp-overlay{position:fixed;inset:0;background:linear-gradient(135deg,#667eea,#764ba2);
                display:flex;align-items:center;justify-content:center;z-index:99999;
                opacity:1;transition:opacity .5s;}
            .lp-overlay.fade{opacity:0;pointer-events:none;}
            .lp-box{text-align:center;width:90%;max-width:360px;}
            .lp-icon{font-size:3.5rem;animation:lpBounce 1.5s infinite;}
            .lp-title{font-size:1.6rem;font-weight:800;color:#fff;margin:12px 0 24px;}
            .lp-track{width:100%;height:8px;background:rgba(255,255,255,.2);border-radius:10px;
                overflow:hidden;margin-bottom:12px;}
            .lp-bar{height:100%;width:0%;background:linear-gradient(90deg,#FF6B00,#FFA500);
                border-radius:10px;transition:width .3s ease;}
            .lp-row{display:flex;justify-content:space-between;color:#fff;font-size:.85rem;}
            .lp-pct{font-size:2rem;font-weight:800;color:#fff;}
            @keyframes lpBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
        `;
        document.head.appendChild(s);
    }

    start() {
        this.current = 0; this.target = 0; this.active = true;
        const html = `
            <div class="lp-overlay" id="lpOverlay">
                <div class="lp-box">
                    <div class="lp-icon">🛍️</div>
                    <div class="lp-title">ODA Marketplace</div>
                    <div class="lp-track"><div class="lp-bar" id="lpBar"></div></div>
                    <div class="lp-row">
                        <span class="lp-pct" id="lpPct">0%</span>
                        <span id="lpStep">Initialisation…</span>
                    </div>
                </div>
            </div>`;
        document.body.insertAdjacentHTML('afterbegin', html);
        this.overlay = document.getElementById('lpOverlay');
        this.bar     = document.getElementById('lpBar');
        this.pct     = document.getElementById('lpPct');
        this.stepEl  = document.getElementById('lpStep');
        this._animate();
    }

    update(pct, label) {
        this.target = Math.min(100, Math.max(0, pct));
        if (label && this.stepEl) this.stepEl.textContent = label;
    }

    _animate() {
        if (!this.active) return;
        const diff = this.target - this.current;
        if (Math.abs(diff) > 0.1) this.current += diff * 0.15;
        else this.current = this.target;
        const d = Math.round(this.current);
        if (this.bar)  this.bar.style.width  = `${d}%`;
        if (this.pct)  this.pct.textContent  = `${d}%`;
        this.rafId = requestAnimationFrame(() => this._animate());
    }

    complete() {
        this.update(100, 'Chargement terminé !');
        setTimeout(() => this._hide(), 800);
    }

    _hide() {
        this.active = false;
        cancelAnimationFrame(this.rafId);
        if (this.overlay) {
            this.overlay.classList.add('fade');
            setTimeout(() => this.overlay?.remove(), 500);
        }
    }

    showError(msg) {
        if (this.stepEl) this.stepEl.textContent = `❌ ${msg}`;
        if (this.bar)    this.bar.style.background = 'linear-gradient(90deg,#EF4444,#DC2626)';
        setTimeout(() => this._hide(), 2000);
    }
}

window.loadingProgress = new LoadingProgress();
console.log('✅ LoadingProgress prêt');

class OptimizedDataLoader {
    constructor(supabaseClient) {
        this.sb    = supabaseClient;
        this.cache = window.cacheManager;
        this.data  = { products: [], likes: {}, comments: {}, shops: {} };
    }

    // ─── Point d'entrée principal ───────────────────────────
    async load() {
        window.loadingProgress.start();
        window.loadingProgress.update(5, 'Vérification du cache…');

        try {
            if (this.cache.isValid()) {
                console.log('📦 Cache valide — chargement local');
                await this._fromCache();
            } else {
                console.log('🌐 Cache expiré — chargement Supabase');
                await this._fromServer();
            }
            window.loadingProgress.complete();
            return this.data;
        } catch (err) {
            console.error('❌ Erreur chargement:', err);
            window.loadingProgress.showError('Échec du chargement');
            throw err;
        }
    }

    // ─── Depuis le cache local ──────────────────────────────
    async _fromCache() {
        window.loadingProgress.update(20, 'Lecture du cache…');
        const cached = this.cache.loadAll();

        this.data.products = cached.products || [];
        window.loadingProgress.update(50, 'Produits restaurés…');

        this.data.likes    = cached.likes    || {};
        this.data.comments = cached.comments || {};
        this.data.shops    = cached.shops    || {};
        window.loadingProgress.update(90, 'Finalisation…');

        console.log(`📦 ${this.data.products.length} produits depuis le cache`);

        // ✅ Mise à jour silencieuse en arrière-plan
        setTimeout(() => this._updateInBackground(), 1000);
    }

    // ─── Depuis Supabase ────────────────────────────────────
    async _fromServer() {
        window.loadingProgress.update(10, 'Connexion Supabase…');

        // Toutes les requêtes en parallèle (plus rapide)
        const [shopsRes, productsRes, likesRes, commentsRes] = await Promise.all([
            this.sb.from('parametres_boutique').select('user_id, config'),
            this.sb.from('produits').select('*').eq('statut', 'published').gt('stock', 0),
            this.sb.from('product_likes').select('product_id, user_id'),
            this.sb.from('product_comments').select('*').order('created_at', { ascending: false }),
        ]);

        window.loadingProgress.update(60, 'Traitement des données…');

        // Boutiques
        (shopsRes.data || []).forEach(s => {
            const slug = s.config?.identifiant?.slug || s.config?.slug || null;
            this.data.shops[s.user_id] = {
                nom             : s.config?.general?.nom || 'Boutique',
                identifiant     : slug,
                couleurPrimaire : s.config?.apparence?.couleurPrimaire || '#FF6B00',
            };
        });

        // Produits enrichis
        this.data.products = (productsRes.data || []).map(p => ({
            id          : p.id,
            nom         : p.nom,
            description : p.description,
            prix        : p.prix,
            stock       : p.stock,
            mainImage   : p.main_image,
            categorie   : p.categorie,
            userId      : p.user_id,
            created_at  : p.created_at,
            shopName    : this.data.shops[p.user_id]?.nom || 'Boutique',
            shopSlug    : this.data.shops[p.user_id]?.identifiant,
            shopColor   : this.data.shops[p.user_id]?.couleurPrimaire || '#FF6B00',
            rating      : '0.0',
            likes       : 0,
        }));

        // Likes
        (likesRes.data || []).forEach(l => {
            if (!this.data.likes[l.product_id])
                this.data.likes[l.product_id] = { count: 0, users: [] };
            this.data.likes[l.product_id].count++;
            this.data.likes[l.product_id].users.push(l.user_id);
        });

        // Commentaires + note moyenne
        const commentsByProduct = {};
        (commentsRes.data || []).forEach(c => {
            if (!this.data.comments[c.product_id]) this.data.comments[c.product_id] = [];
            this.data.comments[c.product_id].push(c);
        });

        // Enrichir rating et likes dans les produits
        this.data.products = this.data.products.map(p => ({
            ...p,
            likes  : this.data.likes[p.id]?.count || 0,
            rating : this._avgRating(this.data.comments[p.id] || []),
        }));

        window.loadingProgress.update(85, 'Mise en cache…');
        this.cache.saveAll(
            this.data.products,
            this.data.likes,
            this.data.comments,
            this.data.shops,
        );
        window.loadingProgress.update(98, 'Presque prêt…');
        console.log(`✅ ${this.data.products.length} produits chargés depuis Supabase`);
    }

    // ─── Mise à jour silencieuse (rafraîchit l'UI) ─────────
    async _updateInBackground() {
        console.log('🔄 Mise à jour silencieuse en cours…');
        try {
            // Sauvegarde temporaire du loader actif (on ne le montre pas)
            const prev = window.loadingProgress;
            window.loadingProgress = { start(){}, update(){}, complete(){}, showError(){} };

            await this._fromServer();

            window.loadingProgress = prev;

            // ✅ On met à jour les variables globales et l'interface
            _applyLoadedData(this.data);

            console.log('✅ Mise à jour silencieuse terminée — interface rafraîchie');
        } catch (e) {
            console.warn('⚠️ Mise à jour silencieuse échouée:', e);
        }
    }

    async forceReload() {
        this.cache.clearAll();
        return this.load();
    }

    _avgRating(comments) {
        if (!comments.length) return '0.0';
        return (comments.reduce((s, c) => s + (c.rating || 0), 0) / comments.length).toFixed(1);
    }
}

console.log('✅ OptimizedDataLoader prêt');

// ==================== IMPROVED MENU (CATÉGORIES LATÉRALES) ====================
class ImprovedMenu {
    constructor() {
        this.products           = [];
        this.categories         = new Map();
        this.expandedCategories = new Set();
        this._injectStyles();
    }

    // ─── Initialisation ─────────────────────────────────────
    init(products) {
        this.products = products;
        this._buildCategories();
        this.render();
    }

    update(products) {
        this.products = products;
        this._buildCategories();
        this.render();
    }

    // ─── Construction des catégories ────────────────────────
    _buildCategories() {
        this.categories.clear();

        // "Tous" en premier
        this.categories.set('Tous', {
            count         : this.products.length,
            subcategories : this._getSubcats(this.products),
        });

        // Catégories réelles triées par nombre de produits
        const groups = {};
        this.products.forEach(p => {
            const c = p.categorie || 'Autres';
            if (!groups[c]) groups[c] = [];
            groups[c].push(p);
        });

        Object.entries(groups)
            .sort((a, b) => b[1].length - a[1].length)
            .forEach(([cat, prods]) => {
                this.categories.set(cat, {
                    count         : prods.length,
                    subcategories : this._getSubcats(prods),
                });
            });
    }

    // ─── Sous-catégories dynamiques ─────────────────────────
    _getSubcats(products) {
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - CONFIG.NEW_PRODUCT_DAYS);
        const subs = {};

        const recommended = products.filter(p => (p.likes || 0) >= CONFIG.RECOMMEND_LIKES);
        if (recommended.length) subs['⭐ Recommandés'] = recommended.length;

        const newOnes = products.filter(p => new Date(p.created_at) >= sevenDaysAgo);
        if (newOnes.length) subs['🆕 Nouveaux'] = newOnes.length;

        const topN = Math.max(1, Math.ceil(products.length * CONFIG.TOP_PERCENT));
        const popular = [...products].sort((a, b) => (b.likes || 0) - (a.likes || 0)).slice(0, topN);
        if (popular.length) subs['🔥 Populaires'] = popular.length;

        const lowStock = products.filter(p => p.stock > 0 && p.stock <= CONFIG.LOW_STOCK_THRESHOLD);
        if (lowStock.length) subs['⚠️ Fin de stock'] = lowStock.length;

        const sales = products.filter(p => p.prix < CONFIG.SALE_PRICE);
        if (sales.length) subs['💰 Soldes'] = sales.length;

        const topRated = products.filter(p => parseFloat(p.rating || 0) >= CONFIG.TOP_RATING);
        if (topRated.length) subs['🏆 Mieux notés'] = topRated.length;

        return subs;
    }

    // ─── Rendu HTML ─────────────────────────────────────────
    render() {
        const list = document.getElementById('categoryList');
        if (!list) return;

        let html = '';
        this.categories.forEach((data, cat) => {
            const isAll     = cat === 'Tous';
            const icon      = this._icon(cat);
            const pct       = ((data.count / this.products.length) * 100).toFixed(0);
            const hasSubs   = Object.keys(data.subcategories).length > 0;
            const expanded  = this.expandedCategories.has(cat);

            html += `<div class="im-wrapper">
                <div class="im-item ${isAll ? 'im-all' : ''}">
                    <div class="im-content" onclick="window.improvedMenu.selectCategory('${cat}','all')">
                        <div class="im-left">
                            <span class="im-icon">${icon}</span>
                            <span class="im-name">${cat}</span>
                        </div>
                        <div class="im-right">
                            <span class="im-count">${data.count}</span>
                            ${!isAll ? `<span class="im-pct">${pct}%</span>` : ''}
                        </div>
                    </div>
                    ${hasSubs ? `
                    <button class="im-toggle ${expanded ? 'expanded' : ''}"
                            onclick="event.stopPropagation();window.improvedMenu.toggleCat('${cat}')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                             stroke="currentColor" stroke-width="2.5">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>` : ''}
                    ${!isAll ? `<div class="im-progress"><div class="im-progress-bar" style="width:${pct}%"></div></div>` : ''}
                </div>`;

            if (hasSubs) {
                html += `<div class="im-subs ${expanded ? 'expanded' : ''}">`;
                Object.entries(data.subcategories).forEach(([sub, count]) => {
                    html += `
                        <div class="im-sub"
                             onclick="event.stopPropagation();window.improvedMenu.selectCategory('${cat}','${sub}')">
                            <span class="im-sub-name">${sub}</span>
                            <span class="im-sub-count">${count}</span>
                        </div>`;
                });
                html += '</div>';
            }

            html += '</div>';
        });

        list.innerHTML = html;
    }

    // ─── Interaction ────────────────────────────────────────
    toggleCat(cat) {
        if (this.expandedCategories.has(cat)) this.expandedCategories.delete(cat);
        else this.expandedCategories.add(cat);
        this.render();
    }

    selectCategory(cat, sub = 'all') {
        this._closeMenu();
        window.dispatchEvent(new CustomEvent('categorySelected', {
            detail: { category: cat, subcategory: sub }
        }));
    }

    _closeMenu() {
        document.getElementById('sideMenu')?.classList.remove('active');
        document.getElementById('overlay')?.classList.remove('active');
    }

    // ─── Icônes ─────────────────────────────────────────────
    _icon(cat) {
        const map = {
            'Tous':'🏠','Électronique':'📱','Mode':'👕','Maison':'🏡',
            'Beauté':'💄','Sport':'⚽','Livres':'📚','Jouets':'🧸',
            'Alimentation':'🍔','Santé':'💊','Auto':'🚗','Jardin':'🌱','Autres':'📦',
        };
        for (const [k, v] of Object.entries(map)) {
            if (cat.toLowerCase().includes(k.toLowerCase())) return v;
        }
        return '📦';
    }

    // ─── Styles injectés ────────────────────────────────────
    _injectStyles() {
        if (document.getElementById('im-styles')) return;
        const s = document.createElement('style');
        s.id = 'im-styles';
        s.textContent = `
            .im-wrapper{margin-bottom:6px;}
            .im-item{background:var(--bg-secondary);border-radius:12px;overflow:hidden;
                border:2px solid transparent;position:relative;cursor:pointer;
                transition:all .2s;}
            .im-item:hover{transform:translateX(3px);box-shadow:0 4px 12px rgba(0,0,0,.1);}
            .im-all{background:linear-gradient(135deg,var(--primary-color),var(--primary-dark));
                border-color:transparent;}
            .im-all .im-name,.im-all .im-count,.im-all .im-pct{color:#fff!important;}
            .im-content{display:flex;justify-content:space-between;align-items:center;
                padding:13px 44px 13px 14px;}
            .im-left{display:flex;align-items:center;gap:10px;}
            .im-icon{font-size:1.2rem;}
            .im-name{font-weight:600;font-size:.95rem;color:var(--text-primary);}
            .im-right{display:flex;align-items:center;gap:8px;}
            .im-count{font-weight:700;color:var(--primary-color);
                background:rgba(255,107,0,.1);padding:3px 10px;border-radius:12px;
                min-width:38px;text-align:center;font-size:1rem;}
            .im-pct{font-size:.72rem;color:var(--text-secondary);}
            .im-toggle{position:absolute;right:8px;top:50%;transform:translateY(-50%);
                width:30px;height:30px;border:none;background:rgba(255,255,255,.9);
                border-radius:8px;cursor:pointer;display:flex;align-items:center;
                justify-content:center;transition:all .3s;}
            .im-toggle svg{transition:transform .3s;color:var(--primary-color);}
            .im-toggle.expanded svg{transform:rotate(180deg);}
            .im-progress{height:3px;background:rgba(0,0,0,.05);}
            .im-progress-bar{height:100%;background:linear-gradient(90deg,var(--primary-color),var(--primary-dark));transition:width .5s;}
            .im-subs{max-height:0;overflow:hidden;transition:max-height .35s ease;
                padding:0 10px;background:rgba(0,0,0,.02);}
            .im-subs.expanded{max-height:400px;padding:6px 10px 10px;}
            .im-sub{display:flex;justify-content:space-between;align-items:center;
                padding:9px 10px;background:#fff;border-radius:8px;margin-bottom:5px;
                border:1px solid var(--border-color);cursor:pointer;transition:all .2s;}
            .im-sub:hover{transform:translateX(4px);border-color:var(--primary-color);}
            .im-sub-name{font-size:.85rem;font-weight:500;color:var(--text-primary);}
            .im-sub-count{font-size:.82rem;font-weight:700;color:var(--primary-color);
                background:rgba(255,107,0,.1);padding:2px 8px;border-radius:8px;}
        `;
        document.head.appendChild(s);
    }
}

window.improvedMenu = new ImprovedMenu();
console.log('✅ ImprovedMenu prêt');


// ==================== STYLES SECTIONS CATÉGORIE ====================
function _injectSectionStyles() {
    if (document.getElementById('cat-section-styles')) return;
    const s = document.createElement('style');
    s.id = 'cat-section-styles';
    s.textContent = `
        /* ─── Section horizontale ─── */
        .oda-section{margin-bottom:32px;}
        .oda-section-header{display:flex;justify-content:space-between;
            align-items:center;margin-bottom:12px;padding:0 2px;}
        .oda-section-title-wrap{display:flex;align-items:center;gap:8px;}
        .oda-section-title{font-size:1.05rem;font-weight:700;color:var(--text-primary);}
        .oda-section-badge{background:var(--primary-color);color:#fff;
            font-size:.68rem;font-weight:700;padding:2px 8px;border-radius:20px;}
        .oda-section-count{font-size:.78rem;color:var(--text-secondary);font-weight:500;}
        .oda-scroll-row{display:flex;gap:12px;overflow-x:auto;overflow-y:hidden;
            padding-bottom:12px;scroll-snap-type:x mandatory;
            -webkit-overflow-scrolling:touch;scrollbar-width:none;}
        .oda-scroll-row::-webkit-scrollbar{display:none;}

        /* ─── Badge produit ─── */
        .oda-badge{position:absolute;font-size:.62rem;font-weight:700;
            padding:3px 7px;border-radius:10px;z-index:5;pointer-events:none;}
        .oda-badge-new{top:8px;left:8px;background:#10B981;color:#fff;}
        .oda-badge-stock{top:34px;left:8px;background:#F59E0B;color:#fff;}
        .oda-badge-sale{top:8px;right:44px;background:#EF4444;color:#fff;}

        /* ─── Carte produit ─── */
        .product-card{background:var(--bg-primary);border-radius:12px;overflow:hidden;
            box-shadow:var(--shadow-sm);cursor:pointer;position:relative;
            display:flex;flex-direction:column;border:1px solid var(--border-color);
            transition:all .25s cubic-bezier(.4,0,.2,1);}
        .product-card:hover{transform:translateY(-3px);
            box-shadow:0 8px 20px rgba(0,0,0,.12);border-color:var(--primary-color);}
        .product-image-wrapper{position:relative;width:100%;padding-top:65%;background:#f5f5f5;overflow:hidden;}
        .product-image{position:absolute;top:0;left:0;width:100%;height:100%;
            object-fit:cover;transition:transform .3s ease;}
        .product-card:hover .product-image{transform:scale(1.05);}
        .btn-favorite{position:absolute;top:8px;right:8px;width:32px;height:32px;
            border-radius:50%;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);
            border:none;display:flex;align-items:center;justify-content:center;
            cursor:pointer;transition:all .3s;font-size:1rem;z-index:5;
            box-shadow:0 2px 8px rgba(0,0,0,.15);}
        .btn-favorite:hover{transform:scale(1.1);}
        .btn-favorite.active{background:var(--error-color);color:#fff;}
        .product-info{padding:10px;display:flex;flex-direction:column;gap:5px;flex:1;}
        .shop-badge{display:inline-flex;align-items:center;gap:3px;
            font-size:.68rem;font-weight:500;color:var(--text-secondary);
            padding:2px 6px;border-radius:8px;width:fit-content;}
        .product-name{font-size:.83rem;font-weight:700;color:var(--text-primary);
            display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
            overflow:hidden;line-height:1.3;}
        .product-engagement{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
        .btn-like,.btn-comments{display:inline-flex;align-items:center;gap:4px;
            background:var(--bg-secondary);border:none;border-radius:8px;
            padding:4px 8px;font-size:.72rem;cursor:pointer;transition:all .2s;}
        .btn-like.liked{background:rgba(239,68,68,.1);color:#EF4444;}
        .btn-like:hover{transform:scale(1.05);}
        .product-rating{font-size:.7rem;color:var(--text-secondary);font-weight:600;}
        .product-price{font-size:1.05rem;font-weight:800;color:var(--primary-color);}
        .product-stock{font-size:.68rem;font-weight:600;color:#F59E0B;}
        .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:6px;}
    `;
    document.head.appendChild(s);
}

// ==================== UTILITAIRES SOUS-CATÉGORIES ====================
function _sevenDaysAgo() {
    const d = new Date();
    d.setDate(d.getDate() - CONFIG.NEW_PRODUCT_DAYS);
    return d;
}

function _subcatConfigs(baseProducts) {
    const cutoff = _sevenDaysAgo();
    const topN   = Math.max(1, Math.ceil(baseProducts.length * CONFIG.TOP_PERCENT));
    const sorted = [...baseProducts].sort(
        (a, b) => (productLikes[b.id]?.count || b.likes || 0)
                - (productLikes[a.id]?.count || a.likes || 0)
    );

    return [
        {
            label  : '⭐ Recommandés',
            filter : p => (productLikes[p.id]?.count || p.likes || 0) >= CONFIG.RECOMMEND_LIKES,
        },
        {
            label  : '🆕 Nouveaux arrivages',
            filter : p => new Date(p.created_at) >= cutoff,
        },
        {
            label  : '🔥 Populaires',
            filter : p => sorted.slice(0, topN).some(t => t.id === p.id),
        },
        {
            label  : '⚠️ Fin de stock',
            filter : p => p.stock > 0 && p.stock <= CONFIG.LOW_STOCK_THRESHOLD,
        },
        {
            label  : '💰 Soldes & Bons plans',
            filter : p => p.prix < CONFIG.SALE_PRICE,
        },
        {
            label  : '🏆 Mieux notés',
            filter : p => parseFloat(p.rating || 0) >= CONFIG.TOP_RATING,
        },
    ];
}

// ==================== CRÉATION CARTE PRODUIT ====================
function createProductCard(product, isHorizontal = false) {
    const cardStyle = isHorizontal
        ? 'min-width:175px;max-width:175px;scroll-snap-align:start;flex-shrink:0;'
        : '';

    const likeData      = productLikes[product.id]  || { count: 0, userLiked: false };
    const commentsCount = (productComments[product.id] || []).length;
    const shopColor     = product.shopColor || '#FF6B00';
    const cutoff        = _sevenDaysAgo();
    const isNew         = new Date(product.created_at) >= cutoff;
    const isLowStock    = product.stock > 0 && product.stock <= CONFIG.LOW_STOCK_THRESHOLD;
    const isSale        = product.prix < CONFIG.SALE_PRICE;

    return `
        <div class="product-card" style="${cardStyle}" onclick="goToProduct(${product.id})">
            <div class="product-image-wrapper">
                ${isNew      ? `<span class="oda-badge oda-badge-new">Nouveau</span>` : ''}
                ${isLowStock ? `<span class="oda-badge oda-badge-stock">⚠️ ${product.stock} restant${product.stock > 1 ? 's' : ''}</span>` : ''}
                ${isSale && !isNew ? `<span class="oda-badge oda-badge-sale">Promo</span>` : ''}
                <button class="btn-favorite ${favoriteProducts.has(product.id) ? 'active' : ''}"
                        onclick="event.stopPropagation();toggleFavorite(${product.id})">
                    ${favoriteProducts.has(product.id) ? '❤️' : '🤍'}
                </button>
                <img src="${product.mainImage || 'https://via.placeholder.com/300'}"
                     class="product-image"
                     alt="${product.nom}"
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/300?text=Produit'">
            </div>
            <div class="product-info">
                <span class="shop-badge" style="background:${shopColor}18;color:${shopColor}">
                    🏪 ${product.shopName || 'Boutique'}
                </span>
                <h3 class="product-name">${product.nom}</h3>
                <div class="product-engagement">
                    <button class="btn-like ${likeData.userLiked ? 'liked' : ''}"
                            data-like-product="${product.id}"
                            onclick="event.stopPropagation();toggleLike(${product.id})">
                        <span class="like-icon">${likeData.userLiked ? '❤️' : '🤍'}</span>
                        <span class="like-count">${likeData.count}</span>
                    </button>
                    <button class="btn-comments"
                            onclick="event.stopPropagation();showCommentsModal(${product.id})">
                        <span>💬</span><span>${commentsCount}</span>
                    </button>
                    ${parseFloat(product.rating || 0) >= 1
                        ? `<span class="product-rating">⭐ ${product.rating}</span>`
                        : ''}
                </div>
                <div class="product-footer">
                    <div class="product-price" style="color:${shopColor}">
                        ${formatPrice(product.prix)}
                    </div>
                    ${isLowStock
                        ? `<div class="product-stock">⚠️ Stock faible</div>`
                        : ''}
                </div>
            </div>
        </div>`;
}

// ==================== CONSTRUCTION D'UNE SECTION HORIZONTALE ====================
function _buildSection(title, products, showBadge = false) {
    if (!products.length) return '';
    return `
        <div class="oda-section">
            <div class="oda-section-header">
                <div class="oda-section-title-wrap">
                    <h3 class="oda-section-title">${title}</h3>
                    ${showBadge
                        ? `<span class="oda-section-badge">${products.length}</span>`
                        : ''}
                </div>
                <span class="oda-section-count">
                    ${products.length} produit${products.length > 1 ? 's' : ''}
                </span>
            </div>
            <div class="oda-scroll-row">
                ${products.map(p => createProductCard(p, true)).join('')}
            </div>
        </div>`;
}

// ==================== VUE "TOUS" — une ligne par catégorie réelle ====================
function displayProducts() {
    const grid        = document.getElementById('productsGrid');
    const emptyState  = document.getElementById('emptyState');
    const productCount= document.getElementById('productCount');
    const header      = document.querySelector('.section-header h2');

    _injectSectionStyles();

    if (!allProducts.length) {
        grid.style.display  = 'none';
        emptyState.style.display = 'block';
        if (productCount) productCount.textContent = '0 produits';
        return;
    }

    if (header)       header.textContent      = 'Tous les produits';
    if (productCount) productCount.textContent = `${allProducts.length} produits`;
    emptyState.style.display = 'none';

    // Icônes par catégorie
    const ICONS = {
        'Électronique':'📱','Mode':'👕','Maison':'🏡','Beauté':'💄',
        'Sport':'⚽','Livres':'📚','Jouets':'🧸','Alimentation':'🍔',
        'Santé':'💊','Auto':'🚗','Jardin':'🌱','Autres':'📦',
    };
    const getIcon = cat => {
        for (const [k, v] of Object.entries(ICONS)) {
            if (cat.toLowerCase().includes(k.toLowerCase())) return v;
        }
        return '📦';
    };

    // Regrouper par catégorie
    const groups = {};
    allProducts.forEach(p => {
        const c = p.categorie || 'Autres';
        if (!groups[c]) groups[c] = [];
        groups[c].push(p);
    });

    let html = '';
    Object.entries(groups)
        .sort((a, b) => b[1].length - a[1].length)
        .forEach(([cat, prods]) => {
            html += _buildSection(`${getIcon(cat)} ${cat}`, prods);
        });

    grid.innerHTML = html;
    grid.style.display          = 'block';
    grid.style.gridTemplateColumns = '1fr';
}

// ==================== VUE CATÉGORIE — sous-catégories en lignes ====================
function filterByCategory(category, subcategory = 'all') {
    const grid        = document.getElementById('productsGrid');
    const emptyState  = document.getElementById('emptyState');
    const productCount= document.getElementById('productCount');
    const header      = document.querySelector('.section-header h2');

    _injectSectionStyles();

    // ── Retour à "Tous" ──
    if (category === 'Tous' && subcategory === 'all') {
        displayProducts();
        document.querySelector('.products-container')
            ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
    }

    // ── Produits de base ──
    const base = category === 'Tous'
        ? [...allProducts]
        : allProducts.filter(p => p.categorie === category);

    // ── Sous-catégorie précise sélectionnée ──
    if (subcategory !== 'all') {
        // Trouver la config correspondante
        const cfg = _subcatConfigs(base).find(s => s.label === subcategory);
        const filtered = cfg ? base.filter(p => cfg.filter(p)) : base;

        if (header) header.textContent = `${category} › ${subcategory}`;
        if (productCount) productCount.textContent = `${filtered.length} produit${filtered.length > 1 ? 's' : ''}`;

        if (!filtered.length) {
            grid.style.display  = 'none';
            emptyState.style.display = 'block';
        } else {
            grid.innerHTML = _buildSection(subcategory, filtered);
            grid.style.display          = 'block';
            grid.style.gridTemplateColumns = '1fr';
            emptyState.style.display    = 'none';
        }
        document.querySelector('.products-container')
            ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
    }

    // ── Vue principale d'une catégorie : toutes les sous-catégories ──
    if (header) header.textContent      = category === 'Tous' ? 'Tous les produits' : category;
    if (productCount) productCount.textContent = `${base.length} produit${base.length > 1 ? 's' : ''}`;

    if (!base.length) {
        grid.style.display  = 'none';
        emptyState.style.display = 'block';
        document.querySelector('.products-container')
            ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        return;
    }

    emptyState.style.display = 'none';
    grid.style.display          = 'block';
    grid.style.gridTemplateColumns = '1fr';

    let html = '';

    // Une section par sous-catégorie (seulement celles non vides)
    _subcatConfigs(base).forEach(sub => {
        const matching = base.filter(p => sub.filter(p));
        if (matching.length) {
            html += _buildSection(sub.label, matching, true);
        }
    });

    // Section finale : tous les produits de la catégorie
    html += _buildSection(`📦 Tous les produits — ${category}`, base);

    grid.innerHTML = html;
    document.querySelector('.products-container')
        ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ==================== CARROUSEL ====================
function updateCarousel() {
    const container     = document.getElementById('carouselContainer');
    const dotsContainer = document.getElementById('carouselDots');
    if (!container || !dotsContainer) return;

    popularProducts = [...allProducts]
        .sort((a, b) =>
            (productLikes[b.id]?.count || b.likes || 0) -
            (productLikes[a.id]?.count || a.likes || 0)
        )
        .slice(0, 10);

    if (!popularProducts.length) {
        document.getElementById('heroCarousel')?.style.setProperty('display', 'none');
        return;
    }

    container.innerHTML = popularProducts.map(product => {
        const likeData      = productLikes[product.id] || { count: 0, userLiked: false };
        const commentsCount = (productComments[product.id] || []).length;
        return `
        <div class="carousel-item" onclick="goToProduct(${product.id})">
            <img src="${product.mainImage || 'https://via.placeholder.com/1200x400'}"
                 class="carousel-image" alt="${product.nom}"
                 onerror="this.src='https://via.placeholder.com/1200x400'">
            <div class="carousel-overlay">
                <div class="carousel-info">
                    <h2>${product.nom}</h2>
                    <p class="shop-name">🏪 ${product.shopName}</p>
                    <p class="product-price">${formatPrice(product.prix)}</p>
                    <div style="display:flex;gap:16px;margin-top:8px;font-size:.9rem;opacity:.9;">
                        <span>❤️ ${likeData.count} likes</span>
                        <span>💬 ${commentsCount} commentaires</span>
                    </div>
                </div>
            </div>
        </div>`;
    }).join('');

    dotsContainer.innerHTML = popularProducts.map((_, i) =>
        `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`
    ).join('');

    startCarousel(popularProducts.length);
}

function startCarousel(total) {
    if (carouselInterval) clearInterval(carouselInterval);
    currentSlide = 0;
    carouselInterval = setInterval(() => {
        currentSlide = (currentSlide + 1) % total;
        _updateCarouselPos();
    }, CONFIG.CAROUSEL_INTERVAL);
}

function _updateCarouselPos() {
    const container = document.getElementById('carouselContainer');
    if (!container) return;
    container.style.transform = `translateX(-${currentSlide * 100}%)`;
    document.querySelectorAll('.dot').forEach((d, i) =>
        d.classList.toggle('active', i === currentSlide)
    );
}

window.goToSlide = function(index) {
    currentSlide = index;
    _updateCarouselPos();
    if (carouselInterval) clearInterval(carouselInterval);
    startCarousel(popularProducts.length);
};

function initCarouselControls() {
    const prev = document.getElementById('btnPrev');
    const next = document.getElementById('btnNext');
    if (prev) {
        prev.addEventListener('click', () => {
            currentSlide = (currentSlide - 1 + popularProducts.length) % popularProducts.length;
            _updateCarouselPos();
            if (carouselInterval) clearInterval(carouselInterval);
            startCarousel(popularProducts.length);
        });
    }
    if (next) {
        next.addEventListener('click', () => {
            currentSlide = (currentSlide + 1) % popularProducts.length;
            _updateCarouselPos();
            if (carouselInterval) clearInterval(carouselInterval);
            startCarousel(popularProducts.length);
        });
    }
    document.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') prev?.click();
        if (e.key === 'ArrowRight') next?.click();
    });
}

// ==================== RECHERCHE ====================
function initSearch() {
    const input = document.getElementById('searchInput')
               || document.querySelector('.search-box input');
    if (!input) return;

    let timer;
    input.addEventListener('input', e => {
        clearTimeout(timer);
        timer = setTimeout(() => {
            const term = e.target.value.toLowerCase().trim();
            if (!term) { displayProducts(); return; }

            const filtered = allProducts.filter(p =>
                p.nom?.toLowerCase().includes(term) ||
                p.shopName?.toLowerCase().includes(term) ||
                p.categorie?.toLowerCase().includes(term)
            );

            const grid       = document.getElementById('productsGrid');
            const emptyState = document.getElementById('emptyState');
            const pCount     = document.getElementById('productCount');

            _injectSectionStyles();

            if (!filtered.length) {
                grid.style.display  = 'none';
                emptyState.style.display = 'block';
                if (pCount) pCount.textContent = '0 produits';
            } else {
                grid.innerHTML = _buildSection(`🔍 Résultats pour "${e.target.value}"`, filtered);
                grid.style.display          = 'block';
                grid.style.gridTemplateColumns = '1fr';
                emptyState.style.display    = 'none';
                if (pCount) pCount.textContent = `${filtered.length} produit${filtered.length > 1 ? 's' : ''}`;
            }
        }, CONFIG.DEBOUNCE_DELAY);
    });
}

console.log('✅ Artefact 3 — Affichage & Carrousel prêt');

function getUserId() {
    let id = localStorage.getItem('oda_user_id');
    if (!id) {
        id = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('oda_user_id', id);
    }
    return id;
}

function getUserName() {
    let name = localStorage.getItem('oda_user_name');
    if (!name) {
        name = prompt('Entrez votre nom pour commenter :') || 'Anonyme';
        localStorage.setItem('oda_user_name', name);
    }
    return name;
}

// ==================== FAVORIS ====================
function loadFavorites() {
    try {
        const stored = localStorage.getItem('oda_favorites');
        if (stored) favoriteProducts = new Set(JSON.parse(stored));
    } catch { favoriteProducts = new Set(); }
}

function saveFavorites() {
    localStorage.setItem('oda_favorites', JSON.stringify([...favoriteProducts]));
}

function toggleFavorite(productId) {
    if (favoriteProducts.has(productId)) {
        favoriteProducts.delete(productId);
        showToast('Retiré des favoris', 'info');
    } else {
        favoriteProducts.add(productId);
        showToast('Ajouté aux favoris ❤️', 'success');
    }
    saveFavorites();
    updateBadges();
    // Rafraîchir uniquement le bouton (pas tout l'affichage)
    document.querySelectorAll(`[onclick*="toggleFavorite(${productId})"]`).forEach(btn => {
        const isFav = favoriteProducts.has(productId);
        btn.textContent = isFav ? '❤️' : '🤍';
        btn.classList.toggle('active', isFav);
    });
}

function updateBadges() {
    const badge = document.getElementById('favBadge');
    if (badge) {
        badge.textContent     = favoriteProducts.size;
        badge.style.display   = favoriteProducts.size > 0 ? 'flex' : 'none';
    }
}

// ==================== LIKES ====================
async function toggleLike(productId) {
    const current = productLikes[productId] || { count: 0, userLiked: false };
    try {
        if (current.userLiked) {
            await supabase.from('product_likes').delete()
                .eq('product_id', productId).eq('user_id', currentUserId);
            productLikes[productId] = { count: Math.max(0, current.count - 1), userLiked: false };
            showToast('Like retiré', 'info');
        } else {
            await supabase.from('product_likes').insert({
                product_id : productId,
                user_id    : currentUserId,
            });
            productLikes[productId] = { count: current.count + 1, userLiked: true };
            showToast('Produit liké ! ❤️', 'success');
        }
        _updateLikeButtons(productId);
        updateCarousel();
    } catch (err) {
        console.error('Erreur like:', err);
        showToast('Erreur lors du like', 'error');
    }
}

function _updateLikeButtons(productId) {
    const likeData = productLikes[productId] || { count: 0, userLiked: false };
    document.querySelectorAll(`[data-like-product="${productId}"]`).forEach(btn => {
        const icon  = btn.querySelector('.like-icon');
        const count = btn.querySelector('.like-count');
        if (icon)  icon.textContent  = likeData.userLiked ? '❤️' : '🤍';
        if (count) count.textContent = likeData.count;
        btn.classList.toggle('liked', likeData.userLiked);
    });
}

// ==================== COMMENTAIRES ====================
async function addComment(productId, text, rating) {
    if (!text.trim()) { showToast('Commentaire vide', 'error'); return; }
    const name = getUserName();
    try {
        const { data, error } = await supabase.from('product_comments').insert({
            product_id : productId,
            user_id    : currentUserId,
            user_name  : name,
            comment    : text.trim(),
            rating     : rating || 5,
        }).select().single();
        if (error) throw error;
        if (!productComments[productId]) productComments[productId] = [];
        productComments[productId].unshift(data);
        showToast('Commentaire publié !', 'success');
        return data;
    } catch (err) {
        console.error('Erreur commentaire:', err);
        showToast('Erreur lors de l\'ajout', 'error');
    }
}

function _avgRating(comments) {
    if (!comments?.length) return '0.0';
    return (comments.reduce((s, c) => s + (c.rating || 0), 0) / comments.length).toFixed(1);
}

function formatDate(str) {
    const date = new Date(str);
    const diff = Math.floor((Date.now() - date) / 86400000);
    if (diff === 0) return 'Aujourd\'hui';
    if (diff === 1) return 'Hier';
    if (diff < 7)  return `Il y a ${diff} jours`;
    if (diff < 30) return `Il y a ${Math.floor(diff / 7)} sem.`;
    return date.toLocaleDateString('fr-FR');
}

// ==================== MODAL COMMENTAIRES ====================
function showCommentsModal(productId) {
    const product  = allProducts.find(p => p.id === productId);
    if (!product) return;
    const comments = productComments[productId] || [];
    const likeData = productLikes[productId]    || { count: 0, userLiked: false };

    // Supprimer modal existant
    document.querySelector('.comments-modal')?.remove();

    const modal = document.createElement('div');
    modal.className = 'comments-modal';
    modal.innerHTML = `
        <div class="modal-backdrop" onclick="this.parentElement.remove()"></div>
        <div class="modal-content" style="
            position:fixed;bottom:0;left:0;right:0;background:#fff;border-radius:20px 20px 0 0;
            max-height:85vh;overflow-y:auto;padding:24px;z-index:9000;
            animation:slideUp .3s ease;">
            <div style="text-align:center;margin-bottom:20px;">
                <div style="width:40px;height:4px;background:#e0e0e0;border-radius:2px;
                    margin:0 auto 16px;"></div>
                <h3 style="font-size:1.1rem;font-weight:700;">${product.nom}</h3>
            </div>
            <div style="display:flex;justify-content:space-around;
                background:var(--bg-secondary);border-radius:12px;padding:16px;margin-bottom:20px;">
                <div style="text-align:center;">
                    <div style="font-size:1.5rem;font-weight:800;">${likeData.count}</div>
                    <div style="font-size:.75rem;color:var(--text-secondary);">❤️ Likes</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:1.5rem;font-weight:800;">${comments.length}</div>
                    <div style="font-size:.75rem;color:var(--text-secondary);">💬 Avis</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:1.5rem;font-weight:800;">${_avgRating(comments)}</div>
                    <div style="font-size:.75rem;color:var(--text-secondary);">⭐ Note</div>
                </div>
            </div>
            <div style="margin-bottom:20px;">
                <h4 style="font-size:.95rem;font-weight:700;margin-bottom:12px;">
                    Ajouter un avis
                </h4>
                <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;">
                    ${[5,4,3,2,1].map(s => `
                        <label style="cursor:pointer;">
                            <input type="radio" name="rating" value="${s}"
                                ${s === 5 ? 'checked' : ''} style="display:none;">
                            <span style="font-size:1.4rem;">${'⭐'.repeat(s)}</span>
                        </label>`).join('')}
                </div>
                <textarea id="commentInput"
                    style="width:100%;padding:12px;border:1.5px solid var(--border-color);
                    border-radius:10px;resize:none;font-family:inherit;font-size:.9rem;outline:none;"
                    rows="3" placeholder="Partagez votre avis…"></textarea>
                <button onclick="submitComment(${productId})"
                    style="margin-top:10px;width:100%;padding:12px;background:var(--primary-color);
                    color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer;
                    font-size:.95rem;">
                    Publier
                </button>
            </div>
            <div>
                <h4 style="font-size:.95rem;font-weight:700;margin-bottom:12px;">
                    Tous les avis (${comments.length})
                </h4>
                ${comments.length === 0
                    ? `<p style="text-align:center;color:var(--text-secondary);padding:20px 0;">
                         Aucun avis — soyez le premier ! 🙌
                       </p>`
                    : comments.map(c => `
                        <div style="padding:14px 0;border-bottom:1px solid var(--border-color);">
                            <div style="display:flex;justify-content:space-between;
                                align-items:center;margin-bottom:6px;">
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <div style="width:32px;height:32px;border-radius:50%;
                                        background:var(--primary-color);color:#fff;
                                        display:flex;align-items:center;justify-content:center;
                                        font-weight:700;font-size:.85rem;">
                                        ${c.user_name.charAt(0).toUpperCase()}
                                    </div>
                                    <span style="font-weight:600;font-size:.9rem;">${c.user_name}</span>
                                </div>
                                <span style="font-size:.8rem;">${'⭐'.repeat(c.rating || 0)}</span>
                            </div>
                            <p style="margin:0;font-size:.88rem;color:var(--text-primary);
                                line-height:1.5;">${c.comment}</p>
                            <span style="font-size:.72rem;color:var(--text-secondary);">
                                ${formatDate(c.created_at)}
                            </span>
                        </div>`).join('')}
            </div>
        </div>`;

    document.body.appendChild(modal);
}

window.submitComment = async function(productId) {
    const input  = document.getElementById('commentInput');
    const rating = document.querySelector('input[name="rating"]:checked');
    if (!input) return;
    await addComment(productId, input.value, parseInt(rating?.value || 5));
    document.querySelector('.comments-modal')?.remove();
    showCommentsModal(productId);
};

// ==================== MENU LATÉRAL ====================
function initSideMenu() {
    const menuBtn     = document.getElementById('menuBtn');
    const closeMenuBtn= document.getElementById('closeMenuBtn');
    const overlay     = document.getElementById('overlay');

    menuBtn?.addEventListener('click', () => {
        document.getElementById('sideMenu')?.classList.add('active');
        overlay?.classList.add('active');
        window.improvedMenu.render();
    });

    closeMenuBtn?.addEventListener('click', () => {
        document.getElementById('sideMenu')?.classList.remove('active');
        overlay?.classList.remove('active');
    });

    overlay?.addEventListener('click', () => {
        document.getElementById('sideMenu')?.classList.remove('active');
        overlay.classList.remove('active');
    });
}

// ==================== PARAMÈTRES ====================
let userSettings = {
    userName     : '',
    notifications: { newProducts:true, promotions:true, comments:true, popular:true },
    preferences  : { darkMode:false, sounds:true },
};

function chargerParametresUtilisateur() {
    try {
        const saved = localStorage.getItem('oda_user_settings');
        if (saved) userSettings = { ...userSettings, ...JSON.parse(saved) };
        if (!userSettings.userName)
            userSettings.userName = localStorage.getItem('oda_user_name') || '';
        _appliquerParametres();
    } catch { /**/ }
}

function _appliquerParametres() {
    const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val; };
    const chk = (id, val) => { const el = document.getElementById(id); if (el) el.checked = val; };
    set('userNameInput', userSettings.userName || 'Non défini');
    chk('notifNewProducts', userSettings.notifications.newProducts);
    chk('notifPromotions',  userSettings.notifications.promotions);
    chk('notifComments',    userSettings.notifications.comments);
    chk('notifPopular',     userSettings.notifications.popular);
    chk('darkMode',         userSettings.preferences.darkMode);
    chk('appSounds',        userSettings.preferences.sounds);
    document.body.classList.toggle('dark-mode', userSettings.preferences.darkMode);
}

function sauvegarderParametres() {
    localStorage.setItem('oda_user_settings', JSON.stringify(userSettings));
    localStorage.setItem('oda_user_name', userSettings.userName);
}

window.ouvrirParametres = function() {
    chargerParametresUtilisateur();
    document.getElementById('settingsModal')?.classList.add('active');
};

window.ouvrirChangementNom = function() {
    const n = prompt('Nouveau nom :', userSettings.userName);
    if (n?.trim() && n.trim() !== userSettings.userName) {
        userSettings.userName = n.trim();
        sauvegarderParametres();
        _appliquerParametres();
        showToast('✅ Nom modifié', 'success');
    }
};

window.effacerDonnees = function() {
    if (confirm('⚠️ Supprimer vos favoris, paramètres et historique ?')) {
        localStorage.clear();
        sessionStorage.clear();
        showToast('✅ Données effacées', 'success');
        setTimeout(() => location.reload(), 1500);
    }
};
function initialiserParametres() {
    const modal   = document.getElementById('settingsModal');
    const content = modal?.querySelector('.settings-modal-content');
    const closeBtn = document.getElementById('settingsCloseBtn');
    const openBtn  = document.getElementById('settingsBtn');

    const ouvrir  = () => { chargerParametresUtilisateur(); modal?.classList.add('active'); };
    const fermer  = () => modal?.classList.remove('active');

    // Ouvrir
    openBtn?.addEventListener('click', (e) => { e.stopPropagation(); ouvrir(); });
    window.ouvrirParametres = ouvrir;
    window.chargerParametresUtilisateur = chargerParametresUtilisateur;

    // Fermer — uniquement le bouton ✕ ou clic sur le fond sombre
    closeBtn?.addEventListener('click', fermer);
    modal?.addEventListener('click', (e) => { if (e.target === modal) fermer(); });

    // BLOQUER toute propagation depuis le contenu du modal
    content?.addEventListener('click',      (e) => e.stopPropagation());
    content?.addEventListener('touchstart', (e) => e.stopPropagation(), { passive: true });
    content?.addEventListener('touchend',   (e) => e.stopPropagation(), { passive: true });

    // Touche Échap
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') fermer(); });

    // Toggles notifications
    ['notifNewProducts','notifPromotions','notifComments','notifPopular'].forEach(id => {
        const el  = document.getElementById(id);
        if (!el) return;
        const key = id.replace('notif','').replace(/^./,c=>c.toLowerCase());
        el.addEventListener('change', function() {
            userSettings.notifications[key] = this.checked;
            sauvegarderParametres();
        });
    });

    document.getElementById('darkMode')?.addEventListener('change', function() {
        userSettings.preferences.darkMode = this.checked;
        document.body.classList.toggle('dark-mode', this.checked);
        sauvegarderParametres();
    });

    document.getElementById('appSounds')?.addEventListener('change', function() {
        userSettings.preferences.sounds = this.checked;
        sauvegarderParametres();
    });
}
// ── Bouton rechargement forcé dans paramètres ──
function addForceReloadButton() {
    const body = document.querySelector('.settings-body');
    if (!body || document.getElementById('cacheSection')) return;

    const section = document.createElement('div');
    section.id = 'cacheSection';
    section.className = 'settings-section';
    section.innerHTML = `
        <div class="section-header">
            <span class="section-icon">💾</span>
            <h3>Cache de l'application</h3>
        </div>
        <div id="cacheInfo" style="background:var(--bg-secondary);padding:14px;
            border-radius:12px;margin-bottom:14px;font-size:.85rem;">
            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                <span style="color:var(--text-secondary);">Statut :</span>
                <strong id="cacheStatus">—</strong>
            </div>
            <div style="display:flex;justify-content:space-between;">
                <span style="color:var(--text-secondary);">Âge :</span>
                <strong id="cacheAge">—</strong>
            </div>
        </div>
        <button class="btn-primary"
            onclick="window.forceReloadData()"
            style="width:100%;background:#3B82F6;margin-bottom:10px;">
            🔄 Forcer le rechargement
        </button>
        <button class="btn-danger" onclick="window.clearAllCache()">
            🗑️ Vider le cache
        </button>`;
    body.appendChild(section);
    _updateCacheInfo();
}

function _updateCacheInfo() {
    const info   = window.cacheManager?.getInfo() || {};
    const status = document.getElementById('cacheStatus');
    const age    = document.getElementById('cacheAge');
    if (status) {
        status.textContent  = info.valid ? 'Valide ✓' : 'Expiré ✗';
        status.style.color  = info.valid ? 'var(--success-color)' : 'var(--error-color)';
    }
    if (age) age.textContent = info.age || 'Nouveau';
}

window.forceReloadData = async function() {
    if (!confirm('Recharger depuis le serveur ?')) return;
    window.loadingProgress.start();
    try {
        const loader = new OptimizedDataLoader(supabase);
        const data   = await loader.forceReload();
        _applyLoadedData(data);
        showToast('✅ Données rechargées', 'success');
        _updateCacheInfo();
    } catch { showToast('❌ Erreur rechargement', 'error'); }
};

window.clearAllCache = function() {
    if (!confirm('Vider le cache ?')) return;
    window.cacheManager.clearAll();
    showToast('🗑️ Cache vidé', 'success');
    _updateCacheInfo();
};

// ==================== HEADER SCROLL ====================
let _lastScrollTop = 0;
function initScrollBehavior() {
    window.addEventListener('scroll', () => {
        const header    = document.querySelector('.main-header');
        if (!header) return;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > _lastScrollTop && scrollTop > 80) {
            header.style.transform = 'translateY(-100%)';
        } else {
            header.style.transform = 'translateY(0)';
        }
        _lastScrollTop = scrollTop;
    }, { passive: true });
}

// ==================== NAVIGATION ====================
window.goToProduct = function(productId) {
    window.location.href = `produit.html?id=${productId}`;
};
window.goToShop = function(shopSlug, productId) {
    if (shopSlug) window.location.href = `boutique.html?shop=${shopSlug}#product-${productId}`;
    else showToast('Boutique non disponible', 'error');
};
window.scrollToProducts = function() {
    document.querySelector('.products-container')
        ?.scrollIntoView({ behavior: 'smooth', block: 'start' });
};

// ==================== UTILITAIRES ====================
function formatPrice(price) {
    return `${Number(price).toLocaleString('fr-FR')} FCFA`;
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    if (!container) return;
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    const icons = { success:'✅', error:'❌', info:'ℹ️', warning:'⚠️' };
    toast.innerHTML = `<span style="font-size:1.1rem;">${icons[type] || 'ℹ️'}</span>
                       <span>${message}</span>`;
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'slideOutRight .3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ==================== EXPOSE GLOBAL ====================
window.toggleFavorite    = toggleFavorite;
window.toggleLike        = toggleLike;
window.showCommentsModal = showCommentsModal;

console.log('✅ Artefact 4 — Utilisateur · Likes · Commentaires · Menu prêt');

function _applyLoadedData(data) {
    allProducts = data.products;

    // Convertir les likes au bon format { count, userLiked }
    Object.keys(data.likes).forEach(id => {
        const raw = data.likes[id];
        productLikes[id] = {
            count     : raw.count ?? (Array.isArray(raw.users) ? raw.users.length : 0),
            userLiked : Array.isArray(raw.users)
                ? raw.users.includes(currentUserId)
                : raw.userLiked ?? false,
        };
    });

    productComments = data.comments;

    // Rafraîchir l'interface
    window.improvedMenu.update(allProducts);
    displayProducts();
    updateCarousel();
    updateBadges();
    console.log(`🔄 Interface mise à jour — ${allProducts.length} produits`);
}

// ==================== CHARGEMENT INITIAL ====================
async function loadAllProductsOptimized() {
    try {
        const loader = new OptimizedDataLoader(supabase);
        const data   = await loader.load();
        _applyLoadedData(data);
        return data;
    } catch (err) {
        console.error('❌ Erreur chargement:', err);
        const emptyState = document.getElementById('emptyState');
        if (emptyState) emptyState.style.display = 'block';
        showToast('Erreur de chargement', 'error');
        throw err;
    }
}


function initRealtimeSubscription() {
    const channel = supabase
        .channel('oda-produits-realtime')
        .on(
            'postgres_changes',
            { event: '*', schema: 'public', table: 'produits' },
            payload => {
                console.log(`🔔 Realtime — ${payload.eventType}`, payload);

                switch (payload.eventType) {

                    case 'INSERT': {
                        // Nouveau produit : enrichir avec données boutique et l'ajouter
                        const p      = payload.new;
                        const shopId = p.user_id;
                        // On récupère les infos boutique depuis le cache existant si disponible
                        const cached = window.cacheManager.loadAll();
                        const shop   = cached.shops?.[shopId] || {};

                        const enriched = {
                            id         : p.id,
                            nom        : p.nom,
                            description: p.description,
                            prix       : p.prix,
                            stock      : p.stock,
                            mainImage  : p.main_image,
                            categorie  : p.categorie,
                            userId     : p.user_id,
                            created_at : p.created_at,
                            shopName   : shop.nom || 'Boutique',
                            shopSlug   : shop.identifiant,
                            shopColor  : shop.couleurPrimaire || '#FF6B00',
                            rating     : '0.0',
                            likes      : 0,
                        };

                        // N'ajouter que si publié et en stock
                        if (p.statut === 'published' && p.stock > 0) {
                            allProducts.unshift(enriched);
                            showToast('🆕 Nouveau produit disponible !', 'info');
                        }
                        break;
                    }

                    case 'UPDATE': {
                        const p   = payload.new;
                        const idx = allProducts.findIndex(x => x.id === p.id);

                        if (idx === -1) {
                            // Peut-être que le produit vient d'être publié
                            if (p.statut === 'published' && p.stock > 0) {
                                allProducts.unshift({
                                    id: p.id, nom: p.nom, description: p.description,
                                    prix: p.prix, stock: p.stock, mainImage: p.main_image,
                                    categorie: p.categorie, userId: p.user_id,
                                    created_at: p.created_at, shopName: 'Boutique',
                                    shopColor: '#FF6B00', rating: '0.0', likes: 0,
                                });
                            }
                        } else {
                            // Mettre à jour le produit existant
                            allProducts[idx] = {
                                ...allProducts[idx],
                                nom       : p.nom,
                                description: p.description,
                                prix      : p.prix,
                                stock     : p.stock,
                                mainImage : p.main_image,
                                categorie : p.categorie,
                            };
                            // Si le produit n'est plus publié ou hors stock, le retirer
                            if (p.statut !== 'published' || p.stock <= 0) {
                                allProducts.splice(idx, 1);
                            }
                        }
                        break;
                    }

                    case 'DELETE': {
                        const id  = payload.old.id;
                        allProducts = allProducts.filter(x => x.id !== id);
                        break;
                    }

                    default: break;
                }

                // ✅ Mettre à jour l'interface immédiatement
                window.improvedMenu.update(allProducts);
                displayProducts();
                updateCarousel();

                // ✅ Mettre à jour le cache avec les nouvelles données
                const cached = window.cacheManager.loadAll();
                window.cacheManager.saveAll(
                    allProducts,
                    cached.likes    || productLikes,
                    cached.comments || productComments,
                    cached.shops    || {},
                );
            }
        )
        .subscribe(status => {
            if (status === 'SUBSCRIBED') {
                console.log('✅ Realtime actif — mise à jour automatique des produits');
            } else {
                console.warn('⚠️ Statut Realtime :', status);
            }
        });

    return channel;
}

// ==================== FILTRAGE PAR CATÉGORIE (EVENT) ====================
function setupCategoryFiltering() {
    window.addEventListener('categorySelected', e => {
        filterByCategory(e.detail.category, e.detail.subcategory || 'all');
    });
}

// ==================== AUTO-REFRESH (onglet redevient visible) ====================
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState !== 'visible') return;
    if (!window.cacheManager.isValid()) {
        console.log('🔄 Onglet réactivé — cache expiré, rechargement…');
        loadAllProductsOptimized();
    } else {
        console.log('👁️ Onglet réactivé — cache encore valide');
    }
});

// ==================== INITIALISATION COMPLÈTE ====================
document.addEventListener('DOMContentLoaded', async () => {
    console.log('🚀 ODA MARKETPLACE — démarrage');
    console.log('='.repeat(48));

    // Masquer l'ancien loader HTML si présent
    const oldLoader = document.getElementById('loader');
    if (oldLoader) oldLoader.style.display = 'none';

    // 1. Charger les favoris
    loadFavorites();
    updateBadges();

    // 2. Charger les données (cache ou Supabase)
    await loadAllProductsOptimized();

    // 3. Initialiser les composants UI
    setupCategoryFiltering();
    initSideMenu();
    initCarouselControls();
    initSearch();
    initScrollBehavior();
    initialiserParametres();
    addForceReloadButton();

    // 4. Activer le Realtime Supabase ✅
    initRealtimeSubscription();

    // 5. PWA
    if (typeof window.verifierStatutNotifications === 'function') {
        window.verifierStatutNotifications();
    }
    if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-mode');
        console.log('📱 Mode PWA détecté');
    }

    console.log('='.repeat(48));
    console.log('✅ ODA prêt !');
    console.log('   ✓ Cache 5 min');
    console.log('   ✓ Realtime Supabase actif');
    console.log('   ✓ Catégories avec sous-catégories');
    console.log('   ✓ Scroll horizontal par section');
    console.log('   ✓ Mise à jour UI instantanée');
});

// ==================== STYLES ANIMATIONS GLOBALES ====================
(function injectGlobalStyles() {
    if (document.getElementById('oda-global-styles')) return;
    const s = document.createElement('style');
    s.id = 'oda-global-styles';
    s.textContent = `
        @keyframes shimmer {
            0%   { background-position: -200% 0; }
            100% { background-position:  200% 0; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to   { transform: translateY(0); }
        }
        @keyframes slideOutRight {
            to { opacity: 0; transform: translateX(100%); }
        }
        .modal-backdrop {
            position: fixed; inset: 0;
            background: rgba(0,0,0,.5);
            z-index: 8999;
        }
        .toast {
            display: flex; align-items: center; gap: 10px;
            background: #1A1A1A; color: #fff;
            padding: 12px 18px; border-radius: 12px;
            margin-bottom: 10px; font-size: .9rem; font-weight: 500;
            animation: slideInRight .3s ease;
            box-shadow: 0 4px 16px rgba(0,0,0,.2);
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(80px); }
            to   { opacity: 1; transform: translateX(0); }
        }
        .toast.success { border-left: 4px solid #10B981; }
        .toast.error   { border-left: 4px solid #EF4444; }
        .toast.info    { border-left: 4px solid #3B82F6; }
        .toast.warning { border-left: 4px solid #F59E0B; }
    `;
    document.head.appendChild(s);
})();

console.log('✅ Artefact 5 — Realtime · Init · Auto-refresh prêt');
</script>
</body>
</html>

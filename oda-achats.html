

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B00">
    <link rel="manifest" href="manifest.json">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <link rel="apple-touch-icon" href="/oda1.png">
    <title>ODA Marketplace - Tous les produits</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="oda-shop-styles.css">
    <link rel="icon" type="image/png" href="oda1.png">
    <link rel="icon" type="image/png" href="oda1.png">

<!-- PWA Manager Script -->

</head>
<style>
    /* ==================== VARIABLES ==================== */
:root {
    --primary-color: #FF6B00;
    --primary-dark: #E55D00;
    --secondary-color: #1A1A1A;
    --bg-primary: #FFFFFF;
    --bg-secondary: #F8F9FA;
    --text-primary: #1A1A1A;
    --text-secondary: #6B7280;
    --border-color: #E5E7EB;
    --success-color: #10B981;
    --error-color: #EF4444;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: var(--bg-secondary);
    color: var(--text-primary);
    overflow-x: hidden;
}

/* ==================== HEADER ==================== */
.main-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: #2C3E50;
    box-shadow: var(--shadow-md);
    z-index: 1000;
    padding: 12px 16px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
}

.menu-btn {
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.3rem;
    font-weight: 800;
    color: white;
}

.header-icons {
    display: flex;
    gap: 12px;
    align-items: center;
}

.icon-btn {
    position: relative;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.icon-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.icon-btn .badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--primary-color);
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
}

.search-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 12px 0 0;
}

.search-box {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(255, 255, 255, 0.15);
    padding: 10px 16px;
    border-radius: 24px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.search-box:focus-within {
    background: rgba(255, 255, 255, 0.25);
    border-color: var(--primary-color);
}

.search-box svg {
    color: rgba(255, 255, 255, 0.7);
    flex-shrink: 0;
}

.search-box input {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 0.95rem;
    color: white;
    outline: none;
}

.search-box input::placeholder {
    color: rgba(255, 255, 255, 0.6);
}

/* ==================== CAROUSEL BANNIÈRE ARRONDIE ==================== */
.hero-carousel {
    margin-top: 140px;
    height: 400px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #f8f8f8 0%, #020202 100%);
    border-radius: 24px;
    margin-left: 16px;
    margin-right: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
}

.carousel-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 24px;
    overflow: hidden;
}

.carousel-container {
    display: flex;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    height: 100%;
}

.carousel-item {
    min-width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

.carousel-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
}

.carousel-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    padding: 40px;
    color: white;
}

.carousel-info h2 {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

.carousel-info .shop-name {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-bottom: 4px;
}

.carousel-info .product-price {
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--primary-color);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
}

/* Message de découverte */
.hero-message {
    position: absolute;
    top: 40px;
    left: 40px;
    right: 40px;
    text-align: center;
    z-index: 5;
    color: rgb(5, 5, 5);
    text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
}

.hero-message h2 {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
}

.hero-message p {
    font-size: 1.1rem;
    opacity: 0.95;
}

/* Boutons transparents sur la bannière */
.banner-actions {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 10;
}

.banner-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 16px;
    padding: 16px 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    min-width: 100px;
}

.banner-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.banner-icon {
    font-size: 2rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.carousel-btn:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
}

.carousel-btn.prev {
    left: 20px;
}

.carousel-btn.next {
    right: 20px;
}

.carousel-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
}

.dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.dot:hover {
    background: rgba(255, 255, 255, 0.8);
}

.dot.active {
    background: white;
    width: 32px;
    border-radius: 5px;
}

/* ==================== GRID PRODUITS - VERSION COMPACTE ==================== */
.products-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.product-count {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* ==================== PRODUCTS GRID - COMPACT VERSION ==================== */
.products-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);  /* MODIFIÉ: Grille fixe 2 colonnes */
    gap: 12px;  /* MODIFIÉ: Réduit de 16px à 12px */
    animation: fadeIn 0.5s ease;
}

/* ==================== PRODUCT CARD - COMPACT DESIGN ==================== */
.product-card {
    background: var(--bg-primary);
    border-radius: 12px;  /* MODIFIÉ: Augmenté de 8px à 12px */
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);  /* MODIFIÉ: Transition plus fluide */
    cursor: pointer;
    position: relative;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
}

.product-card:hover {
    transform: translateY(-2px);  /* MODIFIÉ: Réduit le mouvement */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
    border-color: var(--primary-color);
}

/* Image Container - COMPACT */
.product-image-wrapper {
    position: relative;
    width: 100%;
    padding-top: 65%;  /* MODIFIÉ: Réduit de 100% à 65% */
    background: #f5f5f5;  /* MODIFIÉ: Couleur de fond */
    overflow: hidden;
}

.product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

/* NOUVEAU: Time Badge (badge de temps sur l'image) */
.time-badge {
    position: absolute;
    bottom: 8px;
    left: 8px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Favorite Button - COMPACT */
.btn-favorite {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;  /* MODIFIÉ: Réduit de 36px à 32px */
    height: 32px;  /* MODIFIÉ: Réduit de 36px à 32px */
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);  /* AJOUTÉ: Effet de flou */
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;  /* MODIFIÉ: Réduit de 1.1rem à 1rem */
    z-index: 5;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.btn-favorite:hover {
    transform: scale(1.1);  /* MODIFIÉ: Réduit de 1.15 à 1.1 */
    background: white;  /* AJOUTÉ: Fond blanc au hover */
}

.btn-favorite.active {
    background: var(--error-color);
    color: white;  /* AJOUTÉ: Texte blanc quand actif */
}

/* Product Info Section - COMPACT */
.product-info {
    padding: 10px;  /* MODIFIÉ: Réduit de 12px à 10px */
    display: flex;
    flex-direction: column;
    gap: 6px;  /* MODIFIÉ: Réduit de 8px à 6px */
    flex: 1;
}

/* Product Name - COMPACT */
.product-name {
    font-size: 0.85rem;  /* MODIFIÉ: Réduit de 0.9rem à 0.85rem */
    font-weight: 700;  /* MODIFIÉ: Augmenté de 600 à 700 */
    color: var(--text-primary);
    display: -webkit-box;
    -webkit-line-clamp: 1;  /* MODIFIÉ: Réduit de 2 à 1 ligne */
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.3;  /* MODIFIÉ: Réduit de 1.4 à 1.3 */
    margin-bottom: 2px;  /* AJOUTÉ: Espacement en bas */
}

/* Shop Badge - SIMPLIFIÉE */
.shop-badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;  /* MODIFIÉ: Réduit de 4px à 3px */
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 500;  /* MODIFIÉ: Réduit de 600 à 500 */
    width: fit-content;
    /* SUPPRIMÉ: padding et background pour style plus épuré */
}

.shop-badge svg {
    width: 12px;
    height: 12px;
}

/* NOUVEAU: Rating (étoiles et nombre) */
.product-rating {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 600;
}

.product-rating .star {
    color: #FFC107;
    font-size: 0.75rem;
}

/* NOUVEAU: Price and Action Row */
.product-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
}

/* Product Price - COMPACT */
.product-price {
    font-size: 1.1rem;  /* MODIFIÉ: Réduit de 1.2rem à 1.1rem */
    font-weight: 800;
    color: var(--primary-color);
}

/* NOUVEAU: Add Button (bouton +) */
.btn-add {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--secondary-color);
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.2rem;
    font-weight: 300;
}

.btn-add:hover {
    background: var(--primary-color);
    transform: scale(1.1);
}

.btn-add:active {
    transform: scale(0.95);
}

/* Product Stock - MODIFIÉ */
.product-stock {
    font-size: 0.7rem;  /* MODIFIÉ: Réduit de 0.75rem à 0.7rem */
    color: var(--success-color);
    font-weight: 600;  /* MODIFIÉ: Augmenté de 500 à 600 */
    display: flex;
    align-items: center;
    gap: 4px;
}

.product-stock.out-of-stock {
    color: var(--error-color);
}

/* ==================== SCROLL HORIZONTAL CATEGORIES ==================== */
.horizontal-scroll::-webkit-scrollbar {
    height: 8px;
}

.horizontal-scroll::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 4px;
}

.horizontal-scroll::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}

.horizontal-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* ==================== ANIMATIONS ==================== */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Staggered animation for cards */
.product-card {
    animation: slideInUp 0.4s ease backwards;
}

.product-card:nth-child(1) { animation-delay: 0.05s; }
.product-card:nth-child(2) { animation-delay: 0.1s; }
.product-card:nth-child(3) { animation-delay: 0.15s; }
.product-card:nth-child(4) { animation-delay: 0.2s; }
.product-card:nth-child(5) { animation-delay: 0.25s; }
.product-card:nth-child(6) { animation-delay: 0.3s; }

/* ==================== LOADER ==================== */
.loader {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    gap: 16px;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--border-color);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loader p {
    font-weight: 600;
    color: var(--text-secondary);
}

/* ==================== EMPTY STATE ==================== */
.empty-state {
    text-align: center;
    padding: 80px 20px;
    color: var(--text-secondary);
}

.empty-state svg {
    width: 100px;
    height: 100px;
    margin-bottom: 20px;
    opacity: 0.3;
}


/* ==================== BOUTONS DÉCLENCHEURS ==================== */
.modal-trigger-buttons {
    position: fixed;
    bottom: 80px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 999;
}

.modal-trigger-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    border: none;
    border-radius: 50px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    color: white;
}

.modal-trigger-btn .btn-icon {
    font-size: 1.2rem;
}

.modal-trigger-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
}

.about-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.contact-btn {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.help-btn {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

/* ==================== MODAL CONTAINER ==================== */
.oda-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    animation: modalFadeIn 0.3s ease;
}

.oda-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    animation: overlayFadeIn 0.3s ease;
}

.modal-content {
    position: relative;
    width: 90%;
    max-width: 600px;
    max-height: 85vh;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

/* Variantes de couleurs pour chaque modal */
.modal-about {
    border-top: 5px solid #667eea;
}

.modal-contact {
    border-top: 5px solid #f5576c;
}

.modal-help {
    border-top: 5px solid #00f2fe;
}

.modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.modal-close:hover {
    background: #ff4757;
    color: white;
    transform: rotate(90deg) scale(1.1);
}

.modal-close svg {
    width: 20px;
    height: 20px;
}

/* ==================== MODAL HEADER ==================== */
.modal-header {
    text-align: center;
    padding: 40px 30px 20px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
}

.modal-contact .modal-header {
    background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
}

.modal-help .modal-header {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
}

.modal-icon-wrapper {
    display: inline-block;
    margin-bottom: 16px;
}

.modal-main-icon {
    font-size: 4rem;
    display: inline-block;
}

.modal-title {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.modal-contact .modal-title {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.modal-help .modal-title {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ==================== MODAL BODY ==================== */
.modal-body {
    padding: 30px;
    max-height: calc(85vh - 200px);
    overflow-y: auto;
}

.modal-body::-webkit-scrollbar {
    width: 8px;
}

.modal-body::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
}

.modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
}

/* ==================== INFO CARDS ==================== */
.info-card, .help-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
}

.info-card:hover, .help-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.info-card {
    display: flex;
    gap: 20px;
    align-items: flex-start;
}

.info-icon, .help-icon {
    font-size: 2.5rem;
    flex-shrink: 0;
}

.info-content h3, .help-content h3 {
    font-size: 1.2rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.info-content p, .help-content p {
    color: #4a5568;
    line-height: 1.6;
    margin-bottom: 12px;
}

.steps-list, .objectives-list, .benefits-list {
    margin: 16px 0;
    padding-left: 20px;
}

.steps-list li, .objectives-list li, .benefits-list li {
    margin-bottom: 12px;
    color: #4a5568;
    line-height: 1.6;
}

/* ==================== COLOR BADGES ==================== */
.color-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
    margin: 0 4px;
}

.color-badge.red {
    background: rgba(239, 68, 68, 0.2);
    color: #dc2626;
}

.color-badge.blue {
    background: rgba(59, 130, 246, 0.2);
    color: #2563eb;
}

.color-badge.green {
    background: rgba(16, 185, 129, 0.2);
    color: #059669;
}

.color-badge.yellow {
    background: rgba(245, 158, 11, 0.2);
    color: #d97706;
}

/* ==================== FUN FACT BOX ==================== */
.fun-fact {
    background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 24px;
    box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3);
}

.fact-icon {
    font-size: 2.5rem;
}

.fun-fact p {
    margin: 0;
    color: #2d3436;
    font-size: 1rem;
}

/* ==================== CREATOR SECTION ==================== */
.creator-story {
    background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    border-left: 5px solid #f5576c;
}

.creator-story h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

.creator-story p {
    color: #4a5568;
    line-height: 1.8;
    margin-bottom: 16px;
}

.creator-info {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
}

.creator-info h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
}

/* ==================== IMAGE PLACEHOLDER ==================== */
.creator-image-zone {
    margin: 24px 0;
}

.image-placeholder {
    background: linear-gradient(135deg, #e0e7ff 0%, #f3e7ff 100%);
    border-radius: 16px;
    padding: 60px 20px;
    text-align: center;
    border: 3px dashed #a78bfa;
}

.placeholder-icon {
    font-size: 4rem;
    display: block;
    margin-bottom: 12px;
}

.image-placeholder p {
    color: #6b7280;
    font-weight: 600;
    margin: 0;
}

.image-placeholder img {
    max-width: 100%;
    border-radius: 16px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
}

/* ==================== CONTACT DETAILS ==================== */
.contact-details {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
}

.contact-details h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: #1a1a1a;
}

.contact-grid {
    display: grid;
    gap: 16px;
}

.contact-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.contact-item:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: translateX(8px);
}

.contact-icon {
    font-size: 1.8rem;
    flex-shrink: 0;
}

.contact-item strong {
    display: block;
    font-size: 0.85rem;
    color: #6b7280;
    margin-bottom: 4px;
}

.contact-item p, .contact-item a {
    color: #1a1a1a;
    font-weight: 600;
    margin: 0;
    text-decoration: none;
}

.contact-item a:hover {
    color: #f5576c;
}

/* ==================== ALERT & TIP BOXES ==================== */
.alert-box {
    background: rgba(16, 185, 129, 0.1);
    border-left: 4px solid #10b981;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.alert-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.alert-box p {
    margin: 0;
    color: #047857;
    font-weight: 500;
}

.tip-box {
    background: rgba(245, 158, 11, 0.1);
    border-left: 4px solid #f59e0b;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.tip-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.tip-box p {
    margin: 0;
    color: #92400e;
    font-weight: 500;
}

/* ==================== VENDOR SECTION ==================== */
.vendor-section {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
    border-radius: 16px;
    padding: 24px;
    margin-top: 24px;
    text-align: center;
}

.vendor-section h3 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #1a1a1a;
}

.vendor-section p {
    color: #4a5568;
    margin-bottom: 12px;
}

/* ==================== DOWNLOAD BUTTON ==================== */
.download-btn {
    display: flex;
    align-items: center;
    gap: 16px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 18px 28px;
    border-radius: 16px;
    text-decoration: none;
    margin: 24px auto;
    max-width: 400px;
    box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: pulseGlow 2s ease-in-out infinite;
}

.download-btn:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 35px rgba(79, 172, 254, 0.5);
}

.btn-icon-left, .btn-icon-right {
    font-size: 1.8rem;
}

.btn-text-main {
    flex: 1;
    text-align: left;
}

.btn-text-main strong {
    display: block;
    font-size: 1.1rem;
    margin-bottom: 4px;
}

.btn-text-main small {
    display: block;
    font-size: 0.85rem;
    opacity: 0.9;
}

/* ==================== VENDOR BENEFITS ==================== */
.vendor-benefits {
    margin-top: 24px;
    text-align: left;
}

.vendor-benefits h4 {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #1a1a1a;
    text-align: center;
}

.benefits-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.benefit-item {
    background: rgba(255, 255, 255, 0.8);
    padding: 12px 16px;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    color: #1a1a1a;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

/* ==================== FAQ SECTION ==================== */
.faq-section {
    background: rgba(255, 255, 255, 0.6);
    border-radius: 16px;
    padding: 24px;
}

.faq-section h3 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: #1a1a1a;
}

.faq-item {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.faq-item:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.faq-item strong {
    display: block;
    font-size: 1rem;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.faq-item p {
    color: #4a5568;
    line-height: 1.6;
    margin: 0;
}

.faq-item a {
    color: #4facfe;
    text-decoration: none;
    font-weight: 600;
}

.faq-item a:hover {
    text-decoration: underline;
}

/* ==================== ANIMATIONS ==================== */
@keyframes modalFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes overlayFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes modalSlideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slide-in {
    from {
        transform: translateX(-30px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.slide-in {
    animation: slide-in 0.6s ease forwards;
}

@keyframes pulse-animation {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

.pulse-animation {
    animation: pulse-animation 2s ease-in-out infinite;
}

@keyframes rotate-animation {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.rotate-animation:hover {
    animation: rotate-animation 1s ease-in-out;
}

@keyframes shake-animation {
    0%, 100% {
        transform: translateX(0);
    }
    25% {
        transform: translateX(-10px);
    }
    75% {
        transform: translateX(10px);
    }
}

.shake-animation:hover {
    animation: shake-animation 0.5s ease;
}

@keyframes bounce-animation {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.bounce-animation {
    animation: bounce-animation 2s ease-in-out infinite;
}

@keyframes pulseGlow {
    0%, 100% {
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
    }
    50% {
        box-shadow: 0 8px 35px rgba(79, 172, 254, 0.6);
    }
}

/* ==================== TOAST NOTIFICATIONS ==================== */
.toast-container {
    position: fixed;
    top: 90px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 350px;
}

.toast {
    background: white;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    animation: slideInRight 0.3s ease;
    border-left: 4px solid var(--primary-color);
}

.toast.success {
    border-left-color: var(--success-color);
}

.toast.error {
    border-left-color: var(--error-color);
}

@keyframes slideInRight {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 768px) {
    .main-header {
        padding: 10px 12px;
    }

    .logo {
        font-size: 1.1rem;
    }

    .icon-btn {
        width: 36px;
        height: 36px;
    }

    .search-container {
        padding: 8px 0 0;
    }

    .hero-carousel {
        height: 350px;
        margin-top: 130px;
        border-radius: 16px;
        margin-left: 12px;
        margin-right: 12px;
    }

    .hero-message {
        top: 20px;
        left: 20px;
        right: 20px;
    }

    .hero-message h2 {
        font-size: 1.3rem;
    }

    .hero-message p {
        font-size: 0.9rem;
    }

    .banner-actions {
        bottom: 60px;
        gap: 12px;
    }

    .banner-btn {
        padding: 12px 16px;
        min-width: 80px;
        font-size: 0.8rem;
    }

    .banner-icon {
        font-size: 1.5rem;
    }

    .carousel-overlay {
        padding: 20px;
    }

    .carousel-info h2 {
        font-size: 1.3rem;
    }

    .carousel-info .product-price {
        font-size: 1.3rem;
    }

    .carousel-btn {
        width: 40px;
        height: 40px;
    }

    .carousel-btn.prev {
        left: 10px;
    }

    .carousel-btn.next {
        right: 10px;
    }

    .products-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .tabs-nav {
        overflow-x: auto;
        justify-content: flex-start;
        padding: 12px 16px;
        top: 130px;
        margin: 16px 12px;
    }

    .tab-btn {
        padding: 10px 20px;
        font-size: 0.85rem;
        white-space: nowrap;
    }
    
    .modal-content {
        width: 95%;
        max-height: 90vh;
        border-radius: 20px;
    }
    
    .modal-header {
        padding: 30px 20px 16px;
    }
    
    .modal-title {
        font-size: 1.5rem;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .info-card, .help-card {
        flex-direction: column;
        padding: 20px;
    }
    
    .contact-grid {
        grid-template-columns: 1fr;
    }
    
    .benefits-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-trigger-buttons {
        bottom: 70px;
        right: 16px;
    }
    
    .modal-trigger-btn {
        padding: 10px 16px;
        font-size: 0.9rem;
    }
    
    .download-btn {
        flex-direction: column;
        text-align: center;
        padding: 20px;
    }
    
    .btn-text-main {
        text-align: center;
    }
}

@media (max-width: 480px) {
    .hero-carousel {
        height: 300px;
        margin-top: 120px;
    }

    .banner-actions {
        flex-direction: row;
        gap: 8px;
        bottom: 50px;
    }

    .banner-btn {
        padding: 10px 12px;
        min-width: 70px;
        font-size: 0.75rem;
    }

    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .modal-main-icon {
        font-size: 3rem;
    }
    
    .info-icon, .help-icon {
        font-size: 2rem;
    }
    
    .modal-trigger-btn .btn-text {
        display: none;
    }
    
    .modal-trigger-btn {
        width: 50px;
        height: 50px;
        padding: 0;
        justify-content: center;
    }
    
    .modal-trigger-btn .btn-icon {
        font-size: 1.5rem;
    }
}

/* ==================== RESPONSIVE DESIGN FOR PRODUCTS ==================== */

/* Tablets */
@media (min-width: 640px) {
    .products-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
    }
}

/* Desktop Small */
@media (min-width: 1024px) {
    .products-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
    }
    
    .product-name {
        font-size: 0.9rem;
    }
    
    .product-price {
        font-size: 1.2rem;
    }
}

/* Desktop Large */
@media (min-width: 1280px) {
    .products-grid {
        grid-template-columns: repeat(5, 1fr);
    }
}

/* ==================== LIKES ET COMMENTAIRES ==================== */

/* Engagement buttons sur les cartes produits */
.product-engagement {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 8px 0;
}

.btn-like,
.btn-comments {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 6px 12px;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-like:hover,
.btn-comments:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.btn-like.liked {
    background: #FFE5E5;
    border-color: var(--error-color);
    color: var(--error-color);
}

.btn-like .like-icon {
    font-size: 1rem;
}

/* ==================== MODAL COMMENTAIRES ==================== */
.comments-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(50px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Stats du produit */
.modal-stats {
    display: flex;
    justify-content: space-around;
    padding: 20px;
    background: var(--bg-secondary);
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.stat-icon {
    font-size: 1.5rem;
}

.stat-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* Formulaire de commentaire */
.comment-form {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
}

.comment-form h4 {
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
}

.rating-input {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}

.rating-input input[type="radio"] {
    display: none;
}

.rating-input label {
    cursor: pointer;
    transition: transform 0.2s ease;
}

.rating-input label:hover {
    transform: scale(1.1);
}

.rating-input input:checked + .star {
    filter: drop-shadow(0 2px 4px rgba(255, 107, 0, 0.5));
}

.rating-input .star {
    font-size: 0.9rem;
}

.comment-form textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.95rem;
    resize: vertical;
    min-height: 80px;
    margin-bottom: 12px;
    transition: border-color 0.3s ease;
}

.comment-form textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}

.btn-submit {
    width: 100%;
    padding: 12px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-submit:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.btn-submit:active {
    transform: translateY(0);
}

/* Liste des commentaires */
.comments-list {
    padding: 20px;
}

.comments-list h4 {
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 600;
}

.empty-comments {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
}

.empty-comments p:first-child {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.comment-item {
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.comment-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.comment-user {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.9rem;
}

.user-name {
    font-weight: 600;
    color: var(--text-primary);
}

.comment-rating {
    font-size: 0.85rem;
}

.comment-text {
    margin: 8px 0;
    line-height: 1.6;
    color: var(--text-primary);
}

.comment-date {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* ==================== MODAL PARAMÈTRES ==================== */
.settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 10000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

.settings-modal.active {
    display: flex;
}

.settings-modal-content {
    position: relative;
    background: white;
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
    z-index: 1;
}

.settings-header {
    background: linear-gradient(135deg, #FF6B00, #E55D00);
    color: white;
    padding: 24px;
    border-radius: 20px 20px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 10;
}

.settings-header h2 {
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0;
}

.settings-header .btn-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.settings-header .btn-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.settings-body {
    padding: 24px;
    background: white;
}

.settings-section {
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 2px solid var(--border-color);
}

.settings-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.section-icon {
    font-size: 1.5rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.label-badge {
    padding: 4px 12px;
    background: var(--success-color);
    color: white;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
    transition: all 0.3s ease;
}

.label-badge.disabled {
    background: var(--error-color);
}

.form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 0.95rem;
    font-family: inherit;
    transition: all 0.3s ease;
    background: white;
    color: var(--text-primary);
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
}

.form-input:read-only {
    background: var(--bg-secondary);
    cursor: not-allowed;
}

.form-hint {
    display: block;
    margin-top: 8px;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.btn-primary {
    padding: 12px 24px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    background: #ccc;
}

.btn-danger {
    width: 100%;
    padding: 14px 20px;
    background: var(--error-color);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-danger:hover {
    background: #DC2626;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-danger:active {
    transform: translateY(0);
}

/* Toggle Switch */
.settings-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
}

.settings-toggle:hover {
    background: var(--border-color);
    transform: translateX(4px);
}

.toggle-info {
    flex: 1;
}

.toggle-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
    font-size: 0.95rem;
}

.toggle-desc {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

.switch {
    position: relative;
    display: inline-block;
    width: 52px;
    height: 28px;
    flex-shrink: 0;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 28px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked + .slider {
    background-color: var(--primary-color);
}

input:focus + .slider {
    box-shadow: 0 0 1px var(--primary-color);
}

input:checked + .slider:before {
    transform: translateX(24px);
}

/* Scrollbar personnalisée pour le modal */
.settings-modal-content::-webkit-scrollbar {
    width: 8px;
}

.settings-modal-content::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 0 0 20px 0;
}

.settings-modal-content::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 10px;
}

.settings-modal-content::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

/* Responsive */
@media (max-width: 768px) {
    .settings-modal {
        padding: 0;
        align-items: flex-end;
    }
    
    .settings-modal-content {
        max-height: 95vh;
        border-radius: 20px 20px 0 0;
        animation: slideUpModal 0.3s ease;
    }
    
    .settings-header {
        border-radius: 20px 20px 0 0;
        padding: 20px;
    }
    
    .settings-header h2 {
        font-size: 1.2rem;
    }
    
    .settings-body {
        padding: 20px 16px;
    }
    
    .settings-section {
        margin-bottom: 24px;
        padding-bottom: 20px;
    }
    
    .settings-toggle {
        padding: 14px;
    }
}

@keyframes slideUpModal {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Mode sombre (optionnel) */
body.dark-mode {
    background: #1a1a1a;
    color: #ffffff;
}

body.dark-mode .settings-modal-content {
    background: #2d2d2d;
}

body.dark-mode .settings-body {
    background: #2d2d2d;
}

body.dark-mode .settings-toggle {
    background: #3a3a3a;
}

body.dark-mode .settings-toggle:hover {
    background: #4a4a4a;
}

body.dark-mode .form-input {
    background: #3a3a3a;
    border-color: #4a4a4a;
    color: white;
}

body.dark-mode .form-input:read-only {
    background: #2a2a2a;
}

body.dark-mode .toggle-title {
    color: white;
}

body.dark-mode .toggle-desc {
    color: #aaa;
}

body.dark-mode .section-header h3 {
    color: white;
}

/* Structure du menu - 3 sections */
.side-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 85%;
    max-width: 320px;
    height: 100vh;
    background: var(--bg-primary);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    z-index: 2000;
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.side-menu.active {
    left: 0;
}

/* Header - FIXE */
.menu-header {
    flex-shrink: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    box-shadow: 0 2px 8px rgba(255, 107, 0, 0.2);
}

.menu-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-close:active {
    transform: rotate(90deg) scale(0.9);
}

/* Contenu du menu */
.menu-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Section Catégories - SCROLLABLE */
.menu-section.categories-section {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 20px;
    border-bottom: 2px solid var(--border-color);
    position: relative;
}

/* Personnalisation de la scrollbar */
.menu-section.categories-section::-webkit-scrollbar {
    width: 6px;
}

.menu-section.categories-section::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: 10px;
}

.menu-section.categories-section::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--primary-color), var(--primary-dark));
    border-radius: 10px;
}

.menu-section.categories-section::-webkit-scrollbar-thumb:hover {
    background: var(--primary-color);
}

/* Sections Navigation et Informations - FIXES */
.menu-section.fixed-section {
    flex-shrink: 0;
    padding: 16px 20px;
    background: var(--bg-primary);
}

.menu-section h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* Liste de catégories */
.category-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.category-item {
    padding: 14px 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 12px;
    z-index: -1;
}

.category-item:hover::before {
    width: 100%;
}

.category-item:hover {
    color: white;
    transform: translateX(5px);
}

.category-item:active {
    transform: translateX(5px) scale(0.98);
}

.category-item.active {
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    color: white;
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.category-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    padding: 0 10px;
    background: rgba(255, 107, 0, 0.15);
    color: var(--primary-color);
    font-size: 0.8rem;
    font-weight: 700;
    border-radius: 14px;
    margin-left: auto;
    transition: all 0.3s ease;
}

.category-item.active .category-badge,
.category-item:hover .category-badge {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}

/* Liens du menu */
.menu-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    margin-bottom: 8px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.menu-link::before {
    content: '';
    position: absolute;
    left: -100%;
    top: 0;
    height: 100%;
    width: 4px;
    background: var(--primary-color);
    transition: left 0.3s ease;
}

.menu-link:hover::before {
    left: 0;
}

.menu-link:hover {
    background: rgba(255, 107, 0, 0.05);
    transform: translateX(4px);
}

.menu-link:active {
    transform: translateX(4px) scale(0.98);
}

.menu-link svg {
    flex-shrink: 0;
    transition: transform 0.3s ease;
}

.menu-link:hover svg {
    transform: scale(1.1);
}

/* Overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1500;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.overlay.active {
    opacity: 1;
    visibility: visible;
}

/* Responsive */
@media (min-width: 640px) {
    .side-menu {
        max-width: 400px;
    }
}

/* Indicateur de scroll */
.scroll-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: linear-gradient(to top, var(--bg-primary), transparent);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 10px;
}

.scroll-indicator::after {
    content: '⬇';
    font-size: 1.2rem;
    color: var(--primary-color);
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.menu-section.categories-section.has-scroll .scroll-indicator {
    opacity: 1;
}

.category-list {
    scroll-behavior: smooth;
}

.category-new {
    background: var(--success-color);
    color: white;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    font-weight: 700;
}

</style>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p>Chargement des produits...</p>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <button class="menu-btn" id="menuBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
            
            <div class="logo">
                🛍️ Odamarket
            </div>
            
            <div class="header-icons">
                <button class="icon-btn" onclick="window.location.href='favorie.html'">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    <span class="badge" id="favBadge">0</span>
                </button>
                
                <!-- NOUVEAU BOUTON PARAMÈTRES -->
                <button class="icon-btn" id="settingsBtn" title="Paramètres">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
                <button class="icon-btn" id="notifBtn" title="Notifications">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                </button>
                
               
            </div>
        </div>
        
        <!-- Barre de recherche -->
        <div class="search-container">
            <div class="search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" placeholder="Rechercher des produits, boutiques..." id="searchInput">
            </div>
        </div>
    </header>
   <!-- Menu latéral avec structure améliorée -->
   <div class="side-menu" id="sideMenu">
    <!-- Header - FIXE -->
    <div class="menu-header">
        <h2>
            <span>📂</span>
            <span>Menu</span>
        </h2>
        <button class="btn-close" id="closeMenuBtn" aria-label="Fermer le menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>
    
    <div class="menu-content">
        <!-- Section Catégories - SCROLLABLE -->
        <div class="menu-section categories-section" id="categoriesSection">
            <h3>
                <span>🏷️</span>
                <span>Catégories</span>
            </h3>
            <div class="category-list" id="categoryList">
                <!-- Généré dynamiquement par JavaScript -->
                <div class="category-item active" data-category="Tous">
                    <span>Tous les produits</span>
                    <span class="category-badge">0</span>
                </div>
            </div>
            <div class="scroll-indicator"></div>
        </div>
        
        <!-- Section Navigation - FIXE -->
        <div class="menu-section fixed-section">
            <h3>
                <span>🧭</span>
                <span>Navigation</span>
            </h3>
            <a href="oda-achats.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2"/>
                    <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"/>
                </svg>
                Accueil
            </a>
            <a href="favorie.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
                </svg>
                Mes Favoris
            </a>
            <a href="boutiques.html" class="menu-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z" stroke="currentColor" stroke-width="2"/>
                    <path d="M3 9l1.5-5h15L21 9M9 13v4m6-4v4" stroke="currentColor" stroke-width="2"/>
                </svg>
                Boutiques
            </a>
        </div>
        
        <!-- Section Informations - FIXE -->
        <div class="menu-section fixed-section">
            <h3>
                <span>ℹ️</span>
                <span>Informations</span>
            </h3>
            <a href="#" class="menu-link" id="aboutLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 16v-4M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                À propos
            </a>
            <a href="#" class="menu-link" id="contactLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Contact
            </a>
            <a href="#" class="menu-link" id="helpLink">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3m.08 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Aide
            </a>
        </div>
    </div>
</div>
<!-- ============================================ -->
<!-- CODE HTML À AJOUTER AVANT </body>           -->
<!-- Placez ce code juste avant la ligne 5314    -->
<!-- (avant la balise </body>)                   -->
<!-- ============================================ -->

<!-- Modal 1: À propos -->
<div id="aboutModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('aboutModal')"></div>
    <div class="modal-content modal-about">
        <button class="modal-close" onclick="closeModal('aboutModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper pulse-animation">
                <span class="modal-main-icon">🏪</span>
            </div>
            <h2 class="modal-title">À propos de ODA Market</h2>
        </div>
        
        <div class="modal-body">
            <div class="info-card slide-in">
                <div class="info-icon">🌍</div>
                <div class="info-content">
                    <h3>D'où viennent nos produits ?</h3>
                    <p>ODA Market collabore avec des <strong>vendeurs locaux</strong> passionnés du Cameroun 🇨🇲 
                    et d'ailleurs ! Chaque produit provient de <strong>boutiques vérifiées</strong> qui s'engagent 
                    à offrir qualité et authenticité ✨</p>
                </div>
            </div>
            
            <div class="info-card slide-in" style="animation-delay: 0.1s">
                <div class="info-icon">⚙️</div>
                <div class="info-content">
                    <h3>Comment ça fonctionne ?</h3>
                    <p>C'est simple comme bonjour ! 😊</p>
                    <ol class="steps-list">
                        <li>🔍 <strong>Explorez</strong> des milliers de produits</li>
                        <li>❤️ <strong>Ajoutez</strong> vos favoris</li>
                        <li>🛒 <strong>Contactez</strong> directement le vendeur</li>
                        <li>💳 <strong>Payez</strong> en ligne ou en boutique</li>
                        <li>📦 <strong>Recevez</strong> votre commande !</li>
                    </ol>
                </div>
            </div>
            
            <div class="info-card slide-in" style="animation-delay: 0.2s">
                <div class="info-icon">🎨</div>
                <div class="info-content">
                    <h3>Variations de couleurs</h3>
                    <p>Certains produits sont disponibles en <span class="color-badge red">rouge</span>, 
                    <span class="color-badge blue">bleu</span>, <span class="color-badge green">vert</span>, 
                    <span class="color-badge yellow">jaune</span> et bien plus encore ! 🌈 
                    Contactez le vendeur pour confirmer la disponibilité de votre couleur préférée 🎯</p>
                </div>
            </div>
            
            <div class="fun-fact bounce-animation">
                <span class="fact-icon">💡</span>
                <p><strong>Le saviez-vous ?</strong> Plus de <strong>1000+ produits</strong> disponibles sur ODA Market ! 🚀</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal 2: Contact -->
<div id="contactModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('contactModal')"></div>
    <div class="modal-content modal-contact">
        <button class="modal-close" onclick="closeModal('contactModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper rotate-animation">
                <span class="modal-main-icon">👨‍💻</span>
            </div>
            <h2 class="modal-title">Rencontrez le créateur</h2>
        </div>
        
        <div class="modal-body">
            <div class="creator-story slide-in">
                <h3>🎭 L'histoire d'ODA (version amusante)</h3>
                <p>Il était une fois, un développeur nommé <strong>Yann</strong> qui en avait marre de chercher 
                des produits pendant des heures sur Internet... 😫</p>
                
                <p>Un jour, en buvant son café ☕, il se dit : <em>"Et si je créais une plateforme où TOUT 
                le monde pourrait vendre et acheter facilement ?"</em></p>
                
                <p>Et BOUM 💥 ! ODA Market est né ! Aujourd'hui, des milliers de personnes trouvent leur bonheur 
                en quelques clics. La morale ? <strong>Ne sous-estimez jamais le pouvoir d'un café !</strong> 🚀😄</p>
            </div>
            
            <div class="creator-info slide-in" style="animation-delay: 0.1s">
                <h3>🎯 Les objectifs d'ODA</h3>
                <ul class="objectives-list">
                    <li>🌟 <strong>Connecter</strong> acheteurs et vendeurs facilement</li>
                    <li>💪 <strong>Soutenir</strong> l'économie locale camerounaise</li>
                    <li>🔒 <strong>Garantir</strong> des transactions sécurisées</li>
                    <li>🚀 <strong>Révolutionner</strong> le e-commerce au Cameroun</li>
                    <li>❤️ <strong>Créer</strong> une communauté de confiance</li>
                </ul>
            </div>
            
            <!-- Zone pour image du créateur -->
            <div class="creator-image-zone slide-in" style="animation-delay: 0.2s">
                <!-- Ajoutez votre image ici en remplaçant le commentaire ci-dessous -->
                <div class="image-container" style="
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                padding: 20px;
            ">
                <img src="p2.jpg" 
                     alt="Photo du créateur" 
                     class="creator-photo"
                     style="
                        width: 200px;
                        height: 200px;
                        object-fit: cover;
                        border-radius: 50%;
                        border: 3px solid #007bff;
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                        transition: transform 0.3s ease;
                     "
                     onmouseover="this.style.transform='scale(1.05)'"
                     onmouseout="this.style.transform='scale(1)'">
                <p style="
                    margin: 0;
                    font-size: 16px;
                    color: #333;
                    font-weight: 500;
                ">yann jordy</p>
            </div>
            </div>
            
            <div class="contact-details slide-in" style="animation-delay: 0.3s">
                <h3>📬 Informations de contact</h3>
                <div class="contact-grid">
                    <div class="contact-item">
                        <span class="contact-icon">👤</span>
                        <div>
                            <strong>Nom complet</strong>
                            <p>Kitio Guemeve Yann Jordy</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">📧</span>
                        <div>
                            <strong>Email</strong>
                            <a href="mailto:jordyguemeveyann@gmail.com">jordyguemeveyann@gmail.com</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">📱</span>
                        <div>
                            <strong>WhatsApp</strong>
                            <a href="https://wa.me/237698111771" target="_blank">+237 698 111 771</a>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">💼</span>
                        <div>
                            <strong>Portfolio</strong>
                            <a href="https://kitio-yann-port-folio.vercel.app" target="_blank">kitio-yann-port-folio.vercel.app</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal 3: Aide -->
<div id="helpModal" class="oda-modal">
    <div class="modal-overlay" onclick="closeModal('helpModal')"></div>
    <div class="modal-content modal-help">
        <button class="modal-close" onclick="closeModal('helpModal')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-header">
            <div class="modal-icon-wrapper shake-animation">
                <span class="modal-main-icon">🆘</span>
            </div>
            <h2 class="modal-title">Centre d'aide</h2>
        </div>
        
        <div class="modal-body">
            <div class="help-card slide-in">
                <div class="help-icon">⏳</div>
                <div class="help-content">
                    <h3>Paiement en ligne</h3>
                    <p><strong>⚠️ Important :</strong> Lors d'un paiement direct en ligne, veuillez <strong>patienter</strong> 
                    quelques instants ⏱️ pendant le traitement de votre transaction. Ne fermez pas la page ! 🚫</p>
                    <div class="alert-box">
                        <span class="alert-icon">✅</span>
                        <p>Vous recevrez une confirmation par email et SMS une fois le paiement validé 📧📱</p>
                    </div>
                </div>
            </div>
            
            <div class="help-card slide-in" style="animation-delay: 0.1s">
                <div class="help-icon">🔐</div>
                <div class="help-content">
                    <h3>Cache Boutique - Identifiant Unique</h3>
                    <p>Chaque boutique possède un <strong>identifiant unique</strong> 🎯 qui garantit :</p>
                    <ul class="benefits-list">
                        <li>✨ L'authenticité du vendeur</li>
                        <li>🔒 La sécurité de vos achats</li>
                        <li>📊 Le suivi de vos commandes</li>
                        <li>⭐ Les avis vérifiés</li>
                    </ul>
                    <div class="tip-box">
                        <span class="tip-icon">💡</span>
                        <p><strong>Astuce :</strong> Vérifiez toujours l'identifiant de la boutique avant d'acheter !</p>
                    </div>
                </div>
            </div>
            
            <div class="vendor-section slide-in" style="animation-delay: 0.2s">
                <h3>🏪 Vous êtes vendeur ?</h3>
                <p>Rejoignez ODA Market et développez votre business ! 📈</p>
                <p>Téléchargez <strong>ODA Seller</strong> - l'application dédiée aux vendeurs 🚀</p>
                
                <a href="https://oda-seller.vercel.app" target="_blank" class="download-btn">
                    <span class="btn-icon-left">📲</span>
                    <span class="btn-text-main">
                        <strong>Télécharger ODA Seller</strong>
                        <small>Gérez votre boutique facilement</small>
                    </span>
                    <span class="btn-icon-right">→</span>
                </a>
                
                <div class="vendor-benefits">
                    <h4>Pourquoi ODA Seller ?</h4>
                    <div class="benefits-grid">
                        <div class="benefit-item">📊 Gestion simple</div>
                        <div class="benefit-item">💰 Paiements rapides</div>
                        <div class="benefit-item">📱 Application mobile</div>
                        <div class="benefit-item">🎯 Plus de clients</div>
                    </div>
                </div>
            </div>
            
            <div class="faq-section slide-in" style="animation-delay: 0.3s">
                <h3>❓ Questions fréquentes</h3>
                <div class="faq-item">
                    <strong>Comment suivre ma commande ?</strong>
                    <p>Connectez-vous à votre compte et consultez l'onglet "Mes commandes" 📦</p>
                </div>
                <div class="faq-item">
                    <strong>Puis-je retourner un produit ?</strong>
                    <p>Contactez le vendeur dans les 48h pour discuter d'un éventuel retour 🔄</p>
                </div>
                <div class="faq-item">
                    <strong>Besoin d'aide supplémentaire ?</strong>
                    <p>Contactez notre support via WhatsApp : <a href="https://wa.me/237698111771">+237 698 111 771</a> 💬</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Overlay -->
<div class="overlay" id="overlay"></div>



    <!-- Carousel Produits Populaires avec boutons transparents -->
    <section class="hero-carousel" id="heroCarousel">
        <div class="carousel-wrapper">
            <button class="carousel-btn prev" id="btnPrev" aria-label="Précédent">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            
            <div class="carousel-container" id="carouselContainer">
                <!-- Généré dynamiquement -->
            </div>
            
            <button class="carousel-btn next" id="btnNext" aria-label="Suivant">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
        
        <!-- Message de découverte -->
       
        
        <!-- Boutons transparents sur la bannière -->
        <div class="banner-actions">
            <button class="banner-btn" onclick="scrollToProducts()">
                <div class="banner-icon">🎁</div>
                <span>produits</span>
            </button>
            <button class="banner-btn" onclick="window.location.href='favorie.html'">
                <div class="banner-icon">❤️</div>
                <span>favoris</span>
            </button>
            <button class="banner-btn" onclick="window.location.href='boutiques.html'">
                <div class="banner-icon">🏪</div>
                <span>boutique</span>
            </button>
        </div>
        
        <div class="carousel-dots" id="carouselDots"></div>
    </section>

   

    <!-- Grid Produits -->
    <main class="products-container">
        <div class="section-header">
            <h2>Tous les produits</h2>
            <span class="product-count" id="productCount">0 produits</span>
        </div>
        
        <div class="products-grid" id="productsGrid">
            <!-- Généré dynamiquement -->
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            <h3>Aucun produit trouvé</h3>
            <p>Revenez plus tard pour découvrir nos nouveaux produits</p>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>
    <!-- Modal Paramètres -->
<div class="settings-modal" id="settingsModal">
    <div class="modal-backdrop" onclick="document.getElementById('settingsModal').classList.remove('active')"></div>
    <div class="settings-modal-content">
        <div class="settings-header">
            <h2>⚙️ Paramètres</h2>
            <button class="btn-close" onclick="document.getElementById('settingsModal').classList.remove('active')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <button class="icon-btn" id="notifBtn" title="Notifications">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                </svg>
                <span class="badge" id="notifBadge" style="display: none;">0</span>
            </button>
        </div>
        
        <div class="settings-body">
            <!-- Section Profil -->
            <div class="settings-section">
                <div class="section-header">
                    <span class="section-icon">👤</span>
                    <h3>Profil utilisateur</h3>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <span>Nom d'utilisateur</span>
                        <span class="label-badge" id="nameChangeBadge">Modifiable</span>
                    </label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="form-input" id="userNameInput" placeholder="Votre nom" readonly>
                        <button class="btn-primary" id="changeNameBtn" onclick="ouvrirChangementNom()">
                            Modifier
                        </button>
                    </div>
                    <small class="form-hint" id="nameChangeHint">Changement de nom autorisé tous les 3 mois</small>
                </div>
            </div>
            
            <!-- Section Notifications -->
            
<div class="settings-section">
    <div class="section-header">
        <span class="section-icon">🔔</span>
        <h3>Notifications Push</h3>
    </div>
    
    <div id="notificationStatus" style="
        background: var(--bg-secondary);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    ">
        <div>
            <div style="font-weight: 600; margin-bottom: 4px;">Statut des notifications</div>
            <div id="notifStatusText" style="font-size: 0.9rem; color: var(--text-secondary);">
                Chargement...
            </div>
        </div>
        <button class="btn-primary" id="enableNotifBtn" onclick="activerNotifications()">
            Activer
        </button>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Nouveaux produits</div>
            <div class="toggle-desc">Être notifié des nouveaux produits</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifNewProducts" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Promotions</div>
            <div class="toggle-desc">Recevoir les offres spéciales</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifPromotions" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Nouveaux commentaires</div>
            <div class="toggle-desc">Sur les produits que vous suivez</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifComments" checked>
            <span class="slider"></span>
        </label>
    </div>
    
    <div class="settings-toggle">
        <div class="toggle-info">
            <div class="toggle-title">Produits populaires</div>
            <div class="toggle-desc">Vos favoris qui deviennent populaires</div>
        </div>
        <label class="switch">
            <input type="checkbox" id="notifPopular" checked>
            <span class="slider"></span>
        </label>
    </div>
</div>
            
            <!-- Section Préférences -->
            <div class="settings-section">
                <div class="section-header">
                    <span class="section-icon">🎨</span>
                    <h3>Préférences</h3>
                </div>
                
                <div class="settings-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Mode sombre</div>
                        <div class="toggle-desc">Activer le thème sombre</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="darkMode">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="settings-toggle">
                    <div class="toggle-info">
                        <div class="toggle-title">Sons</div>
                        <div class="toggle-desc">Activer les sons de l'application</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="appSounds" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <!-- Section Données -->
            <div class="settings-section">
                <div class="section-header">
                    <span class="section-icon">🗑️</span>
                    <h3>Données</h3>
                </div>
                
                <button class="btn-danger" onclick="effacerDonnees()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                    </svg>
                    Effacer toutes mes données
                </button>
            </div>
        </div>
    </div>
</div>
<script src="pwa-manager.js"></script>
<script type="module">
    // ==================== CONFIGURATION SUPABASE ====================
const SUPABASE_URL = 'https://xjckbqbqxcwzcrlmuvzf.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqY2ticWJxeGN3emNybG11dnpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTk1MzMsImV4cCI6MjA3NjA5NTUzM30.AMzAUwtjFt7Rvof5r2enMyYIYToc1wNWWEjvZqK_YXM';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ==================== VARIABLES GLOBALES ====================
let allProducts = [];
let favoriteProducts = new Set();
let productLikes = {};
let productComments = {};
let currentFilter = 'all';
let carouselInterval;
let currentSlide = 0;
let popularProducts = [];
let currentUserId = getUserId();

// ==================== 1. CACHE MANAGER ====================

class CacheManager {
    constructor() {
        this.CACHE_KEYS = {
            PRODUCTS: 'oda_products_v2',
            LIKES: 'oda_likes_v2',
            COMMENTS: 'oda_comments_v2',
            SHOPS: 'oda_shops_v2',
            TIMESTAMP: 'oda_cache_timestamp'
        };
        
        // MODIFICATION IMPORTANTE: Cache de 7 jours au lieu de 1 heure
        this.CACHE_DURATION = 7 * 24 * 60 * 60 * 1000; // 7 jours en millisecondes
        
        console.log(`📦 CacheManager initialisé - Durée: ${this.CACHE_DURATION / (24 * 60 * 60 * 1000)} jours`);
    }

    saveToCache(key, data) {
        try {
            const cacheData = { 
                data, 
                timestamp: Date.now(),
                expiresAt: Date.now() + this.CACHE_DURATION
            };
            
            localStorage.setItem(key, JSON.stringify(cacheData));
            
            // Calculer la date d'expiration
            const expirationDate = new Date(cacheData.expiresAt);
            console.log(`💾 Cache sauvegardé: ${key}`);
            console.log(`   📅 Expire le: ${expirationDate.toLocaleDateString('fr-FR')} à ${expirationDate.toLocaleTimeString('fr-FR')}`);
            
            return true;
        } catch (e) {
            console.error(`❌ Erreur cache ${key}:`, e);
            
            // Si quota dépassé, nettoyer les anciens caches
            if (e.name === 'QuotaExceededError') {
                console.warn('⚠️ Quota localStorage dépassé - Nettoyage en cours...');
                this.clearOldCaches();
                
                try {
                    localStorage.setItem(key, JSON.stringify({ 
                        data, 
                        timestamp: Date.now(),
                        expiresAt: Date.now() + this.CACHE_DURATION
                    }));
                    console.log('✅ Cache sauvegardé après nettoyage');
                    return true;
                } catch (e2) {
                    console.error('❌ Échec après nettoyage:', e2);
                }
            }
            return false;
        }
    }

    loadFromCache(key) {
        try {
            const cached = localStorage.getItem(key);
            if (!cached) {
                console.log(`📦 Cache non trouvé: ${key}`);
                return null;
            }
            
            const { data, timestamp, expiresAt } = JSON.parse(cached);
            const now = Date.now();
            const age = now - timestamp;
            const remainingTime = expiresAt - now;
            
            // Vérifier si le cache n'est pas expiré
            if (remainingTime > 0) {
                const ageInDays = Math.floor(age / (24 * 60 * 60 * 1000));
                const ageInHours = Math.floor((age % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                const remainingDays = Math.floor(remainingTime / (24 * 60 * 60 * 1000));
                
                console.log(`📦 Cache chargé: ${key}`);
                console.log(`   ⏱️ Âge: ${ageInDays}j ${ageInHours}h`);
                console.log(`   ⏳ Reste: ${remainingDays} jours`);
                
                return data;
            } else {
                console.log(`⏰ Cache expiré: ${key} - Suppression`);
                localStorage.removeItem(key);
                return null;
            }
        } catch (e) {
            console.error(`❌ Erreur lecture cache ${key}:`, e);
            // Supprimer le cache corrompu
            localStorage.removeItem(key);
            return null;
        }
    }

    saveAll(products, likes, comments, shops) {
        console.log('💾 Sauvegarde complète en cache...');
        
        const results = {
            products: this.saveToCache(this.CACHE_KEYS.PRODUCTS, products),
            likes: this.saveToCache(this.CACHE_KEYS.LIKES, likes),
            comments: this.saveToCache(this.CACHE_KEYS.COMMENTS, comments),
            shops: this.saveToCache(this.CACHE_KEYS.SHOPS, shops)
        };
        
        // Enregistrer le timestamp global
        localStorage.setItem(this.CACHE_KEYS.TIMESTAMP, Date.now().toString());
        
        const allSaved = Object.values(results).every(r => r);
        
        if (allSaved) {
            console.log('✅ Toutes les données mises en cache');
            console.log(`   📦 Produits: ${products.length}`);
            console.log(`   👍 Likes: ${Object.keys(likes).length} produits`);
            console.log(`   💬 Commentaires: ${Object.keys(comments).length} produits`);
            console.log(`   🏪 Boutiques: ${Object.keys(shops).length}`);
        } else {
            console.warn('⚠️ Certaines données n\'ont pas pu être mises en cache');
        }
        
        return allSaved;
    }

    loadAll() {
        console.log('📦 Chargement complet depuis le cache...');
        
        return {
            products: this.loadFromCache(this.CACHE_KEYS.PRODUCTS),
            likes: this.loadFromCache(this.CACHE_KEYS.LIKES),
            comments: this.loadFromCache(this.CACHE_KEYS.COMMENTS),
            shops: this.loadFromCache(this.CACHE_KEYS.SHOPS)
        };
    }

    hasCompleteCache() {
        const hasAll = Object.values(this.CACHE_KEYS).slice(0, 4).every(key => {
            const item = localStorage.getItem(key);
            if (!item) return false;
            
            try {
                const { timestamp, expiresAt } = JSON.parse(item);
                const isValid = Date.now() < expiresAt;
                
                if (!isValid) {
                    console.log(`⏰ Cache expiré détecté: ${key}`);
                }
                
                return isValid;
            } catch { 
                console.error(`❌ Cache corrompu: ${key}`);
                return false; 
            }
        });
        
        if (hasAll) {
            console.log('✅ Cache complet et valide disponible');
        } else {
            console.log('❌ Cache incomplet ou expiré');
        }
        
        return hasAll;
    }

    clearOldCaches() {
        console.log('🧹 Nettoyage des anciens caches...');
        
        let clearedCount = 0;
        const keysToKeep = Object.values(this.CACHE_KEYS);
        
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            
            // Ne pas supprimer les clés importantes
            if (!keysToKeep.includes(key)) {
                // Supprimer les anciennes clés ODA
                if (key.startsWith('oda_')) {
                    localStorage.removeItem(key);
                    clearedCount++;
                    console.log(`   🗑️ Supprimé: ${key}`);
                }
            }
        }
        
        console.log(`✅ ${clearedCount} ancien(s) cache(s) supprimé(s)`);
    }

    clearAll() {
        console.log('🗑️ Suppression complète du cache...');
        
        Object.values(this.CACHE_KEYS).forEach(key => {
            localStorage.removeItem(key);
            console.log(`   🗑️ Supprimé: ${key}`);
        });
        
        console.log('✅ Cache vidé complètement');
    }

    getStats() {
        const stats = {
            valid: this.hasCompleteCache(),
            size: 0,
            items: {},
            totalAge: 0,
            oldestItem: null,
            newestItem: null
        };
        
        Object.entries(this.CACHE_KEYS).slice(0, 4).forEach(([name, key]) => {
            const item = localStorage.getItem(key);
            if (item) {
                try {
                    const { timestamp, data, expiresAt } = JSON.parse(item);
                    const age = Date.now() - timestamp;
                    const size = new Blob([item]).size;
                    const remainingTime = expiresAt - Date.now();
                    
                    stats.items[name] = {
                        size,
                        age,
                        timestamp,
                        expiresAt,
                        remainingDays: Math.floor(remainingTime / (24 * 60 * 60 * 1000)),
                        count: Array.isArray(data) ? data.length : Object.keys(data).length
                    };
                    
                    stats.size += size;
                    stats.totalAge += age;
                    
                    if (!stats.oldestItem || timestamp < stats.oldestItem.timestamp) {
                        stats.oldestItem = { name, timestamp, age };
                    }
                    
                    if (!stats.newestItem || timestamp > stats.newestItem.timestamp) {
                        stats.newestItem = { name, timestamp, age };
                    }
                } catch (e) {
                    console.error(`❌ Erreur stats pour ${key}:`, e);
                }
            }
        });
        
        return stats;
    }

    displayStats() {
        const stats = this.getStats();
        
        console.log('📊 STATISTIQUES DU CACHE');
        console.log('═'.repeat(50));
        console.log(`Status: ${stats.valid ? '✅ Valide' : '❌ Invalide/Expiré'}`);
        console.log(`Taille totale: ${(stats.size / 1024).toFixed(2)} KB`);
        
        if (stats.oldestItem) {
            const ageInDays = Math.floor(stats.oldestItem.age / (24 * 60 * 60 * 1000));
            console.log(`Plus ancien: ${stats.oldestItem.name} (${ageInDays} jours)`);
        }
        
        console.log('─'.repeat(50));
        Object.entries(stats.items).forEach(([name, info]) => {
            console.log(`${name}:`);
            console.log(`  - Éléments: ${info.count}`);
            console.log(`  - Taille: ${(info.size / 1024).toFixed(2)} KB`);
            console.log(`  - Reste: ${info.remainingDays} jours`);
        });
        console.log('═'.repeat(50));
    }
}

// Initialiser le gestionnaire de cache global
window.cacheManager = new CacheManager();
console.log('✅ CacheManager initialisé avec durée de 7 jours');

// ==================== 2. LOADING PROGRESS ====================

class LoadingProgress {
    constructor() {
        this.currentProgress = 0;
        this.targetProgress = 0;
        this.isLoading = false;
        this.animationFrameId = null;
        this.init();
    }

    init() {
        const styles = `<style>
            .loader-overlay { 
                position: fixed; 
                top: 0; 
                left: 0; 
                right: 0; 
                bottom: 0; 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                z-index: 99999; 
                opacity: 1; 
                transition: opacity 0.5s; 
            }
            .loader-overlay.fade-out { 
                opacity: 0; 
                pointer-events: none; 
            }
            .loader-content { 
                text-align: center; 
                max-width: 400px; 
                width: 90%; 
            }
            .loader-logo { 
                margin-bottom: 40px; 
                animation: fadeInDown 0.6s; 
            }
            .logo-icon { 
                font-size: 4rem; 
                margin-bottom: 16px; 
                animation: bounce 2s infinite; 
            }
            .logo-text { 
                font-size: 1.8rem; 
                font-weight: 800; 
                color: white; 
                text-shadow: 0 2px 20px rgba(0,0,0,0.3); 
            }
            .progress-container { 
                margin-bottom: 24px; 
                animation: fadeInUp 0.6s 0.2s both; 
            }
            .progress-bar-bg { 
                position: relative; 
                width: 100%; 
                height: 8px; 
                background: rgba(255,255,255,0.2); 
                border-radius: 10px; 
                overflow: hidden; 
                margin-bottom: 12px; 
                box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            }
            .progress-bar { 
                position: absolute; 
                left: 0; 
                top: 0; 
                height: 100%; 
                background: linear-gradient(90deg, #FF6B00, #FFA500); 
                border-radius: 10px; 
                width: 0%; 
                transition: width 0.3s ease; 
                box-shadow: 0 0 20px rgba(255,107,0,0.5); 
            }
            .progress-shine { 
                position: absolute; 
                top: 0; 
                left: -100%; 
                width: 100%; 
                height: 100%; 
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); 
                animation: shine 2s infinite; 
            }
            @keyframes shine { 
                0% { left: -100%; } 
                50%, 100% { left: 100%; } 
            }
            .progress-text { 
                display: flex; 
                justify-content: space-between; 
                align-items: center;
                color: white; 
                font-size: 0.9rem; 
            }
            .progress-percentage { 
                font-size: 2.5rem; 
                font-weight: 800; 
                text-shadow: 0 2px 10px rgba(0,0,0,0.3);
                font-family: 'Inter', -apple-system, sans-serif;
                letter-spacing: -1px;
                background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,0.8) 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .progress-step { 
                font-size: 0.85rem; 
                opacity: 0.9;
                font-weight: 500;
            }
            .loading-dots { 
                display: flex; 
                justify-content: center; 
                gap: 8px; 
                animation: fadeInUp 0.6s 0.4s both; 
            }
            .loading-dots span { 
                width: 8px; 
                height: 8px; 
                background: rgba(255,255,255,0.6); 
                border-radius: 50%; 
                animation: dotPulse 1.4s infinite both; 
            }
            .loading-dots span:nth-child(1) { 
                animation-delay: -0.32s; 
            }
            .loading-dots span:nth-child(2) { 
                animation-delay: -0.16s; 
            }
            @keyframes dotPulse { 
                0%, 80%, 100% { 
                    transform: scale(0.8); 
                    opacity: 0.5; 
                } 
                40% { 
                    transform: scale(1.2); 
                    opacity: 1; 
                } 
            }
            @keyframes fadeInDown { 
                from { 
                    opacity: 0; 
                    transform: translateY(-30px); 
                } 
                to { 
                    opacity: 1; 
                    transform: translateY(0); 
                } 
            }
            @keyframes fadeInUp { 
                from { 
                    opacity: 0; 
                    transform: translateY(30px); 
                } 
                to { 
                    opacity: 1; 
                    transform: translateY(0); 
                } 
            }
            @keyframes bounce { 
                0%, 100% { 
                    transform: translateY(0); 
                } 
                50% { 
                    transform: translateY(-10px); 
                } 
            }
        </style>`;
        document.head.insertAdjacentHTML('beforeend', styles);
    }

    start() {
        this.isLoading = true;
        this.currentProgress = 0;
        this.targetProgress = 0;
        
        const html = `<div class="loader-overlay" id="loaderOverlay">
            <div class="loader-content">
                <div class="loader-logo">
                    <div class="logo-icon">🛍️</div>
                    <div class="logo-text">ODA Marketplace</div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar-bg">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-shine"></div>
                    </div>
                    <div class="progress-text">
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                        <span class="progress-step" id="progressStep">Initialisation...</span>
                    </div>
                </div>
                <div class="loading-dots"><span></span><span></span><span></span></div>
            </div>
        </div>`;
        
        document.body.insertAdjacentHTML('afterbegin', html);
        this.overlay = document.getElementById('loaderOverlay');
        this.progressBar = document.getElementById('progressBar');
        this.progressPercentage = document.getElementById('progressPercentage');
        this.progressStep = document.getElementById('progressStep');
        
        // Démarrer l'animation
        this.animate();
        
        console.log('📊 Loader démarré - Affichage: 0%');
    }

    updateProgress(percentage, step) {
        // Assurer que le pourcentage est entre 0 et 100
        this.targetProgress = Math.min(100, Math.max(0, percentage));
        
        // Mettre à jour le texte de l'étape si fourni
        if (step && this.progressStep) {
            this.progressStep.textContent = step;
        }
        
        console.log(`📊 Progression: ${this.targetProgress}% ${step ? `- ${step}` : ''}`);
    }

    animate() {
        if (!this.isLoading) return;
        
        // Animation fluide avec interpolation
        const diff = this.targetProgress - this.currentProgress;
        
        if (Math.abs(diff) > 0.1) {
            // Augmenter progressivement
            this.currentProgress += diff * 0.15;
            
            // Arrondir pour l'affichage
            const displayProgress = Math.round(this.currentProgress);
            
            // Mettre à jour la barre de progression
            if (this.progressBar) {
                this.progressBar.style.width = `${displayProgress}%`;
            }
            
            // Mettre à jour le pourcentage affiché
            if (this.progressPercentage) {
                this.progressPercentage.textContent = `${displayProgress}%`;
            }
            
            // Continuer l'animation
            this.animationFrameId = requestAnimationFrame(() => this.animate());
        } else {
            // Fixer à la valeur exacte quand très proche
            this.currentProgress = this.targetProgress;
            const displayProgress = Math.round(this.currentProgress);
            
            if (this.progressBar) {
                this.progressBar.style.width = `${displayProgress}%`;
            }
            
            if (this.progressPercentage) {
                this.progressPercentage.textContent = `${displayProgress}%`;
            }
            
            // Continuer d'écouter les changements
            this.animationFrameId = requestAnimationFrame(() => this.animate());
        }
    }

    complete() {
        console.log('✅ Loader - Chargement terminé à 100%');
        this.updateProgress(100, 'Chargement terminé !');
        
        // Attendre un peu avant de masquer pour montrer 100%
        setTimeout(() => this.hide(), 800);
    }

    hide() {
        console.log('👋 Loader - Masquage du loader');
        this.isLoading = false;
        
        // Annuler l'animation
        if (this.animationFrameId) {
            cancelAnimationFrame(this.animationFrameId);
            this.animationFrameId = null;
        }
        
        if (this.overlay) {
            this.overlay.classList.add('fade-out');
            setTimeout(() => {
                if (this.overlay && this.overlay.parentNode) {
                    this.overlay.remove();
                }
            }, 500);
        }
    }

    showError(msg) {
        console.error(`❌ Loader - Erreur: ${msg}`);
        
        if (this.progressStep) {
            this.progressStep.textContent = `❌ ${msg}`;
        }
        
        if (this.progressBar) {
            this.progressBar.style.background = 'linear-gradient(90deg, #EF4444, #DC2626)';
        }
        
        setTimeout(() => this.hide(), 2000);
    }
    
    // Méthode pour réinitialiser complètement
    reset() {
        this.hide();
        this.currentProgress = 0;
        this.targetProgress = 0;
        this.isLoading = false;
    }
}

// Initialiser globalement
window.loadingProgress = new LoadingProgress();
console.log('✅ LoadingProgress initialisé avec animation 0% → 100%');

// ==================== 3. OPTIMIZED DATA LOADER ====================
// ==================== ARTEFACT 3: OPTIMIZEDDATALOADER AMÉLIORÉ ====================
// Chargeur de données optimisé avec progression fluide de 0% à 100%
// À remplacer dans oda-achats.html à partir de la ligne 2500

class OptimizedDataLoader {
    constructor(supabase) {
        this.supabase = supabase;
        this.cache = window.cacheManager;
        this.loader = window.loadingProgress;
        this.data = { products: [], likes: {}, comments: {}, shops: {} };
    }

    async load() {
        // Démarrer le loader à 0%
        this.loader.start();
        this.loader.updateProgress(0, 'Vérification du cache...');
        
        console.log('🚀 Démarrage du chargement des données');

        try {
            // Vérifier le cache
            if (this.cache.hasCompleteCache()) {
                console.log('📦 Cache valide trouvé - Chargement rapide');
                await this.loadFromCache();
                this.loader.complete();
                return this.data;
            }

            console.log('🌐 Cache manquant ou expiré - Chargement depuis le serveur');
            await this.loadFromServer();
            this.loader.complete();
            return this.data;
        } catch (error) {
            console.error('❌ Erreur lors du chargement:', error);
            this.loader.showError('Échec du chargement');
            throw error;
        }
    }

    async loadFromCache() {
        console.log('📦 Chargement depuis le cache local...');
        
        // Progression 0-10%
        this.loader.updateProgress(5, 'Lecture du cache...');
        
        const cached = this.cache.loadAll();
        
        // Progression 10-30%
        this.loader.updateProgress(15, 'Chargement des produits...');
        this.data.products = cached.products || [];
        await this.delay(100);
        
        // Progression 30-50%
        this.loader.updateProgress(35, 'Chargement des likes...');
        this.data.likes = cached.likes || {};
        await this.delay(100);
        
        // Progression 50-70%
        this.loader.updateProgress(55, 'Chargement des commentaires...');
        this.data.comments = cached.comments || {};
        await this.delay(100);
        
        // Progression 70-90%
        this.loader.updateProgress(75, 'Chargement des boutiques...');
        this.data.shops = cached.shops || {};
        await this.delay(100);
        
        // Animation finale jusqu'à 100%
        await this.simulateProgress(85, 100, 300);
        
        console.log(`✅ ${this.data.products.length} produits chargés depuis le cache`);
        console.log('📊 Statistiques du cache:');
        console.log(`   - Produits: ${this.data.products.length}`);
        console.log(`   - Likes: ${Object.keys(this.data.likes).length} produits`);
        console.log(`   - Commentaires: ${Object.keys(this.data.comments).length} produits`);
        console.log(`   - Boutiques: ${Object.keys(this.data.shops).length}`);
        
        // Mise à jour en arrière-plan après un délai
        setTimeout(() => this.updateInBackground(), 2000);
    }

    async loadFromServer() {
        console.log('🌐 Chargement depuis le serveur Supabase...');
        
        try {
            // Étape 1: Boutiques (0-20%)
            this.loader.updateProgress(0, 'Connexion au serveur...');
            await this.delay(200);
            
            this.loader.updateProgress(5, 'Chargement des boutiques...');
            await this.loadShops();
            this.loader.updateProgress(20, 'Boutiques chargées ✓');
            await this.delay(150);
            
            // Étape 2: Produits (20-50%)
            this.loader.updateProgress(25, 'Chargement des produits...');
            await this.loadProducts();
            this.loader.updateProgress(50, 'Produits chargés ✓');
            await this.delay(150);
            
            // Étape 3: Likes (50-70%)
            this.loader.updateProgress(55, 'Chargement des likes...');
            await this.loadLikes();
            this.loader.updateProgress(70, 'Likes chargés ✓');
            await this.delay(150);
            
            // Étape 4: Commentaires (70-85%)
            this.loader.updateProgress(73, 'Chargement des commentaires...');
            await this.loadComments();
            this.loader.updateProgress(85, 'Commentaires chargés ✓');
            await this.delay(150);
            
            // Étape 5: Traitement (85-93%)
            this.loader.updateProgress(87, 'Traitement des données...');
            this.processData();
            this.loader.updateProgress(93, 'Données traitées ✓');
            await this.delay(150);
            
            // Étape 6: Mise en cache (93-98%)
            this.loader.updateProgress(94, 'Sauvegarde en cache...');
            this.saveToCache();
            this.loader.updateProgress(98, 'Cache enregistré ✓');
            await this.delay(150);
            
            // Finalisation (98-100%)
            this.loader.updateProgress(99, 'Finalisation...');
            await this.delay(100);
            this.loader.updateProgress(100, 'Chargement terminé !');
            
        } catch (error) {
            console.error('❌ Erreur chargement serveur:', error);
            throw error;
        }
    }

    async loadShops() {
        try {
            const { data, error } = await this.supabase
                .from('parametres_boutique')
                .select('user_id, config');
                
            if (error) throw error;
            
            data.forEach(shop => {
                const slug = shop.config?.identifiant?.slug || shop.config?.slug || null;
                this.data.shops[shop.user_id] = {
                    nom: shop.config?.general?.nom || 'Boutique',
                    identifiant: slug,
                    couleurPrimaire: shop.config?.apparence?.couleurPrimaire || '#FF6B00'
                };
            });
            
            console.log(`🏪 ${Object.keys(this.data.shops).length} boutiques chargées`);
        } catch (error) {
            console.error('❌ Erreur chargement boutiques:', error);
            throw error;
        }
    }

    async loadProducts() {
        try {
            const { data, error } = await this.supabase
                .from('produits')
                .select('*')
                .eq('statut', 'published')
                .gt('stock', 0);
                
            if (error) throw error;
            
            this.data.products = data.map(p => ({
                id: p.id,
                nom: p.nom,
                description: p.description,
                prix: p.prix,
                stock: p.stock,
                mainImage: p.main_image,
                categorie: p.categorie,
                userId: p.user_id,
                created_at: p.created_at
            }));
            
            console.log(`📦 ${this.data.products.length} produits chargés`);
        } catch (error) {
            console.error('❌ Erreur chargement produits:', error);
            throw error;
        }
    }

    async loadLikes() {
        try {
            const { data, error } = await this.supabase
                .from('product_likes')
                .select('product_id, user_id');
                
            if (error) throw error;
            
            data.forEach(like => {
                if (!this.data.likes[like.product_id]) {
                    this.data.likes[like.product_id] = { count: 0, users: [] };
                }
                this.data.likes[like.product_id].count++;
                this.data.likes[like.product_id].users.push(like.user_id);
            });
            
            console.log(`👍 ${Object.keys(this.data.likes).length} produits avec likes`);
        } catch (error) {
            console.error('❌ Erreur chargement likes:', error);
            throw error;
        }
    }

    async loadComments() {
        try {
            const { data, error } = await this.supabase
                .from('product_comments')
                .select('*')
                .order('created_at', { ascending: false });
                
            if (error) throw error;
            
            data.forEach(comment => {
                if (!this.data.comments[comment.product_id]) {
                    this.data.comments[comment.product_id] = [];
                }
                this.data.comments[comment.product_id].push(comment);
            });
            
            console.log(`💬 ${Object.keys(this.data.comments).length} produits avec commentaires`);
        } catch (error) {
            console.error('❌ Erreur chargement commentaires:', error);
            throw error;
        }
    }

    processData() {
        console.log('⚙️ Traitement des données...');
        
        this.data.products = this.data.products.map(p => ({
            ...p,
            shopName: this.data.shops[p.userId]?.nom || 'Boutique',
            shopSlug: this.data.shops[p.userId]?.identifiant,
            shopColor: this.data.shops[p.userId]?.couleurPrimaire,
            likes: this.data.likes[p.id]?.count || 0,
            commentsCount: (this.data.comments[p.id] || []).length,
            rating: this.calculateAverageRating(this.data.comments[p.id] || [])
        }));
        
        console.log('✅ Données enrichies avec succès');
    }

    calculateAverageRating(comments) {
        if (!comments || comments.length === 0) return '0.0';
        const average = comments.reduce((acc, c) => acc + (c.rating || 0), 0) / comments.length;
        return average.toFixed(1);
    }

    saveToCache() {
        console.log('💾 Sauvegarde des données en cache...');
        
        const saved = this.cache.saveAll(
            this.data.products, 
            this.data.likes, 
            this.data.comments, 
            this.data.shops
        );
        
        if (saved) {
            console.log('✅ Toutes les données sauvegardées en cache (valide 7 jours)');
        } else {
            console.warn('⚠️ Certaines données n\'ont pas pu être sauvegardées');
        }
    }

    async updateInBackground() {
        console.log('🔄 Mise à jour en arrière-plan programmée...');
        
        setTimeout(async () => {
            try {
                console.log('🔄 Démarrage de la mise à jour en arrière-plan...');
                
                // Charger discrètement sans afficher le loader
                const tempLoader = this.loader;
                this.loader = { 
                    updateProgress: () => {}, 
                    complete: () => {} 
                };
                
                await this.loadFromServer();
                
                // Restaurer le loader
                this.loader = tempLoader;
                
                console.log('✅ Mise à jour en arrière-plan terminée');
                console.log('📊 Cache rafraîchi et valide pour 7 jours');
            } catch (error) {
                console.error('❌ Erreur mise à jour arrière-plan:', error);
            }
        }, 2000);
    }

    async simulateProgress(from, to, duration) {
        const steps = 10;
        const increment = (to - from) / steps;
        const delay = duration / steps;
        
        for (let i = 0; i < steps; i++) {
            await this.delay(delay);
            this.loader.updateProgress(from + increment * (i + 1));
        }
    }

    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async forceReload() {
        console.log('🔄 Rechargement forcé demandé...');
        this.cache.clearAll();
        return this.load();
    }
}

console.log('✅ OptimizedDataLoader défini avec progression améliorée 0% → 100%');

// ==================== 4. IMPROVED MENU ====================
class ImprovedMenu {
    constructor() {
        this.products = [];
        this.categories = new Map();
        this.expandedCategories = new Set(); // Pour suivre les catégories ouvertes
        this.injectStyles();
    }

    init(products) {
        this.products = products;
        this.generateCategories();
        this.render();
    }

    generateCategories() {
        this.categories.clear();
        
        // Catégorie "Tous" avec sous-catégories
        const allSubcategories = this.getSubcategories(this.products);
        this.categories.set('Tous', {
            count: this.products.length,
            subcategories: allSubcategories
        });
        
        // Catégories traditionnelles avec leurs sous-catégories
        const counts = {};
        this.products.forEach(p => {
            const cat = p.categorie || 'Autres';
            if (!counts[cat]) {
                counts[cat] = [];
            }
            counts[cat].push(p);
        });
        
        Object.entries(counts)
            .sort((a, b) => b[1].length - a[1].length)
            .forEach(([cat, products]) => {
                const subcategories = this.getSubcategories(products);
                this.categories.set(cat, {
                    count: products.length,
                    subcategories: subcategories
                });
            });
        
        console.log(`📂 ${this.categories.size} catégories avec sous-catégories`);
    }

    getSubcategories(products) {
        const subcategories = {};
        
        // Recommandé - produits avec plus de 5 likes
        const recommended = products.filter(p => (p.likes || 0) >= 5);
        if (recommended.length > 0) {
            subcategories['Recommandé'] = recommended.length;
        }
        
        // Populaire - produits les plus likés (top 20%)
        const topLikesThreshold = Math.ceil(products.length * 0.2);
        const sortedByLikes = [...products].sort((a, b) => (b.likes || 0) - (a.likes || 0));
        const popular = sortedByLikes.slice(0, Math.max(1, topLikesThreshold));
        if (popular.length > 0) {
            subcategories['Populaire'] = popular.length;
        }
        
        // Arrivage - produits ajoutés dans les 7 derniers jours
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        const newArrivals = products.filter(p => {
            const createdDate = new Date(p.created_at);
            return createdDate >= sevenDaysAgo;
        });
        if (newArrivals.length > 0) {
            subcategories['Arrivage'] = newArrivals.length;
        }
        
        // Solde - produits avec prix < 5000 FCFA
        const onSale = products.filter(p => p.prix < 5000);
        if (onSale.length > 0) {
            subcategories['Solde'] = onSale.length;
        }
        
        return subcategories;
    }

    toggleCategory(cat) {
        if (this.expandedCategories.has(cat)) {
            this.expandedCategories.delete(cat);
        } else {
            this.expandedCategories.add(cat);
        }
        this.render();
    }

    render() {
        const list = document.getElementById('categoryList');
        if (!list) return;
        
        if (this.categories.size === 0) {
            list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-secondary)">Chargement...</div>';
            return;
        }
        
        let html = '';
        this.categories.forEach((data, cat) => {
            const isAll = cat === 'Tous';
            const icon = this.getCategoryIcon(cat);
            const pct = ((data.count / this.products.length) * 100).toFixed(0);
            const hasSubcategories = data.subcategories && Object.keys(data.subcategories).length > 0;
            const isExpanded = this.expandedCategories.has(cat);
            
            // Catégorie principale
            html += `<div class="category-wrapper">
                <div class="category-item ${isAll ? 'category-all' : ''}" 
                     data-category="${cat}">
                    <div class="category-content" onclick="window.improvedMenu.selectCategory('${cat}', 'all')">
                        <div class="category-header">
                            <span class="category-icon">${icon}</span>
                            <span class="category-name">${cat}</span>
                        </div>
                        <div class="category-stats">
                            <span class="category-count">${data.count}</span>
                            ${!isAll ? `<span class="category-percentage">${pct}%</span>` : ''}
                        </div>
                    </div>
                    ${hasSubcategories ? `
                        <button class="toggle-subcategories ${isExpanded ? 'expanded' : ''}" 
                                onclick="event.stopPropagation(); window.improvedMenu.toggleCategory('${cat}')"
                                title="${isExpanded ? 'Masquer' : 'Afficher'} les sous-catégories">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    ` : ''}
                    ${!isAll ? `<div class="category-progress"><div class="category-progress-bar" style="width:${pct}%"></div></div>` : ''}
                </div>`;
            
            // Sous-catégories (masquées par défaut)
            if (hasSubcategories) {
                html += `<div class="subcategories-container ${isExpanded ? 'expanded' : ''}">`;
                Object.entries(data.subcategories).forEach(([subcat, count]) => {
                    const subIcon = this.getSubcategoryIcon(subcat);
                    const subPct = ((count / data.count) * 100).toFixed(0);
                    
                    html += `<div class="subcategory-item" 
                                  onclick="event.stopPropagation(); window.improvedMenu.selectCategory('${cat}', '${subcat}')" 
                                  data-category="${cat}" 
                                  data-subcategory="${subcat}">
                        <div class="subcategory-content">
                            <div class="subcategory-header">
                                <span class="subcategory-icon">${subIcon}</span>
                                <span class="subcategory-name">${subcat}</span>
                            </div>
                            <div class="subcategory-stats">
                                <span class="subcategory-count">${count}</span>
                                <span class="subcategory-percentage">${subPct}%</span>
                            </div>
                        </div>
                        <div class="subcategory-progress">
                            <div class="subcategory-progress-bar" style="width:${subPct}%"></div>
                        </div>
                    </div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
        });
        
        list.innerHTML = html;
    }

    getCategoryIcon(cat) {
        const icons = {
            'Tous': '🏠', 
            'Électronique': '📱', 
            'Mode': '👕',
            'Maison': '🏡', 
            'Beauté': '💄', 
            'Sport': '⚽',
            'Livres': '📚', 
            'Jouets': '🧸', 
            'Alimentation': '🍔',
            'Santé': '💊', 
            'Auto': '🚗', 
            'Jardin': '🌱', 
            'Autres': '📦'
        };
        for (const [key, icon] of Object.entries(icons)) {
            if (cat.toLowerCase().includes(key.toLowerCase())) return icon;
        }
        return icons['Autres'];
    }

    getSubcategoryIcon(subcat) {
        const icons = {
            'Recommandé': '⭐',
            'Populaire': '🔥',
            'Arrivage': '🆕',
            'Solde': '💰'
        };
        return icons[subcat] || '📌';
    }

    selectCategory(cat, subcategory = 'all') {
        this.close();
        window.dispatchEvent(new CustomEvent('categorySelected', { 
            detail: { category: cat, subcategory: subcategory } 
        }));
        
        // Mise à jour visuelle
        document.querySelectorAll('.category-item').forEach(item => {
            item.classList.toggle('active', item.dataset.category === cat && subcategory === 'all');
        });
        document.querySelectorAll('.subcategory-item').forEach(item => {
            item.classList.toggle('active', 
                item.dataset.category === cat && item.dataset.subcategory === subcategory);
        });
    }

    close() {
        document.getElementById('sideMenu')?.classList.remove('active');
        document.getElementById('overlay')?.classList.remove('active');
    }

    update(products) {
        this.products = products;
        this.generateCategories();
        this.render();
    }

    injectStyles() {
        if (document.getElementById('improved-menu-styles')) return;
        const styles = `<style id="improved-menu-styles">
            .category-wrapper {
                margin-bottom: 8px;
            }
            .category-item { 
                padding: 0; 
                background: var(--bg-secondary); 
                border-radius: 12px; 
                cursor: pointer; 
                transition: all 0.3s; 
                border: 2px solid transparent; 
                overflow: hidden; 
                position: relative;
            }
            .category-item.active { 
                border-color: var(--primary-color); 
                background: linear-gradient(90deg, rgba(255,107,0,0.1), rgba(255,107,0,0.05)); 
            }
            .category-all { 
                background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); 
                color: white; 
                font-weight: 600; 
            }
            .category-all .category-name, 
            .category-all .category-count { 
                color: white; 
            }
            .category-content { 
                padding: 14px 16px; 
                padding-right: 45px;
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
            }
            .category-header { 
                display: flex; 
                align-items: center; 
                gap: 10px; 
            }
            .category-icon { 
                font-size: 1.3rem; 
            }
            .category-name { 
                font-weight: 600; 
                color: var(--text-primary); 
                font-size: 0.95rem; 
            }
            .category-stats { 
                display: flex; 
                align-items: center; 
                gap: 8px; 
            }
            .category-count { 
                font-weight: 700; 
                color: var(--primary-color); 
                font-size: 1.1rem; 
                background: rgba(255,107,0,0.1); 
                padding: 4px 10px; 
                border-radius: 12px; 
                min-width: 40px; 
                text-align: center; 
            }
            .category-all .category-count { 
                background: rgba(255,255,255,0.2); 
            }
            .category-percentage { 
                font-size: 0.75rem; 
                color: var(--text-secondary); 
                font-weight: 600; 
            }
            .category-progress { 
                height: 3px; 
                background: rgba(0,0,0,0.05); 
            }
            .category-progress-bar { 
                height: 100%; 
                background: linear-gradient(90deg, var(--primary-color), var(--primary-dark)); 
                transition: width 0.5s; 
            }
            .category-item:hover { 
                transform: translateX(4px); 
                box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            }
            
            /* BOUTON TOGGLE SOUS-CATÉGORIES */
            .toggle-subcategories {
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                width: 32px;
                height: 32px;
                border: none;
                background: rgba(255,255,255,0.9);
                border-radius: 8px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                z-index: 10;
            }
            .category-all .toggle-subcategories {
                background: rgba(255,255,255,0.2);
            }
            .toggle-subcategories:hover {
                background: rgba(255,107,0,0.1);
                transform: translateY(-50%) scale(1.1);
            }
            .toggle-subcategories svg {
                transition: transform 0.3s ease;
                color: var(--primary-color);
            }
            .category-all .toggle-subcategories svg {
                color: white;
            }
            .toggle-subcategories.expanded svg {
                transform: rotate(180deg);
            }
            
            /* SOUS-CATÉGORIES */
            .subcategories-container {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease, padding 0.4s ease;
                padding: 0 12px;
                background: rgba(0,0,0,0.02);
                border-top: 0px solid rgba(0,0,0,0.05);
            }
            .subcategories-container.expanded {
                max-height: 500px;
                padding: 8px 12px 12px 12px;
                border-top: 1px solid rgba(0,0,0,0.05);
            }
            .subcategory-item {
                padding: 0;
                background: white;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s;
                border: 1px solid var(--border-color);
                overflow: hidden;
                margin-bottom: 6px;
                opacity: 0;
                transform: translateX(-10px);
                animation: slideInSubcat 0.3s ease forwards;
            }
            @keyframes slideInSubcat {
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            .subcategory-item:nth-child(1) { animation-delay: 0.05s; }
            .subcategory-item:nth-child(2) { animation-delay: 0.1s; }
            .subcategory-item:nth-child(3) { animation-delay: 0.15s; }
            .subcategory-item:nth-child(4) { animation-delay: 0.2s; }
            .subcategory-item:last-child {
                margin-bottom: 0;
            }
            .subcategory-item.active {
                border-color: var(--primary-color);
                background: linear-gradient(90deg, rgba(255,107,0,0.08), rgba(255,107,0,0.03));
            }
            .subcategory-item:hover {
                transform: translateX(4px);
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                border-color: var(--primary-color);
            }
            .subcategory-content {
                padding: 10px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .subcategory-header {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .subcategory-icon {
                font-size: 1.1rem;
            }
            .subcategory-name {
                font-weight: 500;
                color: var(--text-primary);
                font-size: 0.85rem;
            }
            .subcategory-stats {
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .subcategory-count {
                font-weight: 700;
                color: var(--primary-color);
                font-size: 0.9rem;
                background: rgba(255,107,0,0.1);
                padding: 2px 8px;
                border-radius: 8px;
                min-width: 30px;
                text-align: center;
            }
            .subcategory-percentage {
                font-size: 0.7rem;
                color: var(--text-secondary);
                font-weight: 600;
            }
            .subcategory-progress {
                height: 2px;
                background: rgba(0,0,0,0.05);
            }
            .subcategory-progress-bar {
                height: 100%;
                background: linear-gradient(90deg, #667eea, #764ba2);
                transition: width 0.5s;
            }
        </style>`;
        document.head.insertAdjacentHTML('beforeend', styles);
    }
}

window.improvedMenu = new ImprovedMenu();
// ==================== SUITE DU CODE (Partie 2) ====================
// ==================== GESTION UTILISATEUR ====================
function getUserId() {
    let userId = localStorage.getItem('oda_user_id');
    if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('oda_user_id', userId);
    }
    return userId;
}

function getUserName() {
    let userName = localStorage.getItem('oda_user_name');
    if (!userName) {
        userName = prompt('Entrez votre nom pour commenter:') || 'Anonyme';
        localStorage.setItem('oda_user_name', userName);
    }
    return userName;
}

// ==================== FAVORIS ====================
function loadFavorites() {
    const stored = localStorage.getItem('oda_favorites');
    if (stored) {
        try {
            favoriteProducts = new Set(JSON.parse(stored));
            console.log(`❤️ ${favoriteProducts.size} favoris chargés`);
        } catch (e) {
            favoriteProducts = new Set();
        }
    }
}

function saveFavorites() {
    localStorage.setItem('oda_favorites', JSON.stringify([...favoriteProducts]));
}

function toggleFavorite(productId) {
    if (favoriteProducts.has(productId)) {
        favoriteProducts.delete(productId);
        showToast('Retiré des favoris', 'info');
    } else {
        favoriteProducts.add(productId);
        showToast('Ajouté aux favoris', 'success');
    }
    saveFavorites();
    updateBadges();
    displayProducts();
    updateCarousel();
}

function updateBadges() {
    const favBadge = document.getElementById('favBadge');
    if (favBadge) {
        const favCount = favoriteProducts.size;
        favBadge.textContent = favCount;
        favBadge.style.display = favCount > 0 ? 'flex' : 'none';
    }
}

// ==================== LIKES ====================
async function toggleLike(productId) {
    const currentLike = productLikes[productId] || { count: 0, userLiked: false };

    try {
        if (currentLike.userLiked) {
            await supabase.from('product_likes').delete()
                .eq('product_id', productId).eq('user_id', currentUserId);
            productLikes[productId] = {
                count: Math.max(0, currentLike.count - 1),
                userLiked: false
            };
            showToast('Like retiré', 'info');
        } else {
            await supabase.from('product_likes').insert({
                product_id: productId,
                user_id: currentUserId
            });
            productLikes[productId] = {
                count: currentLike.count + 1,
                userLiked: true
            };
            showToast('Produit liké !', 'success');
        }
        updateLikeButton(productId);
        updateCarousel();
    } catch (error) {
        console.error('Erreur like:', error);
        showToast('Erreur lors du like', 'error');
    }
}

function updateLikeButton(productId) {
    const likeData = productLikes[productId] || { count: 0, userLiked: false };
    const likeBtns = document.querySelectorAll(`[data-like-product="${productId}"]`);
    
    likeBtns.forEach(btn => {
        const countSpan = btn.querySelector('.like-count');
        const icon = btn.querySelector('.like-icon');
        if (countSpan) countSpan.textContent = likeData.count;
        if (icon) icon.textContent = likeData.userLiked ? '❤️' : '🤍';
        btn.classList.toggle('liked', likeData.userLiked);
    });
}

// ==================== COMMENTAIRES ====================
async function addComment(productId, commentText, rating) {
    if (!commentText.trim()) {
        showToast('Le commentaire ne peut pas être vide', 'error');
        return;
    }

    const userName = getUserName();

    try {
        const { data, error } = await supabase.from('product_comments').insert({
            product_id: productId,
            user_id: currentUserId,
            user_name: userName,
            comment: commentText.trim(),
            rating: rating || 5
        }).select().single();

        if (error) throw error;

        if (!productComments[productId]) {
            productComments[productId] = [];
        }
        productComments[productId].unshift(data);
        showToast('Commentaire ajouté !', 'success');
        return data;
    } catch (error) {
        console.error('Erreur commentaire:', error);
        showToast('Erreur lors de l\'ajout', 'error');
    }
}

function calculateAverageRating(comments) {
    if (!comments || comments.length === 0) return '0.0';
    const sum = comments.reduce((acc, c) => acc + (c.rating || 0), 0);
    return (sum / comments.length).toFixed(1);
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'Aujourd\'hui';
    if (diffDays === 1) return 'Hier';
    if (diffDays < 7) return `Il y a ${diffDays} jours`;
    if (diffDays < 30) return `Il y a ${Math.floor(diffDays / 7)} semaines`;
    return date.toLocaleDateString('fr-FR');
}

// ==================== MODAL COMMENTAIRES ====================
function showCommentsModal(productId) {
    const product = allProducts.find(p => p.id === productId);
    if (!product) return;

    const comments = productComments[productId] || [];
    const likeData = productLikes[productId] || { count: 0, userLiked: false };

    const modal = document.createElement('div');
    modal.className = 'comments-modal';
    modal.innerHTML = `
        <div class="modal-backdrop" onclick="this.parentElement.remove()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>${product.nom}</h3>
                <button class="btn-close" onclick="this.closest('.comments-modal').remove()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-stats">
                <div class="stat-item">
                    <span class="stat-icon">❤️</span>
                    <span class="stat-value">${likeData.count}</span>
                    <span class="stat-label">Likes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">💬</span>
                    <span class="stat-value">${comments.length}</span>
                    <span class="stat-label">Commentaires</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">⭐</span>
                    <span class="stat-value">${calculateAverageRating(comments)}</span>
                    <span class="stat-label">Note moyenne</span>
                </div>
            </div>
            <div class="comment-form">
                <h4>Ajouter un commentaire</h4>
                <div class="rating-input">
                    <span>Note :</span>
                    ${[5,4,3,2,1].map(star => `
                        <label>
                            <input type="radio" name="rating" value="${star}" ${star === 5 ? 'checked' : ''}>
                            <span class="star">${'⭐'.repeat(star)}</span>
                        </label>
                    `).join('')}
                </div>
                <textarea id="commentInput" placeholder="Partagez votre avis..." rows="3"></textarea>
                <button class="btn-submit" onclick="submitComment(${productId})">
                    Publier le commentaire
                </button>
            </div>
            <div class="comments-list">
                <h4>Tous les commentaires (${comments.length})</h4>
                ${comments.length === 0 ? `
                    <div class="empty-comments">
                        <p>Aucun commentaire</p>
                        <p>Soyez le premier à donner votre avis !</p>
                    </div>
                ` : comments.map(c => `
                    <div class="comment-item">
                        <div class="comment-header">
                            <div class="comment-user">
                                <span class="user-avatar">${c.user_name.charAt(0).toUpperCase()}</span>
                                <span class="user-name">${c.user_name}</span>
                            </div>
                            <div class="comment-rating">${'⭐'.repeat(c.rating)}</div>
                        </div>
                        <p class="comment-text">${c.comment}</p>
                        <span class="comment-date">${formatDate(c.created_at)}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

window.submitComment = async function(productId) {
    const input = document.getElementById('commentInput');
    const ratingInput = document.querySelector('input[name="rating"]:checked');
    if (!input || !ratingInput) return;
    
    const comment = input.value;
    const rating = parseInt(ratingInput.value);

    if (comment.trim()) {
        await addComment(productId, comment, rating);
        input.value = '';
        document.querySelector('.comments-modal').remove();
        showCommentsModal(productId);
    }
};

// ==================== UTILITAIRES ====================
function formatPrice(price) {
    return `${price.toLocaleString('fr-FR')} FCFA`;
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    if (!container) return;

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
    toast.innerHTML = `<span style="font-size:1.2rem;">${icon}</span><span>${message}</span>`;
    
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ==================== NAVIGATION ====================
window.goToProduct = function(productId) {
    window.location.href = `produit.html?id=${productId}`;
};

window.goToShop = function(shopSlug, productId) {
    if (shopSlug) {
        window.location.href = `boutique.html?shop=${shopSlug}#product-${productId}`;
    } else {
        showToast('Boutique non disponible', 'error');
    }
};

window.scrollToProducts = function() {
    document.querySelector('.products-container')?.scrollIntoView({ 
        behavior: 'smooth', block: 'start' 
    });
};

// Exposer les fonctions globales
window.toggleFavorite = toggleFavorite;
window.toggleLike = toggleLike;
window.showCommentsModal = showCommentsModal;
// ==================== AFFICHAGE PRODUITS ====================
function displayProducts() {
    const grid = document.getElementById('productsGrid');
    const emptyState = document.getElementById('emptyState');
    const productCount = document.getElementById('productCount');
    const sectionHeader = document.querySelector('.section-header h2');

    let filteredProducts = [...allProducts];

    if (filteredProducts.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        if (productCount) productCount.textContent = '0 produits';
        return;
    }

    grid.style.display = 'block';
    emptyState.style.display = 'none';
    if (productCount) productCount.textContent = `${filteredProducts.length} produits`;
    
    displayProductsByCategories(filteredProducts);
}

function displayProductsByCategories(products) {
    const grid = document.getElementById('productsGrid');
    const sectionHeader = document.querySelector('.section-header h2');
    if (sectionHeader) sectionHeader.textContent = 'Tous les produits';
    
    const categories = {};
    products.forEach(product => {
        const cat = product.categorie || 'Autres';
        if (!categories[cat]) categories[cat] = [];
        categories[cat].push(product);
    });

    let html = '';
    Object.keys(categories).forEach(category => {
        const categoryProducts = categories[category].slice(0, 20);
        
        html += `
            <div class="category-section" style="margin-bottom: 40px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 1.3rem; font-weight: 700; color: var(--text-primary);">
                        ${category}
                    </h3>
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">
                        ${categoryProducts.length} produits
                    </span>
                </div>
                <div class="horizontal-scroll" style="
                    display: flex;
                    gap: 16px;
                    overflow-x: auto;
                    overflow-y: hidden;
                    padding-bottom: 12px;
                    scroll-snap-type: x mandatory;
                    -webkit-overflow-scrolling: touch;
                ">
                    ${categoryProducts.map(product => createProductCard(product, true)).join('')}
                </div>
            </div>
        `;
    });
    
    grid.innerHTML = html;
    grid.style.display = 'block';
    grid.style.gridTemplateColumns = '1fr';
}

function createProductCard(product, isHorizontal = false) {
    const cardStyle = isHorizontal ? `min-width: 200px; max-width: 200px; scroll-snap-align: start;` : '';
    const likeData = productLikes[product.id] || { count: 0, userLiked: false };
    const commentsCount = (productComments[product.id] || []).length;

    return `
        <div class="product-card" style="${cardStyle}" onclick="goToProduct(${product.id})">
            <div class="product-image-wrapper">
                <button class="btn-favorite ${favoriteProducts.has(product.id) ? 'active' : ''}"
                        onclick="event.stopPropagation(); toggleFavorite(${product.id})">
                    ${favoriteProducts.has(product.id) ? '❤️' : '🤍'}
                </button>
                <img src="${product.mainImage || 'https://via.placeholder.com/300'}" 
                     class="product-image" 
                     alt="${product.nom}"
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/300?text=Produit'">
            </div>
            <div class="product-info">
                <span class="shop-badge" style="background: ${product.shopColor}15; color: ${product.shopColor}">
                    🏪 ${product.shopName}
                </span>
                <h3 class="product-name">${product.nom}</h3>
                
                <div class="product-engagement">
                    <button class="btn-like ${likeData.userLiked ? 'liked' : ''}" 
                            data-like-product="${product.id}"
                            onclick="event.stopPropagation(); toggleLike(${product.id})">
                        <span class="like-icon">${likeData.userLiked ? '❤️' : '🤍'}</span>
                        <span class="like-count">${likeData.count}</span>
                    </button>
                    <button class="btn-comments" onclick="event.stopPropagation(); showCommentsModal(${product.id})">
                        <span>💬</span>
                        <span>${commentsCount}</span>
                    </button>
                    ${product.rating && parseFloat(product.rating) > 0 ? `
                        <span class="product-rating">⭐ ${product.rating}</span>
                    ` : ''}
                </div>
                
                <div class="product-price" style="color: ${product.shopColor}">${formatPrice(product.prix)}</div>
                ${product.stock < 10 ? `<div class="product-stock">Plus que ${product.stock} en stock !</div>` : ''}
            </div>
        </div>
    `;
}


// ==================== FILTRAGE PAR CATÉGORIE ====================
function filterByCategory(category, subcategory = 'all') {
    const grid = document.getElementById('productsGrid');
    const emptyState = document.getElementById('emptyState');
    const productCount = document.getElementById('productCount');
    const sectionHeader = document.querySelector('.section-header h2');
    
    let filtered = allProducts;
    
    // Filtrage par catégorie principale
    if (category !== 'Tous') {
        filtered = allProducts.filter(p => p.categorie === category);
    }
    
    // Filtrage par sous-catégorie
    if (subcategory !== 'all') {
        if (subcategory === 'Recommandé') {
            filtered = filtered.filter(p => (p.likes || 0) >= 5);
        } else if (subcategory === 'Populaire') {
            const topLikesThreshold = Math.ceil(filtered.length * 0.2);
            filtered = [...filtered].sort((a, b) => (b.likes || 0) - (a.likes || 0)).slice(0, Math.max(1, topLikesThreshold));
        } else if (subcategory === 'Arrivage') {
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            filtered = filtered.filter(p => {
                const createdDate = new Date(p.created_at);
                return createdDate >= sevenDaysAgo;
            });
        } else if (subcategory === 'Solde') {
            filtered = filtered.filter(p => p.prix < 5000);
        }
    }
    
    // Mise à jour du titre
    if (sectionHeader) {
        let title = category === 'Tous' ? 'Tous les produits' : category;
        if (subcategory !== 'all') {
            title += ` - ${subcategory}`;
        }
        sectionHeader.textContent = title;
    }
    
    // Affichage des résultats
    if (filtered.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        if (productCount) productCount.textContent = '0 produits';
    } else {
        grid.style.display = 'grid';
        emptyState.style.display = 'none';
        if (productCount) productCount.textContent = `${filtered.length} produits`;
        
        // TOUTES LES CATÉGORIES ET SOUS-CATÉGORIES AFFICHENT LES PRODUITS COMME "TOUS"
        displayProductsByCategories(filtered);
    }
    
    document.querySelector('.products-container')?.scrollIntoView({ 
        behavior: 'smooth', block: 'start' 
    });
}
// ==================== CAROUSEL ====================
function updateCarousel() {
    const container = document.getElementById('carouselContainer');
    const dotsContainer = document.getElementById('carouselDots');

    popularProducts = [...allProducts]
        .sort((a, b) => {
            const aLikes = productLikes[a.id]?.count || 0;
            const bLikes = productLikes[b.id]?.count || 0;
            return bLikes - aLikes;
        })
        .slice(0, 10);

    if (popularProducts.length === 0) {
        document.getElementById('heroCarousel')?.style.setProperty('display', 'none');
        return;
    }

    container.innerHTML = popularProducts.map(product => {
        const likeData = productLikes[product.id] || { count: 0, userLiked: false };
        const commentsCount = (productComments[product.id] || []).length;
        
        return `
        <div class="carousel-item" onclick="goToProduct(${product.id})">
            <img src="${product.mainImage || 'https://via.placeholder.com/1200x400'}" 
                 class="carousel-image" 
                 alt="${product.nom}"
                 onerror="this.src='https://via.placeholder.com/1200x400'">
            <div class="carousel-overlay">
                <div class="carousel-info">
                    <h2>${product.nom}</h2>
                    <p class="shop-name">🏪 ${product.shopName}</p>
                    <p class="product-price">${formatPrice(product.prix)}</p>
                    <div style="display: flex; gap: 16px; margin-top: 8px; font-size: 0.9rem; opacity: 0.9;">
                        <span>❤️ ${likeData.count} likes</span>
                        <span>💬 ${commentsCount} commentaires</span>
                    </div>
                </div>
            </div>
        </div>
    `;
    }).join('');

    dotsContainer.innerHTML = popularProducts.map((_, i) => 
        `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`
    ).join('');

    startCarousel(popularProducts.length);
}

function startCarousel(totalSlides) {
    if (carouselInterval) clearInterval(carouselInterval);
    currentSlide = 0;
    carouselInterval = setInterval(() => {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateCarouselPosition();
    }, 5000);
}

function updateCarouselPosition() {
    const container = document.getElementById('carouselContainer');
    if (!container) return;
    
    container.style.transform = `translateX(-${currentSlide * 100}%)`;
    document.querySelectorAll('.dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === currentSlide);
    });
}

window.goToSlide = function(index) {
    currentSlide = index;
    updateCarouselPosition();
    if (carouselInterval) clearInterval(carouselInterval);
    startCarousel(popularProducts.length);
};

function initCarouselControls() {
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');

    if (btnPrev) {
        btnPrev.addEventListener('click', () => {
            currentSlide = (currentSlide - 1 + popularProducts.length) % popularProducts.length;
            updateCarouselPosition();
            if (carouselInterval) clearInterval(carouselInterval);
            startCarousel(popularProducts.length);
        });
    }

    if (btnNext) {
        btnNext.addEventListener('click', () => {
            currentSlide = (currentSlide + 1) % popularProducts.length;
            updateCarouselPosition();
            if (carouselInterval) clearInterval(carouselInterval);
            startCarousel(popularProducts.length);
        });
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') btnPrev?.click();
        else if (e.key === 'ArrowRight') btnNext?.click();
    });
}

// ==================== RECHERCHE ====================
function initSearch() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        if (searchTerm.length === 0) {
            displayProducts();
            return;
        }
        
        const filtered = allProducts.filter(p => 
            p.nom.toLowerCase().includes(searchTerm) ||
            p.shopName.toLowerCase().includes(searchTerm) ||
            p.categorie?.toLowerCase().includes(searchTerm)
        );
        
        const grid = document.getElementById('productsGrid');
        const emptyState = document.getElementById('emptyState');
        const productCount = document.getElementById('productCount');
        
        if (filtered.length === 0) {
            grid.style.display = 'none';
            emptyState.style.display = 'block';
            if (productCount) productCount.textContent = '0 produits';
        } else {
            grid.style.display = 'grid';
            emptyState.style.display = 'none';
            if (productCount) productCount.textContent = `${filtered.length} produits`;
            grid.innerHTML = filtered.map(product => createProductCard(product, false)).join('');
        }
    });
}
// ==================== CHARGEMENT OPTIMISÉ ====================
async function loadAllProductsOptimized() {
    try {
        const dataLoader = new OptimizedDataLoader(supabase);
        const data = await dataLoader.load();
        
        allProducts = data.products;
        productLikes = data.likes;
        productComments = data.comments;
        
        // Convertir les likes au bon format
        Object.keys(productLikes).forEach(productId => {
            const likeData = productLikes[productId];
            productLikes[productId] = {
                count: likeData.count,
                userLiked: likeData.users.includes(currentUserId)
            };
        });
        
        // Initialiser le menu
        window.improvedMenu.init(allProducts);
        
        // Afficher
        displayProducts();
        updateCarousel();
        
        // Stats
        console.log('📊 STATISTIQUES:');
        console.log(`   - Produits: ${allProducts.length}`);
        console.log(`   - Cache: ${window.cacheManager.getStats().size}`);
        
        return data;
    } catch (error) {
        console.error('❌ Erreur:', error);
        document.getElementById('emptyState').style.display = 'block';
        showToast('Erreur de chargement', 'error');
        throw error;
    }
}

// ==================== FILTRAGE PAR CATÉGORIE ====================
function setupCategoryFiltering() {
    window.addEventListener('categorySelected', (e) => {
    filterByCategory(e.detail.category, e.detail.subcategory || 'all');
});
}

// ==================== MENU LATÉRAL ====================
function initSideMenu() {
    const menuBtn = document.getElementById('menuBtn');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const overlay = document.getElementById('overlay');
    
    if (menuBtn) {
        menuBtn.addEventListener('click', () => {
            document.getElementById('sideMenu')?.classList.add('active');
            overlay?.classList.add('active');
            window.improvedMenu.render();
        });
    }
    
    if (closeMenuBtn) {
        closeMenuBtn.addEventListener('click', () => {
            document.getElementById('sideMenu')?.classList.remove('active');
            overlay?.classList.remove('active');
        });
    }
    
    if (overlay) {
        overlay.addEventListener('click', () => {
            document.getElementById('sideMenu')?.classList.remove('active');
            overlay.classList.remove('active');
        });
    }
    
    // Liens du menu
    const aboutLink = document.getElementById('aboutLink');
    const contactLink = document.getElementById('contactLink');
    const helpLink = document.getElementById('helpLink');
    
    if (aboutLink) {
        aboutLink.addEventListener('click', (e) => {
            e.preventDefault();
            showToast('Page À propos - En construction', 'info');
        });
    }
    
    if (contactLink) {
        contactLink.addEventListener('click', (e) => {
            e.preventDefault();
            showToast('Page Contact - En construction', 'info');
        });
    }
    
    if (helpLink) {
        helpLink.addEventListener('click', (e) => {
            e.preventDefault();
            showToast('Page Aide - En construction', 'info');
        });
    }
}

// ==================== PARAMÈTRES ====================
let userSettings = {
    userName: '',
    lastNameChange: null,
    notifications: {
        newProducts: true,
        promotions: true,
        comments: true,
        popular: true
    },
    preferences: {
        darkMode: false,
        sounds: true
    }
};

function chargerParametresUtilisateur() {
    try {
        const saved = localStorage.getItem('oda_user_settings');
        if (saved) {
            userSettings = { ...userSettings, ...JSON.parse(saved) };
        }
        if (!userSettings.userName) {
            userSettings.userName = localStorage.getItem('oda_user_name') || '';
        }
        appliquerParametres();
    } catch (e) {
        console.error('Erreur chargement paramètres:', e);
    }
}

function appliquerParametres() {
    const input = document.getElementById('userNameInput');
    if (input) input.value = userSettings.userName || 'Non défini';
    
    const notifNewProducts = document.getElementById('notifNewProducts');
    const notifPromotions = document.getElementById('notifPromotions');
    const notifComments = document.getElementById('notifComments');
    const notifPopular = document.getElementById('notifPopular');
    const darkMode = document.getElementById('darkMode');
    const appSounds = document.getElementById('appSounds');
    
    if (notifNewProducts) notifNewProducts.checked = userSettings.notifications.newProducts;
    if (notifPromotions) notifPromotions.checked = userSettings.notifications.promotions;
    if (notifComments) notifComments.checked = userSettings.notifications.comments;
    if (notifPopular) notifPopular.checked = userSettings.notifications.popular;
    if (darkMode) darkMode.checked = userSettings.preferences.darkMode;
    if (appSounds) appSounds.checked = userSettings.preferences.sounds;
    
    if (userSettings.preferences.darkMode) {
        document.body.classList.add('dark-mode');
    }
}

function sauvegarderParametres() {
    try {
        localStorage.setItem('oda_user_settings', JSON.stringify(userSettings));
        localStorage.setItem('oda_user_name', userSettings.userName);
    } catch (e) {
        console.error('Erreur sauvegarde:', e);
    }
}

window.ouvrirParametres = function() {
    chargerParametresUtilisateur();
    document.getElementById('settingsModal')?.classList.add('active');
};

window.ouvrirChangementNom = function() {
    const newName = prompt('Entrez votre nouveau nom:', userSettings.userName);
    if (newName && newName.trim() && newName.trim() !== userSettings.userName) {
        userSettings.userName = newName.trim();
        userSettings.lastNameChange = new Date().toISOString();
        sauvegarderParametres();
        appliquerParametres();
        showToast('✅ Nom modifié', 'success');
    }
};

window.effacerDonnees = function() {
    if (confirm('⚠️ ATTENTION !\n\nSupprimer vos favoris, paramètres et historique ?')) {
        localStorage.clear();
        sessionStorage.clear();
        showToast('✅ Données effacées', 'success');
        setTimeout(() => window.location.reload(), 1500);
    }
};

function initialiserParametres() {
    const settingsBtn = document.getElementById('settingsBtn');
    if (settingsBtn) {
        settingsBtn.addEventListener('click', window.ouvrirParametres);
    }
    
    ['notifNewProducts', 'notifPromotions', 'notifComments', 'notifPopular'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            const key = id.replace('notif', '').replace(/^./, str => str.toLowerCase());
            el.addEventListener('change', function() {
                userSettings.notifications[key] = this.checked;
                sauvegarderParametres();
            });
        }
    });
    
    const darkMode = document.getElementById('darkMode');
    if (darkMode) {
        darkMode.addEventListener('change', function() {
            userSettings.preferences.darkMode = this.checked;
            document.body.classList.toggle('dark-mode', this.checked);
            sauvegarderParametres();
        });
    }
    
    const appSounds = document.getElementById('appSounds');
    if (appSounds) {
        appSounds.addEventListener('change', function() {
            userSettings.preferences.sounds = this.checked;
            sauvegarderParametres();
        });
    }
    
    chargerParametresUtilisateur();
}

// ==================== GESTION DU CACHE ====================
function addForceReloadButton() {
    const settingsBody = document.querySelector('.settings-body');
    if (!settingsBody) return;
    
    const cacheSection = document.createElement('div');
    cacheSection.className = 'settings-section';
    cacheSection.innerHTML = `
        <div class="section-header">
            <span class="section-icon">💾</span>
            <h3>Cache de l'application</h3>
        </div>
        <div id="cacheInfo" style="background:var(--bg-secondary);padding:16px;border-radius:12px;margin-bottom:16px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                <span style="color:var(--text-secondary);">Taille:</span>
                <strong id="cacheSize">Calcul...</strong>
            </div>
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                <span style="color:var(--text-secondary);">Âge:</span>
                <strong id="cacheAge">Calcul...</strong>
            </div>
            <div style="display:flex;justify-content:space-between;">
                <span style="color:var(--text-secondary);">Statut:</span>
                <strong id="cacheStatus">Valide</strong>
            </div>
        </div>
        <button class="btn-primary" onclick="window.forceReloadData()" style="width:100%;background:#3B82F6;margin-bottom:12px;">
            🔄 Forcer le rechargement
        </button>
        <button class="btn-danger" onclick="window.clearAllCache()">
            🗑️ Vider le cache
        </button>
    `;
    settingsBody.appendChild(cacheSection);
    updateCacheInfo();
}

function updateCacheInfo() {
    const stats = window.cacheManager?.getStats();
    if (!stats) return;
    
    const sizeEl = document.getElementById('cacheSize');
    const ageEl = document.getElementById('cacheAge');
    const statusEl = document.getElementById('cacheStatus');
    
    if (sizeEl) sizeEl.textContent = stats.size;
    if (ageEl) ageEl.textContent = stats.age || 'Nouveau';
    if (statusEl) {
        statusEl.textContent = stats.valid ? 'Valide ✓' : 'Expiré ✗';
        statusEl.style.color = stats.valid ? 'var(--success-color)' : 'var(--error-color)';
    }
}

window.forceReloadData = async function() {
    if (confirm('Recharger depuis le serveur ?')) {
        window.loadingProgress.start();
        try {
            const dataLoader = new OptimizedDataLoader(supabase);
            await dataLoader.forceReload();
            allProducts = dataLoader.data.products;
            productLikes = dataLoader.data.likes;
            productComments = dataLoader.data.comments;
            window.improvedMenu.update(allProducts);
            displayProducts();
            updateCarousel();
            showToast('✅ Données rechargées', 'success');
            updateCacheInfo();
        } catch (error) {
            showToast('❌ Erreur', 'error');
        }
    }
};

window.clearAllCache = function() {
    if (confirm('Vider le cache ?')) {
        window.cacheManager.clearAll();
        showToast('🗑️ Cache vidé', 'success');
        updateCacheInfo();
    }
};

// ==================== SCROLL HEADER ====================
let lastScrollTop = 0;
function initScrollBehavior() {
    window.addEventListener('scroll', () => {
        const header = document.querySelector('.main-header');
        if (!header) return;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop && scrollTop > 100) {
            header.style.transform = 'translateY(-100%)';
        } else {
            header.style.transform = 'translateY(0)';
        }
        lastScrollTop = scrollTop;
    });
}

// ==================== PWA NOTIFICATIONS ====================
window.verifierStatutNotifications = function() {
    const statusText = document.getElementById('notifStatusText');
    const enableBtn = document.getElementById('enableNotifBtn');
    if (!statusText || !enableBtn) return;
    
    if (!('Notification' in window)) {
        statusText.textContent = '❌ Non supportées';
        enableBtn.disabled = true;
        return;
    }
    
    const permission = Notification.permission;
    switch(permission) {
        case 'granted':
            statusText.innerHTML = '✅ <span style="color:var(--success-color);font-weight:600;">Activées</span>';
            enableBtn.style.display = 'none';
            break;
        case 'denied':
            statusText.innerHTML = '❌ <span style="color:var(--error-color);font-weight:600;">Bloquées</span>';
            enableBtn.textContent = 'Débloquer';
            break;
        default:
            statusText.innerHTML = '⚠️ <span style="color:#F59E0B;font-weight:600;">Non activées</span>';
            enableBtn.style.display = 'block';
    }
};

window.activerNotifications = async function() {
    if (!window.pwaManager) {
        showToast('PWA Manager non disponible', 'error');
        return;
    }
    const granted = await window.pwaManager.requestNotificationPermission();
    if (granted) {
        window.verifierStatutNotifications();
        showToast('🎉 Notifications activées !', 'success');
    }
};

// ==================== INITIALISATION COMPLÈTE ====================
document.addEventListener('DOMContentLoaded', async () => {
    console.log('🚀 ODA MARKETPLACE - VERSION OPTIMISÉE');
    console.log('='.repeat(50));
    
    // Masquer l'ancien loader
    const oldLoader = document.getElementById('loader');
    if (oldLoader) oldLoader.style.display = 'none';
    
    // Chargement
    loadFavorites();
    updateBadges();
    await loadAllProductsOptimized();
    
    // Initialisation
    setupCategoryFiltering();
    initSideMenu();
    initCarouselControls();
    initSearch();
    initScrollBehavior();
    initialiserParametres();
    addForceReloadButton();
    
    // PWA
    if (window.verifierStatutNotifications) {
        window.verifierStatutNotifications();
    }
    
    // Mode PWA
    const isPWA = window.matchMedia('(display-mode: standalone)').matches;
    if (isPWA) {
        console.log('📱 Mode PWA');
        document.body.classList.add('pwa-mode');
    }
    
    console.log('='.repeat(50));
    console.log('✅ PRÊT');
    console.log('🎯 Fonctionnalités:');
    console.log('   ✓ Cache local optimisé');
    console.log('   ✓ Loader avec pourcentage');
    console.log('   ✓ Menu avec compteurs');
    console.log('   ✓ Catégorie "Tous"');
    console.log('   ✓ Chargement instantané');
});

// Refresh auto toutes les 30min
setInterval(() => {
    if (document.visibilityState === 'visible') {
        console.log('🔄 Mise à jour auto...');
        const dataLoader = new OptimizedDataLoader(supabase);
        dataLoader.updateInBackground();
    }
}, 30 * 60 * 1000);

// Mise à jour quand l'onglet redevient visible
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible' && window.cacheManager) {
        const stats = window.cacheManager.getStats();
        if (!stats.valid) {
            console.log('🔄 Cache expiré, rechargement...');
            loadAllProductsOptimized();
        }
    }
});

console.log('🎉 Système optimisé prêt !');
// ==================== ODA MARKETPLACE - CODE OPTIMISÉ ULTRA-RAPIDE ====================
// Version Play Store : Chargement progressif + Virtual Scrolling + Cache intelligent

// ==================== CONFIGURATION ====================
const CONFIG = {
    INITIAL_LOAD: 20,        // Nombre de produits au premier chargement
    LOAD_MORE: 15,           // Nombre de produits à charger au scroll
    CACHE_DURATION: 24 * 60, // Cache 24h au lieu de 5min
    IMAGE_QUALITY: 'medium', // Qualité images (low/medium/high)
    INTERSECTION_THRESHOLD: 0.1,
    DEBOUNCE_DELAY: 300
};

// ==================== GESTIONNAIRE DE CACHE AMÉLIORÉ ====================
class SmartCacheManager {
    constructor() {
        this.CACHE_KEY = 'oda_products_v2';
        this.CACHE_TIMESTAMP = 'oda_cache_timestamp_v2';
        this.MAX_AGE = CONFIG.CACHE_DURATION * 60 * 1000;
    }

    async get() {
        try {
            const timestamp = localStorage.getItem(this.CACHE_TIMESTAMP);
            const now = Date.now();
            
            if (timestamp && (now - parseInt(timestamp)) < this.MAX_AGE) {
                const cached = localStorage.getItem(this.CACHE_KEY);
                if (cached) {
                    console.log('✅ Cache local valide - Chargement instantané');
                    return JSON.parse(cached);
                }
            }
            return null;
        } catch (e) {
            console.warn('Cache error:', e);
            return null;
        }
    }

    async set(data) {
        try {
            localStorage.setItem(this.CACHE_KEY, JSON.stringify(data));
            localStorage.setItem(this.CACHE_TIMESTAMP, Date.now().toString());
            console.log('💾 Cache sauvegardé');
        } catch (e) {
            console.warn('Cache save error:', e);
        }
    }

    clear() {
        localStorage.removeItem(this.CACHE_KEY);
        localStorage.removeItem(this.CACHE_TIMESTAMP);
    }

    getAge() {
        const timestamp = localStorage.getItem(this.CACHE_TIMESTAMP);
        if (!timestamp) return null;
        const age = Date.now() - parseInt(timestamp);
        const minutes = Math.floor(age / 60000);
        return minutes < 60 ? `${minutes}min` : `${Math.floor(minutes / 60)}h`;
    }
}

// ==================== CHARGEUR DE DONNÉES ULTRA-RAPIDE ====================
class FastDataLoader {
    constructor(supabase) {
        this.supabase = supabase;
        this.cache = new SmartCacheManager();
        this.data = { products: [], likes: {}, comments: {} };
        this.loading = false;
    }

    async load() {
        if (this.loading) return this.data;
        this.loading = true;

        try {
            // 1. Essayer le cache d'abord
            const cached = await this.cache.get();
            if (cached) {
                this.data = cached;
                this.updateInBackground(); // Mise à jour silencieuse
                return this.data;
            }

            // 2. Chargement depuis Supabase
            console.log('📡 Chargement depuis Supabase...');
            const [products, likes, comments] = await Promise.all([
                this.supabase.from('oda-shop').select('*').order('created_at', { ascending: false }),
                this.supabase.from('product_likes').select('*'),
                this.supabase.from('product_comments').select('*')
            ]);

            this.data = {
                products: products.data || [],
                likes: this.processLikes(likes.data || []),
                comments: this.processComments(comments.data || [])
            };

            await this.cache.set(this.data);
            return this.data;

        } catch (error) {
            console.error('Erreur chargement:', error);
            throw error;
        } finally {
            this.loading = false;
        }
    }

    async updateInBackground() {
        try {
            const [products, likes, comments] = await Promise.all([
                this.supabase.from('oda-shop').select('*').order('created_at', { ascending: false }),
                this.supabase.from('product_likes').select('*'),
                this.supabase.from('product_comments').select('*')
            ]);

            this.data = {
                products: products.data || [],
                likes: this.processLikes(likes.data || []),
                comments: this.processComments(comments.data || [])
            };

            await this.cache.set(this.data);
            console.log('🔄 Cache mis à jour en arrière-plan');
        } catch (error) {
            console.warn('Mise à jour silencieuse échouée:', error);
        }
    }

    processLikes(likesArray) {
        const likesMap = {};
        likesArray.forEach(like => {
            if (!likesMap[like.product_id]) likesMap[like.product_id] = [];
            likesMap[like.product_id].push(like);
        });
        return likesMap;
    }

    processComments(commentsArray) {
        const commentsMap = {};
        commentsArray.forEach(comment => {
            if (!commentsMap[comment.product_id]) commentsMap[comment.product_id] = [];
            commentsMap[comment.product_id].push(comment);
        });
        return commentsMap;
    }

    async forceReload() {
        this.cache.clear();
        return await this.load();
    }
}

// ==================== GESTIONNAIRE D'IMAGES LAZY ====================
class LazyImageLoader {
    constructor() {
        this.observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const src = img.dataset.src;
                    if (src) {
                        img.src = src;
                        img.removeAttribute('data-src');
                        this.observer.unobserve(img);
                    }
                }
            });
        }, {
            rootMargin: '50px',
            threshold: CONFIG.INTERSECTION_THRESHOLD
        });
    }

    observe(img) {
        this.observer.observe(img);
    }

    disconnect() {
        this.observer.disconnect();
    }
}

// ==================== VIRTUAL SCROLL MANAGER ====================
class VirtualScrollManager {
    constructor(products, renderFunction) {
        this.allProducts = products;
        this.displayedProducts = [];
        this.renderFunction = renderFunction;
        this.currentIndex = 0;
        this.isLoading = false;
        this.container = null;
        this.sentinel = null;
    }

    init(containerId) {
        this.container = document.getElementById(containerId);
        if (!this.container) return;

        // Créer le sentinel pour l'infinite scroll
        this.sentinel = document.createElement('div');
        this.sentinel.id = 'scroll-sentinel';
        this.sentinel.style.cssText = 'height:1px;width:100%;';
        this.container.appendChild(this.sentinel);

        // Observer le sentinel
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !this.isLoading) {
                this.loadMore();
            }
        }, {
            rootMargin: '200px'
        });

        observer.observe(this.sentinel);

        // Chargement initial
        this.loadInitial();
    }

    loadInitial() {
        const initial = this.allProducts.slice(0, CONFIG.INITIAL_LOAD);
        this.displayedProducts = initial;
        this.currentIndex = CONFIG.INITIAL_LOAD;
        this.render();
    }

    loadMore() {
        if (this.isLoading || this.currentIndex >= this.allProducts.length) return;

        this.isLoading = true;
        this.showLoadingIndicator();

        // Simuler un petit délai pour effet visuel
        setTimeout(() => {
            const nextBatch = this.allProducts.slice(
                this.currentIndex,
                this.currentIndex + CONFIG.LOAD_MORE
            );

            this.displayedProducts = [...this.displayedProducts, ...nextBatch];
            this.currentIndex += CONFIG.LOAD_MORE;
            
            this.render(true); // true = append mode
            this.isLoading = false;
            this.hideLoadingIndicator();

            console.log(`📦 Chargés: ${this.displayedProducts.length}/${this.allProducts.length}`);
        }, 300);
    }

    render(append = false) {
        if (!append) {
            // Rendu initial
            this.container.innerHTML = '';
        }

        const startIndex = append ? this.displayedProducts.length - CONFIG.LOAD_MORE : 0;
        const endIndex = this.displayedProducts.length;

        for (let i = startIndex; i < endIndex; i++) {
            const product = this.displayedProducts[i];
            const element = this.renderFunction(product);
            this.container.insertBefore(element, this.sentinel);
        }
    }

    showLoadingIndicator() {
        if (document.getElementById('load-more-spinner')) return;
        
        const spinner = document.createElement('div');
        spinner.id = 'load-more-spinner';
        spinner.style.cssText = `
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 14px;
        `;
        spinner.innerHTML = `
            <div style="display:inline-block;width:30px;height:30px;border:3px solid var(--border-color);
                        border-top-color:var(--primary-color);border-radius:50%;animation:spin 0.8s linear infinite;"></div>
            <p style="margin-top:10px;">Chargement...</p>
        `;
        this.container.insertBefore(spinner, this.sentinel);
    }

    hideLoadingIndicator() {
        const spinner = document.getElementById('load-more-spinner');
        if (spinner) spinner.remove();
    }

    updateProducts(products) {
        this.allProducts = products;
        this.displayedProducts = [];
        this.currentIndex = 0;
        this.loadInitial();
    }
}

// ==================== SKELETON LOADER ====================
function createSkeletonCard() {
    const skeleton = document.createElement('div');
    skeleton.className = 'product-card skeleton';
    skeleton.style.cssText = `
        background: var(--bg-primary);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
    `;
    skeleton.innerHTML = `
        <div style="width:100%;height:200px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);
                    background-size:200% 100%;animation:shimmer 1.5s infinite;"></div>
        <div style="padding:16px;">
            <div style="width:60%;height:16px;background:#f0f0f0;border-radius:4px;margin-bottom:8px;"></div>
            <div style="width:40%;height:14px;background:#f0f0f0;border-radius:4px;margin-bottom:12px;"></div>
            <div style="width:80%;height:12px;background:#f0f0f0;border-radius:4px;"></div>
        </div>
    `;
    return skeleton;
}

function showSkeletonLoading(containerId, count = 6) {
    const container = document.getElementById(containerId);
    if (!container) return;

    container.innerHTML = '';
    for (let i = 0; i < count; i++) {
        container.appendChild(createSkeletonCard());
    }
}

// ==================== GESTIONNAIRE PRINCIPAL ====================
class OdaMarketplace {
    constructor(supabaseClient) {
        this.supabase = supabaseClient;
        this.dataLoader = new FastDataLoader(supabaseClient);
        this.lazyLoader = new LazyImageLoader();
        this.virtualScroll = null;
        this.allProducts = [];
        this.filteredProducts = [];
        this.currentCategory = 'Tous';
        this.searchTerm = '';
    }

    async init() {
        console.log('🚀 Initialisation ODA Marketplace Optimisé');
        
        // Afficher les skeletons
        showSkeletonLoading('productsGrid', 8);

        try {
            // Charger les données
            const data = await this.dataLoader.load();
            this.allProducts = data.products;
            window.productLikes = data.likes;
            window.productComments = data.comments;

            console.log(`✅ ${this.allProducts.length} produits chargés`);

            // Initialiser le virtual scroll
            this.filteredProducts = this.allProducts;
            this.virtualScroll = new VirtualScrollManager(
                this.filteredProducts,
                this.createProductCard.bind(this)
            );
            this.virtualScroll.init('productsGrid');

            // Mettre à jour le carousel
            this.updateCarousel();

            // Mettre à jour le menu
            if (window.improvedMenu) {
                window.improvedMenu.update(this.allProducts);
            }

        } catch (error) {
            console.error('❌ Erreur init:', error);
            this.showError();
        }
    }

    createProductCard(product) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.style.cssText = `
            background: var(--bg-primary);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        `;

        const likes = window.productLikes[product.id] || [];
        const comments = window.productComments[product.id] || [];
        const isFavorited = window.favorites?.includes(product.id);

        // Image lazy
        const imgUrl = product.image_url || product.image || 'placeholder.jpg';
        
        card.innerHTML = `
            <div style="position:relative;width:100%;padding-top:75%;background:#f0f0f0;">
                <img data-src="${imgUrl}" 
                     alt="${product.nom_produit}"
                     style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;"
                     loading="lazy">
                <button class="favorite-btn ${isFavorited ? 'active' : ''}" 
                        onclick="toggleFavorite(${product.id}); event.stopPropagation();"
                        style="position:absolute;top:12px;right:12px;width:40px;height:40px;
                               background:white;border:none;border-radius:50%;cursor:pointer;
                               box-shadow:0 2px 8px rgba(0,0,0,0.15);display:flex;align-items:center;
                               justify-content:center;transition:all 0.3s;">
                    ${isFavorited ? '❤️' : '🤍'}
                </button>
            </div>
            <div style="padding:16px;">
                <div style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:4px;">
                    ${product.nom_boutique || 'Boutique'}
                </div>
                <h3 style="font-size:1rem;font-weight:600;margin-bottom:8px;
                           overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">
                    ${product.nom_produit}
                </h3>
                <div style="font-size:1.4rem;font-weight:700;color:var(--primary-color);margin-bottom:12px;">
                    ${product.prix} FCFA
                </div>
                <div style="display:flex;gap:16px;color:var(--text-secondary);font-size:0.9rem;">
                    <span>❤️ ${likes.length}</span>
                    <span>💬 ${comments.length}</span>
                    <span>👁️ ${product.views || 0}</span>
                </div>
            </div>
        `;

        // Lazy load de l'image
        const img = card.querySelector('img');
        if (img) this.lazyLoader.observe(img);

        // Click handler
        card.addEventListener('click', () => {
            window.location.href = `product.html?id=${product.id}`;
        });

        return card;
    }

    filterProducts(category, searchTerm = '') {
        let filtered = this.allProducts;

        // Filtre catégorie
        if (category && category !== 'Tous') {
            filtered = filtered.filter(p => p.categorie === category);
        }

        // Filtre recherche
        if (searchTerm) {
            const search = searchTerm.toLowerCase();
            filtered = filtered.filter(p => 
                p.nom_produit?.toLowerCase().includes(search) ||
                p.nom_boutique?.toLowerCase().includes(search) ||
                p.categorie?.toLowerCase().includes(search)
            );
        }

        this.filteredProducts = filtered;
        
        if (this.virtualScroll) {
            this.virtualScroll.updateProducts(filtered);
        }

        console.log(`🔍 Filtrés: ${filtered.length}/${this.allProducts.length}`);
    }

    updateCarousel() {
        const carouselContainer = document.querySelector('.carousel-container');
        if (!carouselContainer || this.allProducts.length === 0) return;

        const topProducts = this.allProducts
            .sort((a, b) => (b.views || 0) - (a.views || 0))
            .slice(0, 5);

        carouselContainer.innerHTML = topProducts.map(product => `
            <div class="carousel-item">
                <img src="${product.image_url || product.image}" 
                     alt="${product.nom_produit}"
                     class="carousel-image"
                     loading="eager">
                <div class="carousel-overlay">
                    <div class="carousel-info">
                        <div class="shop-name">${product.nom_boutique}</div>
                        <h2>${product.nom_produit}</h2>
                        <div class="product-price">${product.prix} FCFA</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    showError() {
        const container = document.getElementById('productsGrid');
        if (container) {
            container.innerHTML = `
                <div style="grid-column:1/-1;text-align:center;padding:60px 20px;">
                    <div style="font-size:4rem;margin-bottom:16px;">😕</div>
                    <h3 style="font-size:1.3rem;margin-bottom:12px;">Erreur de chargement</h3>
                    <p style="color:var(--text-secondary);margin-bottom:24px;">
                        Impossible de charger les produits
                    </p>
                    <button onclick="location.reload()" 
                            style="background:var(--primary-color);color:white;border:none;
                                   padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:600;">
                        Réessayer
                    </button>
                </div>
            `;
        }
    }

    async forceReload() {
        showSkeletonLoading('productsGrid', 8);
        const data = await this.dataLoader.forceReload();
        this.allProducts = data.products;
        this.filterProducts(this.currentCategory, this.searchTerm);
        this.updateCarousel();
    }
}
/* ============================================ */
/* CODE JAVASCRIPT À AJOUTER À LA FIN          */
/* Ajoutez ce code dans une balise <script>    */
/* juste après le HTML des modals              */
/* ============================================ */

// ==================== GESTION DES MODALS ====================

/**
 * Ouvre un modal avec animation
 */
 function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error(`Modal ${modalId} introuvable`);
        return;
    }
    
    // Ajouter la classe active
    modal.classList.add('active');
    
    // Empêcher le scroll du body
    document.body.style.overflow = 'hidden';
    
    // Animation d'entrée
    const modalContent = modal.querySelector('.modal-content');
    if (modalContent) {
        modalContent.style.animation = 'modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
    }
    
    // Event listener pour fermer avec Échap
    document.addEventListener('keydown', handleEscapeKey);
    
    console.log(`✅ Modal ${modalId} ouverte`);
}

/**
 * Ferme un modal avec animation
 */
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) {
        console.error(`Modal ${modalId} introuvable`);
        return;
    }
    
    // Animation de sortie
    const modalContent = modal.querySelector('.modal-content');
    if (modalContent) {
        modalContent.style.animation = 'modalSlideDown 0.3s ease';
    }
    
    // Retirer la classe active après l'animation
    setTimeout(() => {
        modal.classList.remove('active');
        // Réactiver le scroll du body
        document.body.style.overflow = '';
    }, 300);
    
    // Retirer l'event listener de la touche Échap
    document.removeEventListener('keydown', handleEscapeKey);
    
    console.log(`✅ Modal ${modalId} fermée`);
}

/**
 * Ferme tous les modals ouverts
 */
function closeAllModals() {
    const activeModals = document.querySelectorAll('.oda-modal.active');
    activeModals.forEach(modal => {
        closeModal(modal.id);
    });
}

/**
 * Gère la fermeture des modals avec la touche Échap
 */
function handleEscapeKey(event) {
    if (event.key === 'Escape' || event.key === 'Esc') {
        closeAllModals();
    }
}

/**
 * Empêche la propagation des clics à l'intérieur du modal
 */
function preventModalClosePropagation() {
    const modalContents = document.querySelectorAll('.modal-content');
    modalContents.forEach(content => {
        content.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    });
}

// ==================== INITIALISATION DES LIENS DU MENU ====================

/**
 * Connecte les liens du menu hamburger aux modals
 */
function initMenuLinks() {
    // Lien "À propos"
    const aboutLink = document.getElementById('aboutLink');
    if (aboutLink) {
        aboutLink.addEventListener('click', (e) => {
            e.preventDefault();
            // Fermer le menu hamburger
            closeMenu();
            // Ouvrir le modal
            setTimeout(() => {
                openModal('aboutModal');
            }, 300);
        });
    }
    
    // Lien "Contact"
    const contactLink = document.getElementById('contactLink');
    if (contactLink) {
        contactLink.addEventListener('click', (e) => {
            e.preventDefault();
            // Fermer le menu hamburger
            closeMenu();
            // Ouvrir le modal
            setTimeout(() => {
                openModal('contactModal');
            }, 300);
        });
    }
    
    // Lien "Aide"
    const helpLink = document.getElementById('helpLink');
    if (helpLink) {
        helpLink.addEventListener('click', (e) => {
            e.preventDefault();
            // Fermer le menu hamburger
            closeMenu();
            // Ouvrir le modal
            setTimeout(() => {
                openModal('helpModal');
            }, 300);
        });
    }
    
    console.log('✅ Liens du menu initialisés');
}

/**
 * Ferme le menu hamburger
 */
function closeMenu() {
    const sideMenu = document.querySelector('.side-menu');
    const overlay = document.getElementById('overlay');
    
    if (sideMenu) {
        sideMenu.classList.remove('active');
    }
    if (overlay) {
        overlay.classList.remove('active');
    }
}

// ==================== EFFETS VISUELS ====================

/**
 * Ajoute un effet de parallaxe au défilement du modal
 */
function initModalParallax() {
    const modalBodies = document.querySelectorAll('.modal-body');
    
    modalBodies.forEach(body => {
        body.addEventListener('scroll', function() {
            const scrolled = this.scrollTop;
            const header = this.closest('.modal-content').querySelector('.modal-header');
            
            if (header) {
                header.style.transform = `translateY(${scrolled * 0.3}px)`;
                header.style.opacity = Math.max(0.5, 1 - (scrolled / 300));
            }
        });
    });
}

/**
 * Ajoute des effets de hover aux cartes
 */
function initCardHoverEffects() {
    const cards = document.querySelectorAll('.info-card, .help-card, .contact-item');
    
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
        });
    });
}

// ==================== INITIALISATION ====================

/**
 * Initialise tous les composants des modals
 */
function initOdaModals() {
    console.log('🚀 Initialisation des modals ODA...');
    
    // Empêcher la propagation des clics
    preventModalClosePropagation();
    
    // Initialiser les liens du menu
    initMenuLinks();
    
    // Initialiser les effets
    initModalParallax();
    initCardHoverEffects();
    
    console.log('✅ Modals ODA initialisés avec succès !');
}

// ==================== AUTO-INITIALISATION ====================

// Initialiser au chargement du DOM
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initOdaModals);
} else {
    // DOM déjà chargé
    initOdaModals();
}

// ==================== EXPORT DES FONCTIONS ====================

// Rendre les fonctions disponibles globalement
window.openModal = openModal;
window.closeModal = closeModal;
window.closeAllModals = closeAllModals;

console.log('📦 Module modals ODA chargé pour menu hamburger');
// ==================== ANIMATIONS CSS NÉCESSAIRES ====================
const style = document.createElement('style');
style.textContent = `
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    .favorite-btn:hover {
        transform: scale(1.1);
    }
`;
document.head.appendChild(style);

// ==================== INITIALISATION ====================
window.odaMarketplace = null;

// Remplacer la fonction loadAllProductsOptimized
window.loadAllProductsOptimized = async function() {
    if (!window.odaMarketplace) {
        window.odaMarketplace = new OdaMarketplace(window.supabase);
    }
    await window.odaMarketplace.init();
};

// Remplacer la fonction displayProducts
window.displayProducts = function() {
    // Maintenant géré par VirtualScrollManager
    console.log('✓ displayProducts appelé (géré par VirtualScrollManager)');
};

// Fonction de recherche optimisée
window.initSearch = function() {
    const searchInput = document.querySelector('.search-box input');
    if (!searchInput) return;

    let debounceTimer;
    searchInput.addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            const term = e.target.value.trim();
            if (window.odaMarketplace) {
                window.odaMarketplace.searchTerm = term;
                window.odaMarketplace.filterProducts(
                    window.odaMarketplace.currentCategory,
                    term
                );
            }
        }, CONFIG.DEBOUNCE_DELAY);
    });
};

// Fonction de filtre par catégorie
window.setupCategoryFiltering = function() {
    document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener('click', () => {
            const category = item.dataset.category;
            
            document.querySelectorAll('.category-item').forEach(i => 
                i.classList.remove('active')
            );
            item.classList.add('active');

            if (window.odaMarketplace) {
                window.odaMarketplace.currentCategory = category;
                window.odaMarketplace.filterProducts(
                    category,
                    window.odaMarketplace.searchTerm
                );
            }
        });
    });
};

// Fonction de rechargement forcé
window.forceReloadData = async function() {
    if (!window.odaMarketplace) return;
    
    if (confirm('Recharger les données depuis le serveur ?')) {
        window.loadingProgress?.start();
        try {
            await window.odaMarketplace.forceReload();
            showToast('✅ Données rechargées', 'success');
        } catch (error) {
            showToast('❌ Erreur', 'error');
        }
    }
};

console.log('🎯 Module optimisé chargé - Type Play Store');
console.log(`📊 Config: ${CONFIG.INITIAL_LOAD} produits initiaux + ${CONFIG.LOAD_MORE} par scroll`);
console.log(`💾 Cache: ${CONFIG.CACHE_DURATION}h`);
</script>
</body>
</html>
